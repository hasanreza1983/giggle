/**
 * jsjac-jingle [compressed]
 * @fileoverview JSJaC Jingle library, implementation of XEP-0166.
 *
 * @version 0.7.0
 * @date 2014-06-11
 * @author ValÃ©rian Saliou https://valeriansaliou.name/
 * @license MPL 2.0
 *
 * @url https://github.com/valeriansaliou/jsjac-jingle
 * @repository git+https://github.com/valeriansaliou/jsjac-jingle.git
 * @depends https://github.com/sstrigler/JSJaC
 */

(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b){var c=[],d=[];return y(a,function(a){(b(a)?c:d).push(a)}),[c,d]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this),function(){"use strict";function a(a){function b(){}var c={};c.Object=b,a.extend(c.Object,{__mro__:[c.Object],__properties__:{__ringConstructor__:function(){}},__classId__:1,__parents__:[],__classIndex__:{1:c.Object}}),a.extend(c.Object.prototype,{__ringConstructor__:c.Object.__properties__.__ringConstructor__});var d=function(a){function b(){}b.prototype=a;var c=new b;return c.__proto__=a,c};c.__objectCreate=d;var e=3,f=/xyz/.test(function(){xyz()})?/\$super\b/:/.*/;c.create=function(){var b=a.toArray(arguments);b.reverse();var i=b[0],j=b.length>=2?b[1]:[];j instanceof Array||(j=[j]),a.each(j,function(a){h(a)}),0===j.length&&(j=[c.Object]);var k=i.constructor!==Object?i.constructor:void 0;i=a.clone(i),delete i.constructor,k?i.__ringConstructor__=k:(k=i.init,delete i.init,k&&(i.__ringConstructor__=k));var l=function(){this.$super=null,this.__ringConstructor__.apply(this,arguments)};l.__properties__=i;var m=a.pluck(j,"__mro__");m=m.concat([j]);var n=[l].concat(g(m)),o=Object.prototype;a.each(a.clone(n).reverse(),function(b){var c=d(o);a.extend(c,b.__properties__),a.each(a.keys(c),function(a){var d=c[a];"function"!=typeof d||!f.test(d)||"__ringConstructor__"!==a&&b.__ringConvertedObject__||(c[a]=function(a,b,c){return function(){var d=this.$super;this.$super=c[a];try{return b.apply(this,arguments)}finally{this.$super=d}}}(a,d,o))}),c.constructor=b,o=c});var p=e++;return l.__mro__=n,l.__parents__=j,l.prototype=o,l.__classId__=p,l.__classIndex__={},a.each(l.__mro__,function(a){l.__classIndex__[a.__classId__]=a}),l.prototype.classInit&&(l.__classInit__=l.prototype.classInit,delete l.prototype.classInit),a.each(a.chain(l.__mro__).clone().reverse().value(),function(a){if(a.__classInit__){var b=a.__classInit__(l.prototype);void 0!==b&&(l.prototype=b)}}),l};var g=function(b){for(var d=[],e=a.clone(b);;){for(var f=!1,g=0;g<e.length;g++)if(0!==e[g].length){var h=e[g][0],i=a.find(e,function(b){return a.contains(a.rest(b),h)});if(!i){f=!0,d.push(h),e=a.map(e,function(b){return a.head(b)===h?a.rest(b):b});break}}if(!f){if(a.all(e,function(a){return 0===a.length}))return d;throw new c.ValueError("Cannot create a consistent method resolution order (MRO)")}}},h=function(b){if(!b.__classId__){var d=Object.getOwnPropertyNames?function(){var c={};return function d(b){b!==Object.prototype&&(a.extend(c,a.chain(Object.getOwnPropertyNames(b)).map(function(a){return[a,!0]}).object().value()),d(Object.getPrototypeOf(b)))}(b.prototype),a.object(a.map(a.keys(c),function(a){return[a,b.prototype[a]]}))}():b.prototype;d=a.chain(d).map(function(a,b){return[b,a]}).filter(function(a){return"constructor"!==a[0]&&"__proto__"!==a[0]}).object().value();var f=e++;a.extend(b,{__mro__:[b,c.Object],__properties__:a.extend({},d,{__ringConstructor__:function(){this.$super.apply(this,arguments);var a=this.$super;this.$super=null;try{b.apply(this,arguments)}finally{this.$super=a}}}),__classId__:f,__parents__:[c.Object],__classIndex__:{1:c.Object},__ringConvertedObject__:!0}),b.__classIndex__[f]=b}};return c.instance=function(a,b){return"object"==typeof a&&a.constructor&&a.constructor.__classIndex__&&"function"==typeof b&&"number"==typeof b.__classId__?void 0!==a.constructor.__classIndex__[b.__classId__]:"string"==typeof b?typeof a===b:a instanceof b},c.Error=c.create({name:"ring.Error",defaultMessage:"",constructor:function(a){this.message=a||this.defaultMessage},classInit:function(b){var c=[],e=function(a){a&&(c.push(a),e(a.__proto__))};e(b);var f=new Error;return a.each(a.clone(c).reverse(),function(b){var c=d(f);a.each(b,function(a,b){"__proto__"!==b&&(c[b]=a)}),f=c}),f}}),c.ValueError=c.create([c.Error],{name:"ring.ValueError"}),c.getSuper=function(b,d,e){for(var f,g=d.constructor.__mro__,h=0;h<g.length;h++)if(g[h]===b){f=h;break}if(void 0===f)throw new c.ValueError("Class not found in instance's method resolution order.");var i,j=function(a,b){return 0===b?a:j(a.__proto__,b-1)},k=j(d.constructor.prototype,f+1);return i="constructor"!==e&&"init"!==e?k[e]:k.__ringConstructor__,c.instance(i,"function")?a.bind(i,d):i},c}if("undefined"!=typeof exports){var b=require("underscore");b.extend(exports,a(b))}else"undefined"!=typeof define?define(["underscore"],a):window.ring=a(_)}();var WEBRTC_GET_MEDIA=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.getUserMedia,WEBRTC_PEER_CONNECTION=window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.RTCPeerConnection,WEBRTC_SESSION_DESCRIPTION=window.mozRTCSessionDescription||window.RTCSessionDescription,WEBRTC_ICE_CANDIDATE=window.mozRTCIceCandidate||window.RTCIceCandidate,WEBRTC_CONFIGURATION={peer_connection:{config:{iceServers:[{url:"stun:stun.jappix.com"}]},constraints:{optional:[{DtlsSrtpKeyAgreement:!0}]}},create_offer:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},create_answer:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},WEBRTC_SDP_LINE_BREAK="\r\n",WEBRTC_SDP_TYPE_OFFER="offer",WEBRTC_SDP_TYPE_ANSWER="answer",R_WEBRTC_SDP_CANDIDATE=/^a=candidate:(\w{1,32}) (\d{1,5}) (udp|tcp) (\d{1,10}) ([a-zA-Z0-9:\.]{1,45}) (\d{1,5}) (typ) (host|srflx|prflx|relay)( (raddr) ([a-zA-Z0-9:\.]{1,45}) (rport) (\d{1,5}))?( (generation) (\d))?/i,R_WEBRTC_SDP_ICE_PAYLOAD={rtpmap:/^a=rtpmap:(\d+) (([^\s\/]+)\/(\d+)(\/([^\s\/]+))?)?/i,fmtp:/^a=fmtp:(\d+) (.+)/i,group:/^a=group:(\S+) (.+)/,rtcp_fb:/^a=rtcp-fb:(\S+) (\S+)( (\S+))?/i,rtcp_fb_trr_int:/^a=rtcp-fb:(\d+) trr-int (\d+)/i,pwd:/^a=ice-pwd:(\S+)/i,ufrag:/^a=ice-ufrag:(\S+)/i,ptime:/^a=ptime:(\d+)/i,maxptime:/^a=maxptime:(\d+)/i,ssrc:/^a=ssrc:(\d+) (\w+)(:(.+))?/i,ssrc_group:/^a=ssrc-group:(\S+) ([\d ]+)/i,rtcp_mux:/^a=rtcp-mux/i,crypto:/^a=crypto:(\d{1,9}) (\S+) (\S+)( (\S+))?/i,zrtp_hash:/^a=zrtp-hash:(\S+) (\S+)/i,fingerprint:/^a=fingerprint:(\S+) (\S+)/i,setup:/^a=setup:(\S+)/i,extmap:/^a=extmap:([^\s\/]+)(\/([^\s\/]+))? (\S+)/i,bandwidth:/^b=(\w+):(\d+)/i,media:/^m=(audio|video|application|data) /i},R_NETWORK_PROTOCOLS={stun:/^stun:/i},R_NETWORK_IP={all:{v4:/((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])/,v6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i},lan:{v4:/(^127\.0\.0\.1)|(^10\.)|(^172\.1[6-9]\.)|(^172\.2[0-9]\.)|(^172\.3[0-1]\.)|(^192\.168\.)/,v6:/((::1)|(^fe80::))(.+)?/i}},NS_JINGLE="urn:xmpp:jingle:1",NS_JINGLE_ERRORS="urn:xmpp:jingle:errors:1",NS_JINGLE_APPS_RTP="urn:xmpp:jingle:apps:rtp:1",NS_JINGLE_APPS_RTP_INFO="urn:xmpp:jingle:apps:rtp:info:1",NS_JINGLE_APPS_RTP_AUDIO="urn:xmpp:jingle:apps:rtp:audio",NS_JINGLE_APPS_RTP_VIDEO="urn:xmpp:jingle:apps:rtp:video",NS_JINGLE_APPS_RTP_RTP_HDREXT="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",NS_JINGLE_APPS_RTP_RTCP_FB="urn:xmpp:jingle:apps:rtp:rtcp-fb:0",NS_JINGLE_APPS_RTP_ZRTP="urn:xmpp:jingle:apps:rtp:zrtp:1",NS_JINGLE_APPS_RTP_SSMA="urn:xmpp:jingle:apps:rtp:ssma:0",NS_JINGLE_APPS_STUB="urn:xmpp:jingle:apps:stub:0",NS_JINGLE_APPS_DTLS="urn:xmpp:tmp:jingle:apps:dtls:0",NS_JINGLE_APPS_GROUPING="urn:xmpp:jingle:apps:grouping:0",NS_JINGLE_TRANSPORTS_RAWUDP="urn:xmpp:jingle:transports:raw-udp:1",NS_JINGLE_TRANSPORTS_ICEUDP="urn:xmpp:jingle:transports:ice-udp:1",NS_JINGLE_TRANSPORTS_STUB="urn:xmpp:jingle:transports:stub:0",NS_JINGLE_SECURITY_STUB="urn:xmpp:jingle:security:stub:0",NS_JABBER_JINGLENODES="http://jabber.org/protocol/jinglenodes",NS_JABBER_JINGLENODES_CHANNEL="http://jabber.org/protocol/jinglenodes#channel",NS_TELEPATHY_MUJI="http://telepathy.freedesktop.org/muji",NS_EXTDISCO="urn:xmpp:extdisco:1",NS_IETF_RFC_3264="urn:ietf:rfc:3264",NS_IETF_RFC_5576="urn:ietf:rfc:5576",NS_IETF_RFC_5888="urn:ietf:rfc:5888",R_NS_JINGLE_APP=/^urn:xmpp:jingle:app:(\w+)(:(\w+))?(:(\d+))?$/,R_NS_JINGLE_TRANSPORT=/^urn:xmpp:jingle:transport:(\w+)$/,MAP_DISCO_JINGLE=[NS_JINGLE,NS_JINGLE_APPS_RTP,NS_JINGLE_APPS_RTP_AUDIO,NS_JINGLE_APPS_RTP_VIDEO,NS_JINGLE_TRANSPORTS_RAWUDP,NS_JINGLE_TRANSPORTS_ICEUDP,NS_IETF_RFC_3264,NS_IETF_RFC_5576,NS_IETF_RFC_5888,NS_JINGLE_APPS_RTP_RTCP_FB,NS_JINGLE_APPS_RTP_RTP_HDREXT,NS_JINGLE_APPS_DTLS,NS_JINGLE_APPS_RTP_ZRTP,NS_TELEPATHY_MUJI,NS_JABBER_JINGLENODES,NS_EXTDISCO],JSJAC_JINGLE_AVAILABLE=WEBRTC_GET_MEDIA?!0:!1,JSJAC_JINGLE_SESSION_SINGLE="single",JSJAC_JINGLE_SESSION_MUJI="muji",JSJAC_JINGLE_PEER_TIMEOUT_DEFAULT=15,JSJAC_JINGLE_PEER_TIMEOUT_DISCONNECT=5,JSJAC_JINGLE_STANZA_TIMEOUT=10,JSJAC_JINGLE_STANZA_ID_PRE="jj",JSJAC_JINGLE_NETWORK="0",JSJAC_JINGLE_GENERATION="0",JSJAC_JINGLE_BROWSER_FIREFOX="Firefox",JSJAC_JINGLE_BROWSER_CHROME="Chrome",JSJAC_JINGLE_BROWSER_SAFARI="Safari",JSJAC_JINGLE_BROWSER_OPERA="Opera",JSJAC_JINGLE_BROWSER_IE="IE",JSJAC_JINGLE_SENDERS_BOTH={jingle:"both",sdp:"sendrecv"},JSJAC_JINGLE_SENDERS_INITIATOR={jingle:"initiator",sdp:"sendonly"},JSJAC_JINGLE_SENDERS_NONE={jingle:"none",sdp:"inactive"},JSJAC_JINGLE_SENDERS_RESPONDER={jingle:"responder",sdp:"recvonly"},JSJAC_JINGLE_CREATOR_INITIATOR="initiator",JSJAC_JINGLE_CREATOR_RESPONDER="responder",JSJAC_JINGLE_STATUS_INACTIVE="inactive",JSJAC_JINGLE_STATUS_INITIATING="initiating",JSJAC_JINGLE_STATUS_INITIATED="initiated",JSJAC_JINGLE_STATUS_ACCEPTING="accepting",JSJAC_JINGLE_STATUS_ACCEPTED="accepted",JSJAC_JINGLE_STATUS_TERMINATING="terminating",JSJAC_JINGLE_STATUS_TERMINATED="terminated",JSJAC_JINGLE_ACTION_CONTENT_ACCEPT="content-accept",JSJAC_JINGLE_ACTION_CONTENT_ADD="content-add",JSJAC_JINGLE_ACTION_CONTENT_MODIFY="content-modify",JSJAC_JINGLE_ACTION_CONTENT_REJECT="content-reject",JSJAC_JINGLE_ACTION_CONTENT_REMOVE="content-remove",JSJAC_JINGLE_ACTION_DESCRIPTION_INFO="description-info",JSJAC_JINGLE_ACTION_SECURITY_INFO="security-info",JSJAC_JINGLE_ACTION_SESSION_ACCEPT="session-accept",JSJAC_JINGLE_ACTION_SESSION_INFO="session-info",JSJAC_JINGLE_ACTION_SESSION_INITIATE="session-initiate",JSJAC_JINGLE_ACTION_SESSION_TERMINATE="session-terminate",JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT="transport-accept",JSJAC_JINGLE_ACTION_TRANSPORT_INFO="transport-info",JSJAC_JINGLE_ACTION_TRANSPORT_REJECT="transport-reject",JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE="transport-replace",JSJAC_JINGLE_ERROR_OUT_OF_ORDER={jingle:"out-of-order",xmpp:"unexpected-request",type:"wait"},JSJAC_JINGLE_ERROR_TIE_BREAK={jingle:"tie-break",xmpp:"conflict",type:"cancel"},JSJAC_JINGLE_ERROR_UNKNOWN_SESSION={jingle:"unknown-session",xmpp:"item-not-found",type:"cancel"},JSJAC_JINGLE_ERROR_UNSUPPORTED_INFO={jingle:"unsupported-info",xmpp:"feature-not-implemented",type:"modify"},JSJAC_JINGLE_ERROR_SECURITY_REQUIRED={jingle:"security-required",xmpp:"not-acceptable",type:"cancel"},XMPP_ERROR_UNEXPECTED_REQUEST={xmpp:"unexpected-request",type:"wait"},XMPP_ERROR_CONFLICT={xmpp:"conflict",type:"cancel"},XMPP_ERROR_ITEM_NOT_FOUND={xmpp:"item-not-found",type:"cancel"},XMPP_ERROR_NOT_ACCEPTABLE={xmpp:"not-acceptable",type:"modify"},XMPP_ERROR_FEATURE_NOT_IMPLEMENTED={xmpp:"feature-not-implemented",type:"cancel"},XMPP_ERROR_SERVICE_UNAVAILABLE={xmpp:"service-unavailable",type:"cancel"},XMPP_ERROR_REDIRECT={xmpp:"redirect",type:"modify"},XMPP_ERROR_RESOURCE_CONSTRAINT={xmpp:"resource-constraint",type:"wait"},XMPP_ERROR_BAD_REQUEST={xmpp:"bad-request",type:"cancel"},JSJAC_JINGLE_REASON_ALTERNATIVE_SESSION="alternative-session",JSJAC_JINGLE_REASON_BUSY="busy",JSJAC_JINGLE_REASON_CANCEL="cancel",JSJAC_JINGLE_REASON_CONNECTIVITY_ERROR="connectivity-error",JSJAC_JINGLE_REASON_DECLINE="decline",JSJAC_JINGLE_REASON_EXPIRED="expired",JSJAC_JINGLE_REASON_FAILED_APPLICATION="failed-application",JSJAC_JINGLE_REASON_FAILED_TRANSPORT="failed-transport",JSJAC_JINGLE_REASON_GENERAL_ERROR="general-error",JSJAC_JINGLE_REASON_GONE="gone",JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS="incompatible-parameters",JSJAC_JINGLE_REASON_MEDIA_ERROR="media-error",JSJAC_JINGLE_REASON_SECURITY_ERROR="security-error",JSJAC_JINGLE_REASON_SUCCESS="success",JSJAC_JINGLE_REASON_TIMEOUT="timeout",JSJAC_JINGLE_REASON_UNSUPPORTED_APPLICATIONS="unsupported-applications",JSJAC_JINGLE_REASON_UNSUPPORTED_TRANSPORTS="unsupported-transports",JSJAC_JINGLE_SESSION_INFO_ACTIVE="active",JSJAC_JINGLE_SESSION_INFO_HOLD="hold",JSJAC_JINGLE_SESSION_INFO_MUTE="mute",JSJAC_JINGLE_SESSION_INFO_RINGING="ringing",JSJAC_JINGLE_SESSION_INFO_UNHOLD="unhold",JSJAC_JINGLE_SESSION_INFO_UNMUTE="unmute",JSJAC_JINGLE_MEDIA_AUDIO="audio",JSJAC_JINGLE_MEDIA_VIDEO="video",JSJAC_JINGLE_VIDEO_SOURCE_CAMERA="camera",JSJAC_JINGLE_VIDEO_SOURCE_SCREEN="screen",JSJAC_JINGLE_STANZA_TYPE_ALL="all",JSJAC_JINGLE_STANZA_TYPE_RESULT="result",JSJAC_JINGLE_STANZA_TYPE_SET="set",JSJAC_JINGLE_STANZA_TYPE_GET="get",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST="host",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX="srflx",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_PRFLX="prflx",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_RELAY="relay",JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE="ice",JSJAC_JINGLE_SDP_CANDIDATE_METHOD_RAW="raw",JSJAC_JINGLE_SDP_CANDIDATE_MAP_ICEUDP=[{n:"component",r:1},{n:"foundation",r:1},{n:"generation",r:1},{n:"id",r:1},{n:"ip",r:1},{n:"network",r:1},{n:"port",r:1},{n:"priority",r:1},{n:"protocol",r:1},{n:"rel-addr",r:0},{n:"rel-port",r:0},{n:"type",r:1}],JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP=[{n:"component",r:1},{n:"generation",r:1},{n:"id",r:1},{n:"ip",r:1},{n:"port",r:1},{n:"type",r:1}],JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_LOCAL="IN",JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_REMOTE="IN",JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V4="IP4",JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V6="IP6",JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_TCP="tcp",JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_UDP="udp",JSJAC_JINGLE_SDP_CANDIDATE_IP_V4="0.0.0.0",JSJAC_JINGLE_SDP_CANDIDATE_IP_V6="::",JSJAC_JINGLE_SDP_CANDIDATE_IP_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_IP_V4,JSJAC_JINGLE_SDP_CANDIDATE_PORT_DEFAULT="1",JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_REMOTE,JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V4,JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_UDP,JSJAC_JINGLE_SDP_CANDIDATE_PRIORITY_DEFAULT="1",JSJAC_JINGLE_SDP_CANDIDATE_TYPES={};JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE,JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE,JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_PRFLX]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE,JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_RELAY]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_RAW;var JSJAC_JINGLE_BROWSERS={};JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_FIREFOX]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_CHROME]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_SAFARI]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_OPERA]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_IE]=1;var JSJAC_JINGLE_SENDERS={};JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_BOTH.jingle]=JSJAC_JINGLE_SENDERS_BOTH.sdp,JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_INITIATOR.jingle]=JSJAC_JINGLE_SENDERS_INITIATOR.sdp,JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_NONE.jingle]=JSJAC_JINGLE_SENDERS_NONE.sdp,JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_RESPONDER.jingle]=JSJAC_JINGLE_SENDERS_RESPONDER.sdp;var JSJAC_JINGLE_CREATORS={};JSJAC_JINGLE_CREATORS[JSJAC_JINGLE_CREATOR_INITIATOR]=1,JSJAC_JINGLE_CREATORS[JSJAC_JINGLE_CREATOR_RESPONDER]=1;var JSJAC_JINGLE_STATUSES={};JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_INACTIVE]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_INITIATING]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_INITIATED]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_ACCEPTING]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_ACCEPTED]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_TERMINATING]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_TERMINATED]=1;var JSJAC_JINGLE_ACTIONS={};JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_ACCEPT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_ADD]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_MODIFY]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_REJECT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_REMOVE]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_DESCRIPTION_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SECURITY_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_ACCEPT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_INITIATE]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_TERMINATE]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_REJECT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE]=1;var JSJAC_JINGLE_ERRORS={};JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_OUT_OF_ORDER.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_TIE_BREAK.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_UNKNOWN_SESSION.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_UNSUPPORTED_INFO.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_SECURITY_REQUIRED.jingle]=1;var XMPP_ERRORS={};XMPP_ERRORS[XMPP_ERROR_UNEXPECTED_REQUEST.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_CONFLICT.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_ITEM_NOT_FOUND.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_NOT_ACCEPTABLE.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_FEATURE_NOT_IMPLEMENTED.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_SERVICE_UNAVAILABLE.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_REDIRECT.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_RESOURCE_CONSTRAINT.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_BAD_REQUEST.xmpp]=1;var JSJAC_JINGLE_REASONS={};JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_ALTERNATIVE_SESSION]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_BUSY]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_CANCEL]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_CONNECTIVITY_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_DECLINE]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_EXPIRED]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_FAILED_APPLICATION]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_FAILED_TRANSPORT]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_GENERAL_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_GONE]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_MEDIA_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_SECURITY_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_SUCCESS]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_TIMEOUT]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_UNSUPPORTED_APPLICATIONS]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_UNSUPPORTED_TRANSPORTS]=1;
var JSJAC_JINGLE_SESSION_INFOS={};JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_ACTIVE]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_HOLD]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_MUTE]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_RINGING]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_UNHOLD]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_UNMUTE]=1;var JSJAC_JINGLE_MEDIAS={};JSJAC_JINGLE_MEDIAS[JSJAC_JINGLE_MEDIA_AUDIO]={label:"0"},JSJAC_JINGLE_MEDIAS[JSJAC_JINGLE_MEDIA_VIDEO]={label:"1"};var JSJAC_JINGLE_VIDEO_SOURCES={};JSJAC_JINGLE_VIDEO_SOURCES[JSJAC_JINGLE_VIDEO_SOURCE_CAMERA]=1,JSJAC_JINGLE_VIDEO_SOURCES[JSJAC_JINGLE_VIDEO_SOURCE_SCREEN]=1;var JSJAC_JINGLE_STANZAS={};JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_ALL]=1,JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_RESULT]=1,JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_SET]=1,JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_GET]=1;var JSJAC_JINGLE_STORE_CONNECTION=null,JSJAC_JINGLE_STORE_SESSIONS={},JSJAC_JINGLE_STORE_INITIATE=function(){},JSJAC_JINGLE_STORE_DEBUG={log:function(){}},JSJAC_JINGLE_STORE_EXTDISCO={stun:{},turn:{}},JSJAC_JINGLE_STORE_FALLBACK={stun:{},turn:{}},JSJAC_JINGLE_STORE_RELAYNODES={stun:{}},JSJAC_JINGLE_STORE_DEFER={deferred:!1,count:0,fn:[]},R_JSJAC_JINGLE_SERVICE_URI=/^(\w+):([^:\?]+)(?::(\d+))?(?:\?transport=(\w+))?/i,JSJaCJingleUtils=ring.create({constructor:function(a){this.parent=a},array_remove_value:function(a,b){try{var c;for(c=0;c<a.length;c++)a[c]===b&&(a.splice(c,1),c--)}catch(d){this.parent.get_debug().log("[JSJaCJingle:utils] array_remove_value > "+d,1)}return a},object_length:function(a){var b,c=0;try{for(b in a)a.hasOwnProperty(b)&&c++}catch(d){this.parent.get_debug().log("[JSJaCJingle:utils] object_length > "+d,1)}return c},object_collect:function(){var a,b,c={},d=arguments.length;for(a=0;d>a;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&(c[b]=arguments[a][b]);return c},object_clone:function(a){try{var b,c,d;if(null===a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){for(b=[],c=0,len=a.length;len>c;c++)b[c]=this.object_clone(a[c]);return b}if(a instanceof Object){b={};for(d in a)a.hasOwnProperty(d)&&(b[d]=this.object_clone(a[d]));return b}}catch(e){this.parent.get_debug().log("[JSJaCJingle:utils] object_clone > "+e,1)}this.parent.get_debug().log("[JSJaCJingle:utils] object_clone > Cannot clone this object.",1)},browser:function(){var a={name:"Generic"};try{var b,c,d;c={firefox:JSJAC_JINGLE_BROWSER_FIREFOX,chrome:JSJAC_JINGLE_BROWSER_CHROME,safari:JSJAC_JINGLE_BROWSER_SAFARI,opera:JSJAC_JINGLE_BROWSER_OPERA,msie:JSJAC_JINGLE_BROWSER_IE},b=navigator.userAgent.toLowerCase();for(d in c)if(b.indexOf(d)>-1){a.name=c[d];break}}catch(e){this.parent.get_debug().log("[JSJaCJingle:utils] browser > "+e,1)}return a},config_ice:function(){try{var a=this.object_collect(this.parent.get_stun(),JSJAC_JINGLE_STORE_EXTDISCO.stun,JSJAC_JINGLE_STORE_RELAYNODES.stun,JSJAC_JINGLE_STORE_FALLBACK.stun),b=this.object_collect(this.parent.get_turn(),JSJAC_JINGLE_STORE_EXTDISCO.turn,JSJAC_JINGLE_STORE_FALLBACK.turn);if(a&&this.object_length(a)||b&&this.object_length(b)){var c,d,e,f={iceServers:[]};for(c in a)c&&(d=a[c],e={},e.url="stun:"+c,d.port&&(e.url+=":"+d.port),d.transport&&this.browser().name!=JSJAC_JINGLE_BROWSER_FIREFOX&&(e.url+="?transport="+d.transport),f.iceServers.push(e));var g,h,i;for(g in b)g&&(h=b[g],i={},i.url="turn:"+g,h.port&&(i.url+=":"+h.port),h.transport&&(i.url+="?transport="+h.transport),h.username&&(i.username=h.username),h.password&&(i.password=h.password),f.iceServers.push(i));var j,k=!1;for(j in f.iceServers)if(f.iceServers[j].url.match(R_NETWORK_PROTOCOLS.stun)){k=!0;break}return k||f.iceServers.push({url:WEBRTC_CONFIGURATION.peer_connection.config.iceServers[0].url}),f}}catch(l){this.parent.get_debug().log("[JSJaCJingle:utils] config_ice > "+l,1)}return WEBRTC_CONFIGURATION.peer_connection.config},stanza_get_value:function(a){try{return a.firstChild.nodeValue||null}catch(b){try{return a[0].firstChild.nodeValue||null}catch(c){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_get_value > "+c,1)}}return null},stanza_get_attribute:function(a,b){if(!b)return null;try{return a.getAttribute(b)||null}catch(c){try{return a[0].getAttribute(b)||null}catch(d){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_get_attribute > "+d,1)}}return null},stanza_set_attribute:function(a,b,c){if(b&&c&&a)try{a.setAttribute(b,c)}catch(d){try{a[0].setAttribute(b,c)}catch(e){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_set_attribute > "+e,1)}}},stanza_get_element:function(a,b,c){var d=[];if(!a)return d;a.length&&(a=a[0]);try{var e,f=a.getElementsByTagNameNS(c,b);if(f&&f.length)for(e=0;e<f.length;e++)f[e]&&f[e].parentNode==a&&d.push(f[e]);return d}catch(g){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_get_element > "+g,1)}return d},stanza_jingle:function(a){try{return a.getChild("jingle",NS_JINGLE)}catch(b){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_jingle > "+b,1)}return null},stanza_from:function(a){try{return a.getFrom()||null}catch(b){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_from > "+b,1)}return null},stanza_sid:function(a){try{return this.stanza_get_attribute(this.stanza_jingle(a),"sid")}catch(b){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_sid > "+b,1)}},stanza_safe:function(a){try{return!(a.getType()==JSJAC_JINGLE_STANZA_TYPE_SET&&this.stanza_sid(a)!=this.parent.get_sid()||this.stanza_from(a)!=this.parent.get_to())}catch(b){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_safe > "+b,1)}return!1},stanza_terminate_reason:function(a){try{var b=this.stanza_jingle(a);if(b){var c=this.stanza_get_element(b,"reason",NS_JINGLE);if(c.length){var d;for(d in JSJAC_JINGLE_REASONS)if(this.stanza_get_element(c[0],d,NS_JINGLE).length)return d}}}catch(e){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_terminate_reason > "+e,1)}return null},stanza_session_info:function(a){try{var b=this.stanza_jingle(a);if(b){var c;for(c in JSJAC_JINGLE_SESSION_INFOS)if(this.stanza_get_element(b,c,NS_JINGLE_APPS_RTP_INFO).length)return c}}catch(d){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_session_info > "+d,1)}return null},stanza_timeout:function(a,b,c){try{a=a||JSJAC_JINGLE_STANZA_TYPE_ALL;var d=this.parent.get_sid(),e=this.parent.get_status();this.parent.get_debug().log("[JSJaCJingle:utils] stanza_timeout > Registered (id: "+b+", status: "+e+").",4);var f=this;setTimeout(function(){f.parent.get_debug().log("[JSJaCJingle:utils] stanza_timeout > Cheking (id: "+b+", status: "+e+"-"+f.parent.get_status()+").",4),f.parent.get_sid()!=d||f.parent.get_status()!=e||b in f.parent.get_received_id()?f.parent.get_debug().log("[JSJaCJingle:utils] stanza_timeout > Stanza successful.",4):(f.parent.get_debug().log("[JSJaCJingle:utils] stanza_timeout > Stanza timeout.",2),f.parent.unregister_handler(a,b),c.external&&c.external(f),c.internal&&c.internal())},1e3*JSJAC_JINGLE_STANZA_TIMEOUT)}catch(g){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_timeout > "+g,1)}},stanza_parse_node:function(a,b,c,d,e,f){try{var g,h,i,j,k,l=this.stanza_get_element(a,b,c);if(l.length)for(g=0;g<l.length;g++){i=0,j=l[g],k={};for(h in e)if(k[e[h].n]=this.stanza_get_attribute(j,e[h].n),e[h].r&&!k[e[h].n]){i++;break}f&&(k[f.n]=this.stanza_get_value(j),f.r&&!k[f.n]&&i++),0===i&&d.push(k)}}catch(m){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_parse_node > "+m,1)}},stanza_parse_content:function(a){try{var b,c,d,e,f,g,h;if(c=this.stanza_jingle(a),c&&(d=this.stanza_get_element(c,"content",NS_JINGLE),d&&d.length)){for(b=0;b<d.length;b++)e=d[b],g=this.stanza_get_attribute(e,"name"),h=this.parent.get_senders(g)||this.stanza_get_attribute(e,"senders"),f=this.parent.get_creator(g)||this.stanza_get_attribute(e,"creator"),this.parent.set_name(g),this.parent.set_senders(g,h),this.parent.set_creator(g,f),this.parent.set_payloads_remote_add(g,this.stanza_parse_payload(e)),cur_candidate=this.stanza_parse_candidate(e),this.parent.set_candidates_remote_add(g,cur_candidate),this.parent.set_candidates_queue_remote(g,cur_candidate);return!0}}catch(i){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_parse_content > "+i,1)}return!1},stanza_parse_group:function(a){try{var b,c,d,e,f,g,h,i;if(d=this.stanza_jingle(a),d&&(e=this.stanza_get_element(d,"group",NS_JINGLE_APPS_GROUPING),e&&e.length))for(b=0;b<e.length;b++){for(f=e[b],i=[],group_semantics=this.stanza_get_attribute(f,"semantics"),g=this.stanza_get_element(f,"content",NS_JINGLE_APPS_GROUPING),c=0;c<g.length;c++)h=g[c],i.push(this.stanza_get_attribute(h,"name"));this.parent.set_group_remote(group_semantics,i)}return!0}catch(j){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_parse_group > "+j,1)}return!1},stanza_parse_payload:function(a){var b={descriptions:{},transports:{}};try{var c,d,e,f,g,h,i,j,k,l,m,n=function(){var a,c={attrs:{},"rtcp-fb":[],bandwidth:[],payload:{},"rtp-hdrext":[],"rtcp-mux":0,encryption:{attrs:{},crypto:[],"zrtp-hash":[]},ssrc:{},"ssrc-group":{}};for(a in c)a in b.descriptions||(b.descriptions[a]=c[a])},o=function(a){var c,d={attrs:{},parameter:[],"rtcp-fb":[],"rtcp-fb-trr-int":[]};a in b.descriptions.payload||(b.descriptions.payload[a]={});for(c in d)c in b.descriptions.payload[a]||(b.descriptions.payload[a][c]=d[c])},p=function(a){"object"!=typeof b.descriptions["ssrc-group"][a]&&(b.descriptions["ssrc-group"][a]=[])},q=this.stanza_get_element(a,"description",NS_JINGLE_APPS_RTP);if(q.length){q=q[0];var r=this.stanza_get_attribute(q,"media"),s=this.stanza_get_attribute(q,"ssrc");r||this.parent.get_debug().log("[JSJaCJingle:utils] stanza_parse_payload > No media attribute to "+cc_name+" stanza.",1),n(),b.descriptions.attrs.media=r,b.descriptions.attrs.ssrc=s;var t=this.stanza_get_element(q,"payload-type",NS_JINGLE_APPS_RTP);if(t.length)for(c=0;c<t.length;c++)f=0,k=t[c],l={},l.channels=this.stanza_get_attribute(k,"channels"),l.clockrate=this.stanza_get_attribute(k,"clockrate"),l.id=this.stanza_get_attribute(k,"id")||f++,l.name=this.stanza_get_attribute(k,"name"),b.descriptions.attrs.ptime=this.stanza_get_attribute(k,"ptime"),b.descriptions.attrs.maxptime=this.stanza_get_attribute(k,"maxptime"),0===f&&(m=l.id,o(m),b.descriptions.payload[m].attrs=l,this.stanza_parse_node(k,"parameter",NS_JINGLE_APPS_RTP,b.descriptions.payload[m].parameter,[{n:"name",r:1},{n:"value",r:0}]),this.stanza_parse_node(k,"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB,b.descriptions.payload[m]["rtcp-fb"],[{n:"type",r:1},{n:"subtype",r:0}]),this.stanza_parse_node(k,"rtcp-fb-trr-int",NS_JINGLE_APPS_RTP_RTCP_FB,b.descriptions.payload[m]["rtcp-fb-trr-int"],[{n:"value",r:1}]));var u=this.stanza_get_element(q,"encryption",NS_JINGLE_APPS_RTP);u.length&&(u=u[0],b.descriptions.encryption.attrs.required=this.stanza_get_attribute(u,"required")||"0",this.stanza_parse_node(u,"crypto",NS_JINGLE_APPS_RTP,b.descriptions.encryption.crypto,[{n:"crypto-suite",r:1},{n:"key-params",r:1},{n:"session-params",r:0},{n:"tag",r:1}]),this.stanza_parse_node(u,"zrtp-hash",NS_JINGLE_APPS_RTP_ZRTP,b.descriptions.encryption["zrtp-hash"],[{n:"version",r:1}],{n:"value",r:1}));var v=this.stanza_get_element(q,"ssrc-group",NS_JINGLE_APPS_RTP_SSMA);if(v&&v.length)for(d=0;d<v.length;d++)i=v[d],j=this.stanza_get_attribute(i,"semantics")||null,null!==j&&(cur_ssrc_group_semantics_obj={sources:[]},p(j),this.stanza_parse_node(i,"source",NS_JINGLE_APPS_RTP_SSMA,cur_ssrc_group_semantics_obj.sources,[{n:"ssrc",r:1}]),b.descriptions["ssrc-group"][j].push(cur_ssrc_group_semantics_obj));var w=this.stanza_get_element(q,"source",NS_JINGLE_APPS_RTP_SSMA);if(w&&w.length)for(e=0;e<w.length;e++)g=w[e],h=this.stanza_get_attribute(g,"ssrc")||null,null!==h&&(b.descriptions.ssrc[h]=[],this.stanza_parse_node(g,"parameter",NS_JINGLE_APPS_RTP_SSMA,b.descriptions.ssrc[h],[{n:"name",r:1},{n:"value",r:0}]));this.stanza_parse_node(q,"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB,b.descriptions["rtcp-fb"],[{n:"type",r:1},{n:"subtype",r:0}]),this.stanza_parse_node(q,"bandwidth",NS_JINGLE_APPS_RTP,b.descriptions.bandwidth,[{n:"type",r:1}],{n:"value",r:1}),this.stanza_parse_node(q,"rtp-hdrext",NS_JINGLE_APPS_RTP_RTP_HDREXT,b.descriptions["rtp-hdrext"],[{n:"id",r:1},{n:"uri",r:1},{n:"senders",r:0}]);var x=this.stanza_get_element(q,"rtcp-mux",NS_JINGLE_APPS_RTP);x.length&&(b.descriptions["rtcp-mux"]=1)}var y=this.stanza_get_element(a,"transport",NS_JINGLE_TRANSPORTS_ICEUDP);if(y.length){b.transports.pwd=this.stanza_get_attribute(y,"pwd"),b.transports.ufrag=this.stanza_get_attribute(y,"ufrag");var z=this.stanza_get_element(y,"fingerprint",NS_JINGLE_APPS_DTLS);z.length&&(b.transports.fingerprint={},b.transports.fingerprint.setup=this.stanza_get_attribute(z,"setup"),b.transports.fingerprint.hash=this.stanza_get_attribute(z,"hash"),b.transports.fingerprint.value=this.stanza_get_value(z))}}catch(A){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_parse_payload > "+A,1)}return b},stanza_parse_candidate:function(a){var b=[];try{var c=this,d=function(d,e){var f=c.stanza_get_element(a,"transport",d);f.length&&c.stanza_parse_node(f,"candidate",d,b,e)};d(NS_JINGLE_TRANSPORTS_ICEUDP,JSJAC_JINGLE_SDP_CANDIDATE_MAP_ICEUDP),d(NS_JINGLE_TRANSPORTS_RAWUDP,JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP)}catch(e){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_parse_candidate > "+e,1)}return b},stanza_build_node:function(a,b,c,d,e,f){var g=null;try{var h,i,j;if(c&&c.length)for(h in c)if(i=c[h]){g=b.appendChild(a.buildNode(d,{xmlns:e},f&&i[f]?i[f]:null));for(j in i)j!=f&&this.stanza_set_attribute(g,j,i[j])}}catch(k){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_build_node > name: "+d+" > "+k,1)}return g},stanza_generate_jingle:function(a,b){var c=null;try{var d;c=a.getNode().appendChild(a.buildNode("jingle",{xmlns:NS_JINGLE})),b.sid||(b.sid=this.parent.get_sid());for(d in b)this.stanza_set_attribute(c,d,b[d])}catch(e){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_generate_jingle > "+e,1)}return c},stanza_generate_session_info:function(a,b,c){try{var d=b.appendChild(a.buildNode(c.info,{xmlns:NS_JINGLE_APPS_RTP_INFO}));switch(c.info){case JSJAC_JINGLE_SESSION_INFO_MUTE:case JSJAC_JINGLE_SESSION_INFO_UNMUTE:this.stanza_set_attribute(d,"creator",this.parent.get_creator_this()),this.stanza_set_attribute(d,"name",c.name)}}catch(e){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_generate_session_info > "+e,1)}},stanza_generate_content_local:function(a,b,c){try{var d,e=c?c:this.parent.get_content_local(),f=this,g=function(b,c,d){var e=f.stanza_build_node(a,b,[c.attrs],"transport",d);f.stanza_build_node(a,e,[c.fingerprint],"fingerprint",NS_JINGLE_APPS_DTLS,"value"),f.stanza_build_node(a,e,c.candidate,"candidate",d)};for(d in e){var h=e[d],i=b.appendChild(a.buildNode("content",{xmlns:NS_JINGLE}));if(this.stanza_set_attribute(i,"creator",h.creator),this.stanza_set_attribute(i,"name",h.name),this.stanza_set_attribute(i,"senders",h.senders),this.stanza_get_attribute(b,"action")!=JSJAC_JINGLE_ACTION_TRANSPORT_INFO){var j=h.description,k=j.attrs,l=j["rtcp-fb"],m=j.bandwidth,n=j.payload,o=j.encryption,p=j.ssrc,q=j["ssrc-group"],r=j["rtp-hdrext"],s=j["rtcp-mux"],t=this.stanza_build_node(a,i,[k],"description",NS_JINGLE_APPS_RTP);if(n){var u,v,w,x,y,z;for(u in n)y=n[u],z=this.stanza_build_node(a,t,[y.attrs],"payload-type",NS_JINGLE_APPS_RTP),this.stanza_build_node(a,z,y.parameter,"parameter",NS_JINGLE_APPS_RTP),this.stanza_build_node(a,z,y["rtcp-fb"],"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB),this.stanza_build_node(a,z,y["rtcp-fb-trr-int"],"rtcp-fb-trr-int",NS_JINGLE_APPS_RTP_RTCP_FB);if(q)for(x in q)for(v in q[x]){var A=t.appendChild(a.buildNode("ssrc-group",{semantics:x,xmlns:NS_JINGLE_APPS_RTP_SSMA}));this.stanza_build_node(a,A,q[x][v].sources,"source",NS_JINGLE_APPS_RTP_SSMA)}if(p)for(w in p){var B=t.appendChild(a.buildNode("source",{ssrc:w,xmlns:NS_JINGLE_APPS_RTP_SSMA}));this.stanza_build_node(a,B,p[w],"parameter",NS_JINGLE_APPS_RTP_SSMA)}if(o&&(o.crypto&&o.crypto.length||o["zrtp-hash"]&&o["zrtp-hash"].length)){var C=t.appendChild(a.buildNode("encryption",{xmlns:NS_JINGLE_APPS_RTP}));this.stanza_set_attribute(C,"required",o.attrs.required||"0"),this.stanza_build_node(a,C,o.crypto,"crypto",NS_JINGLE_APPS_RTP),this.stanza_build_node(a,C,o["zrtp-hash"],"zrtp-hash",NS_JINGLE_APPS_RTP_ZRTP,"value")}this.stanza_build_node(a,t,l,"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB),this.stanza_build_node(a,t,m,"bandwidth",NS_JINGLE_APPS_RTP,"value"),this.stanza_build_node(a,t,r,"rtp-hdrext",NS_JINGLE_APPS_RTP_RTP_HDREXT),s&&t.appendChild(a.buildNode("rtcp-mux",{xmlns:NS_JINGLE_APPS_RTP}))}}var D=this.generate_transport(h.transport);D.ice.candidate.length>0&&g(i,D.ice,NS_JINGLE_TRANSPORTS_ICEUDP),D.raw.candidate.length>0&&g(i,D.raw,NS_JINGLE_TRANSPORTS_RAWUDP)}}catch(E){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_generate_content_local > "+E,1)}},stanza_generate_group_local:function(a,b){try{var c,d,e,f,g,h=this.parent.get_group_local();for(d in h){e=h[d],g=b.appendChild(a.buildNode("group",{xmlns:NS_JINGLE_APPS_GROUPING,semantics:d}));for(c in e)f=e[c],g.appendChild(a.buildNode("content",{xmlns:NS_JINGLE_APPS_GROUPING,name:f}))}}catch(i){this.parent.get_debug().log("[JSJaCJingle:utils] stanza_generate_group_local > "+i,1)}},generate_content:function(a,b,c,d,e){var f={};try{f.creator=a,f.name=b,f.senders=c,f.description={},f.transport={};var g,h=this.object_clone(d.descriptions),i=h.attrs.ptime,j=h.attrs.maxptime;i&&delete h.attrs.ptime,j&&delete h.attrs.maxptime;for(g in h.payload)"attrs"in h.payload[g]||(h.payload[g].attrs={}),h.payload[g].attrs.ptime=i,h.payload[g].attrs.maxptime=j;f.description=h,f.transport.candidate=e,f.transport.attrs={},f.transport.attrs.pwd=d.transports?d.transports.pwd:null,f.transport.attrs.ufrag=d.transports?d.transports.ufrag:null,d.transports&&d.transports.fingerprint&&(f.transport.fingerprint=d.transports.fingerprint)}catch(k){this.parent.get_debug().log("[JSJaCJingle:utils] generate_content > "+k,1)}return f},generate_transport:function(a){var b={ice:{},raw:{}};try{var c,d,e,f,g,h,i={};for(c in JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP)i[JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP[c].n]=1;var j=function(b){b.attrs=a.attrs,b.fingerprint=a.fingerprint,b.candidate=[]};for(d in b)j(b[d]);for(e=0;e<a.candidate.length;e++)if(g=this.object_clone(a.candidate[e]),g.type in JSJAC_JINGLE_SDP_CANDIDATE_TYPES){if(JSJAC_JINGLE_SDP_CANDIDATE_TYPES[g.type]===JSJAC_JINGLE_SDP_CANDIDATE_METHOD_RAW)for(f in g)"undefined"==typeof i[f]&&delete g[f];h=b[JSJAC_JINGLE_SDP_CANDIDATE_TYPES[g.type]],h.candidate.push(g)}}catch(k){this.parent.get_debug().log("[JSJaCJingle:utils] generate_transport > "+k,1)}return b},build_content_local:function(){try{var a;for(a in this.parent.get_name())this.parent.set_content_local(a,this.generate_content(JSJAC_JINGLE_SENDERS_INITIATOR.jingle,a,this.parent.get_senders(a),this.parent.get_payloads_local(a),this.parent.get_candidates_local(a)))}catch(b){this.parent.get_debug().log("[JSJaCJingle:utils] build_content_local > "+b,1)}},build_content_remote:function(){try{var a;for(a in this.parent.get_name())this.parent.set_content_remote(a,this.generate_content(this.parent.get_creator(a),a,this.parent.get_senders(a),this.parent.get_payloads_remote(a),this.parent.get_candidates_remote(a)))}catch(b){this.parent.get_debug().log("[JSJaCJingle:utils] build_content_remote > "+b,1)}},name_generate:function(a){var b=null;try{var c,d,e=[this.parent.get_content_remote(),this.parent.get_content_local()];for(c in e){for(d in e[c])try{if(e[c][d].description.attrs.media==a){b=d;break}}catch(f){}if(b)break}b||(b=a)}catch(f){this.parent.get_debug().log("[JSJaCJingle:utils] name_generate > "+f,1)}return b},media_generate:function(a){var b,c=null;try{if("number"==typeof a){for(b in JSJAC_JINGLE_MEDIAS)if(a==parseInt(JSJAC_JINGLE_MEDIAS[b].label,10)){c=b;break}}else for(b in JSJAC_JINGLE_MEDIAS)if(a==this.name_generate(b)){c=b;break}c||(c=a)}catch(d){this.parent.get_debug().log("[JSJaCJingle:utils] media_generate > "+d,1)}return c},generate_hash_md5:function(a){return hex_md5(a)},generate_sid:function(){return JSJaCUtils.cnonce(16)},generate_id:function(){return JSJaCUtils.cnonce(10)},generate_constraints:function(){var a={audio:!1,video:!1};try{if(a.audio=!0,a.video=this.parent.get_media()==JSJAC_JINGLE_MEDIA_VIDEO,a.video===!0){switch(this.parent.get_resolution()){case"720":case"hd":a.video={mandatory:{minWidth:1280,minHeight:720,minAspectRatio:1.77}};break;case"360":case"md":a.video={mandatory:{minWidth:640,minHeight:360,minAspectRatio:1.77}};break;case"180":case"sd":a.video={mandatory:{minWidth:320,minHeight:180,minAspectRatio:1.77}};break;case"960":a.video={mandatory:{minWidth:960,minHeight:720}};break;case"640":case"vga":a.video={mandatory:{maxWidth:640,maxHeight:480}};break;case"320":a.video={mandatory:{maxWidth:320,maxHeight:240}}}if(this.parent.get_bandwidth()&&(a.video.optional=[{bandwidth:this.parent.get_bandwidth()}]),this.parent.get_fps()&&(a.video.mandatory.minFrameRate=this.parent.get_fps()),this.parent.get_media()==JSJAC_JINGLE_MEDIA_VIDEO&&this.parent.get_video_source()!=JSJAC_JINGLE_VIDEO_SOURCE_CAMERA){if("https:"!==document.location.protocol&&this.parent.get_debug().log("[JSJaCJingle:utils] generate_constraints > HTTPS might be required to share screen, otherwise you may get a permission denied error.",0),this.browser().name!=JSJAC_JINGLE_BROWSER_CHROME)return this.parent.get_debug().log("[JSJaCJingle:utils] generate_constraints > Video source not supported by "+this.browser().name+" (source: "+this.parent.get_video_source()+").",1),void this.parent.terminate(JSJAC_JINGLE_REASON_MEDIA_ERROR);a.audio=!1,a.video.mandatory={chromeMediaSource:this.parent.get_video_source()}}}}catch(b){this.parent.get_debug().log("[JSJaCJingle:utils] generate_constraints > "+b,1)}return a},is_sdp_common_credentials:function(a){var b=!0;try{var c,d,e;for(c in a){if(e=a[c].transports,"object"==typeof d&&(d.ufrag!==e.ufrag||d.pwd!==e.pwd||JSON.stringify(d.fingerprint)!==JSON.stringify(e.fingerprint))){b=!1;break}d=e}}catch(f){this.parent.get_debug().log("[JSJaCJingle:utils] is_sdp_common_credentials > "+f,1)}return b},network_extract_main:function(a,b){var c,d,e={ip:JSJAC_JINGLE_SDP_CANDIDATE_IP_DEFAULT,port:JSJAC_JINGLE_SDP_CANDIDATE_PORT_DEFAULT,scope:JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_DEFAULT,protocol:JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_DEFAULT};try{var f,g,h,i=function(a,b){var c,d={ip:b.ip,port:b.port};if(b.ip.match(R_NETWORK_IP.all.v4))c=R_NETWORK_IP.lan.v4,d.protocol=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V4;else{if(!b.ip.match(R_NETWORK_IP.all.v6))return;c=R_NETWORK_IP.lan.v6,d.protocol=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V6}if(a===JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST&&b.ip.match(c))d.scope=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_LOCAL;else{if(a!==JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX)return;d.scope=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_REMOTE}return d};for(f in b)g=b[f],(g.id==a||g.label==a)&&(h=this.parent.sdp.parse_candidate(g.candidate),h.type===JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST?"undefined"==typeof c&&(c=i(JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST,h)):h.type===JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX&&"undefined"==typeof d&&(d=i(JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX,h)));"undefined"!=typeof d?e=d:"undefined"!=typeof c&&(e=c)}catch(j){this.parent.get_debug().log("[JSJaCJingle:utils] network_extract_main > "+j,1)}return e},negotiation_status:function(){return this.parent.get_initiator()==this.connection_jid()?JSJAC_JINGLE_SENDERS_INITIATOR.jingle:JSJAC_JINGLE_SENDERS_RESPONDER.jingle},connection_jid:function(){return JSJAC_JINGLE_STORE_CONNECTION.username+"@"+JSJAC_JINGLE_STORE_CONNECTION.domain+"/"+JSJAC_JINGLE_STORE_CONNECTION.resource},map_register_view:function(a){var b={type:null,mute:!1,view:{get:null,set:null},stream:{get:null,set:null}};try{switch(a){case"local":b.type=a,b.mute=!0,b.view.get=this.parent.get_local_view,b.view.set=this.parent.set_local_view,b.stream.get=this.parent.get_local_stream,b.stream.set=this.parent.set_local_stream;break;case"remote":b.type=a,b.view.get=this.parent.get_remote_view,b.view.set=this.parent.set_remote_view,b.stream.get=this.parent.get_remote_stream,b.stream.set=this.parent.set_remote_stream}}catch(c){this.parent.get_debug().log("[JSJaCJingle:utils] map_register_view > "+c,1)}return b},map_unregister_view:function(a){return this.map_register_view(a)}}),JSJaCJingleSDP=ring.create({constructor:function(a){this.parent=a},parse_payload:function(a){var b={};try{if(!a||-1==a.indexOf("\n"))return b;var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S=a.split("\n"),T=null,U=null,V={fingerprint:{},pwd:null,ufrag:null},W=function(a){a in b||(b[a]={})},X=function(a,c,d){W(a),"descriptions"in b[a]||(b[a].descriptions={}),c in b[a].descriptions||(b[a].descriptions[c]=d)},Y=function(a,c,d){W(a),"transports"in b[a]||(b[a].transports={}),c in b[a].transports||(b[a].transports[c]=d)},Z=function(a,c){X(a,"ssrc",{}),c in b[a].descriptions.ssrc||(b[a].descriptions.ssrc[c]=[])},$=function(a,c){X(a,"ssrc-group",{}),c in b[a].descriptions["ssrc-group"]||(b[a].descriptions["ssrc-group"][c]=[])},_=function(a,c){X(a,"payload",{}),c in b[a].descriptions.payload||(b[a].descriptions.payload[c]={attrs:{},parameter:[],"rtcp-fb":[],"rtcp-fb-trr-int":[]})},ab=function(a){X(a,"encryption",{attrs:{required:"1"},crypto:[],"zrtp-hash":[]})};for(d in S)if(g=S[d],O=R_WEBRTC_SDP_ICE_PAYLOAD.media.exec(g))U=O[1],T=this.parent.utils.name_generate(U),X(T,"attrs",{}),b[T].descriptions.attrs.media=U;else if(N=R_WEBRTC_SDP_ICE_PAYLOAD.bandwidth.exec(g)){if(c=0,B={},B.type=N[1]||c++,B.value=N[2]||c++,0!==c)continue;X(T,"bandwidth",[]),b[T].descriptions.bandwidth.push(B)}else if(C=R_WEBRTC_SDP_ICE_PAYLOAD.rtpmap.exec(g)){if(c=0,n={},n.channels=C[6],n.clockrate=C[4],n.id=C[1]||c++,n.name=C[3],0!==c)continue;z=n.id,_(T,z),b[T].descriptions.payload[z].attrs=n}else if(D=R_WEBRTC_SDP_ICE_PAYLOAD.fmtp.exec(g)){if(i=D[1]){j=D[2]?D[2].split(";"):[];for(e in j){if(-1!==j[e].indexOf("="))for(k=j[e].split("="),l=k[0],m=k[1];l.length&&!l[0];)l=l.substring(1);else l=j[e],m=null;c=0,h={},h.name=l||c++,h.value=m,0===c&&(_(T,i),b[T].descriptions.payload[i].parameter.push(h))}}}else if(E=R_WEBRTC_SDP_ICE_PAYLOAD.rtcp_fb.exec(g)){if(c=0,o={},o.id=E[1]||c++,o.type=E[2],o.subtype=E[4],0!==c)continue;A=o.id,"*"==A?(X(T,"rtcp-fb",[]),b[T].descriptions["rtcp-fb"].push(o)):(_(T,A),b[T].descriptions.payload[A]["rtcp-fb"].push(o))}else if(F=R_WEBRTC_SDP_ICE_PAYLOAD.rtcp_fb_trr_int.exec(g)){if(c=0,p={},p.id=F[1]||c++,p.value=F[2]||c++,0!==c)continue;cur_rtcp_fb_trr_int_id=p.id,_(T,cur_rtcp_fb_trr_int_id),b[T].descriptions.payload[cur_rtcp_fb_trr_int_id]["rtcp-fb-trr-int"].push(p)}else if(G=R_WEBRTC_SDP_ICE_PAYLOAD.crypto.exec(g)){if(c=0,q={},q["crypto-suite"]=G[2]||c++,q["key-params"]=G[3]||c++,q["session-params"]=G[5],q.tag=G[1]||c++,0!==c)continue;ab(T),b[T].descriptions.encryption.crypto.push(q)}else if(H=R_WEBRTC_SDP_ICE_PAYLOAD.zrtp_hash.exec(g)){if(c=0,r={},r.version=H[1]||c++,r.value=H[2]||c++,0!==c)continue;ab(T),b[T].descriptions.encryption["zrtp-hash"].push(r)}else if(L=R_WEBRTC_SDP_ICE_PAYLOAD.ptime.exec(g))X(T,"attrs",{}),b[T].descriptions.attrs.ptime=L[1];else if(M=R_WEBRTC_SDP_ICE_PAYLOAD.maxptime.exec(g))X(T,"attrs",{}),b[T].descriptions.attrs.maxptime=M[1];else if(m_ssrc=R_WEBRTC_SDP_ICE_PAYLOAD.ssrc.exec(g)){if(c=0,t={},cur_ssrc_id=m_ssrc[1]||c++,t.name=m_ssrc[2]||c++,t.value=m_ssrc[4],0!==c)continue;Z(T,cur_ssrc_id),b[T].descriptions.ssrc[cur_ssrc_id].push(t),X(T,"attrs",{}),b[T].descriptions.attrs.ssrc=cur_ssrc_id}else if(m_ssrc_group=R_WEBRTC_SDP_ICE_PAYLOAD.ssrc_group.exec(g)){if(c=0,u={},v=m_ssrc_group[1]||c++,w=m_ssrc_group[2]||c++,u.sources=[],w=w.trim()){w=w.split(" ");for(f in w)x=w[f].trim(),x&&u.sources.push({ssrc:x})}if(0===u.sources.length&&c++,0!==c)continue;$(T,v),b[T].descriptions["ssrc-group"][v].push(u)}else if(m_rtcp_mux=R_WEBRTC_SDP_ICE_PAYLOAD.rtcp_mux.exec(g))X(T,"rtcp-mux",1);else if(m_extmap=R_WEBRTC_SDP_ICE_PAYLOAD.extmap.exec(g)){if(c=0,y={},y.id=m_extmap[1]||c++,y.uri=m_extmap[4]||c++,y.senders=m_extmap[3],0!==c)continue;X(T,"rtp-hdrext",[]),b[T].descriptions["rtp-hdrext"].push(y)}else if(I=R_WEBRTC_SDP_ICE_PAYLOAD.fingerprint.exec(g)){if(c=0,s=V.fingerprint||{},s.hash=I[1]||c++,s.value=I[2]||c++,0!==c)continue;Y(T,"fingerprint",s),V.fingerprint=s}else m_setup=R_WEBRTC_SDP_ICE_PAYLOAD.setup.exec(g),m_setup?(s=V.fingerprint||{},s.setup=m_setup[1],s.setup&&(Y(T,"fingerprint",s),V.fingerprint=s)):(J=R_WEBRTC_SDP_ICE_PAYLOAD.pwd.exec(g),J?(Y(T,"pwd",J[1]),V.pwd||(V.pwd=J[1])):(K=R_WEBRTC_SDP_ICE_PAYLOAD.ufrag.exec(g),K?(Y(T,"ufrag",K[1]),V.ufrag||(V.ufrag=K[1])):(P=R_WEBRTC_SDP_CANDIDATE.exec(g),P&&this.parse_candidate_store({media:U,candidate:g}))));for(Q in b)if(this.parent.get_name()[Q]){"object"!=typeof b[Q].transports&&(b[Q].transports={});for(R in V)b[Q].transports[R]||(b[Q].transports[R]=V[R])}else delete b[Q]}catch(bb){this.parent.get_debug().log("[JSJaCJingle:sdp] parse_payload > "+bb,1)}return b},parse_group:function(a){var b={};try{if(!a||-1==a.indexOf("\n"))return b;var c,d,e,f=a.split("\n"),g=function(a){a in b||(b[a]=[])};for(c in f)d=f[c],e=R_WEBRTC_SDP_ICE_PAYLOAD.group.exec(d),e&&e[1]&&e[2]&&(g(e[1]),b[e[1]]=-1===e[2].indexOf(" ")?[e[2]]:e[2].split(" "))}catch(h){this.parent.get_debug().log("[JSJaCJingle:sdp] parse_group > "+h,1)}return b},resolution_payload:function(a){try{if(!a||"object"!=typeof a)return{};if(-1===this.parent.get_media_all().indexOf(JSJAC_JINGLE_MEDIA_VIDEO))return a;var b,c,d,e,f,g,h,i=null,j=null;for(b in this.parent.get_local_view())if("number"==typeof this.parent.get_local_view()[b].videoWidth&&"number"==typeof this.parent.get_local_view()[b].videoHeight&&(i=this.parent.get_local_view()[b].videoHeight,j=this.parent.get_local_view()[b].videoWidth,i&&j))break;if(!i||!j){if(this.parent.get_debug().log("[JSJaCJingle:sdp] resolution_payload > Could not get local video resolution, falling back on constraints (local video may not be ready).",0),h=this.generate_constraints(),"object"!=typeof h.video||"object"!=typeof h.video.mandatory||"number"!=typeof h.video.mandatory.minWidth||"number"!=typeof h.video.mandatory.minHeight)return this.parent.get_debug().log("[JSJaCJingle:sdp] resolution_payload > Could not get local video resolution (not sending it).",1),a;i=h.video.mandatory.minHeight,j=h.video.mandatory.minWidth}g=[{name:"height",value:i},{name:"width",value:j}];for(e in a)if(e==JSJAC_JINGLE_MEDIA_VIDEO){f=a[e].descriptions.payload;for(c in f){"object"!=typeof f[c].parameter&&(f[c].parameter=[]);for(d in g)f[c].parameter.push(g[d])}}this.parent.get_debug().log("[JSJaCJingle:sdp] resolution_payload > Got local video resolution ("+j+"x"+i+").",2)}catch(k){this.parent.get_debug().log("[JSJaCJingle:sdp] resolution_payload > "+k,1)}return a},parse_candidate:function(a){var b={};try{if(!a)return b;var c=0,d=R_WEBRTC_SDP_CANDIDATE.exec(a);if(d&&(b.component=d[2]||c++,b.foundation=d[1]||c++,b.generation=d[16]||JSJAC_JINGLE_GENERATION,b.id=this.parent.utils.generate_id(),b.ip=d[5]||c++,b.network=JSJAC_JINGLE_NETWORK,b.port=d[6]||c++,b.priority=d[4]||c++,b.protocol=d[3]||c++,b["rel-addr"]=d[11],b["rel-port"]=d[13],b.type=d[8]||c++),0!==c)return{}}catch(e){this.parent.get_debug().log("[JSJaCJingle:sdp] parse_candidate > "+e,1)}return b},parse_candidate_store:function(a){var b=a.media,c=a.candidate,d=this.parse_candidate(c);this.parent.set_candidates_local(this.parent.utils.name_generate(b),d),this.parent.set_candidates_queue_local(this.parent.utils.name_generate(b),d)},generate:function(a,b,c,d){try{var e={};return e.candidates=this.generate_candidates(d),e.description=this.generate_description(a,b,c,e.candidates),e}catch(f){this.parent.get_debug().log("[JSJaCJingle:sdp] generate > "+f,1)}return{}},generate_candidates:function(a){var b=[];try{var c,d,e,f,g,h,i,j;for(e in a){f=a[e],d=this.parent.utils.media_generate(e);for(c in f)g=f[c],h=JSJAC_JINGLE_MEDIAS[d].label,i=h,j="",j+="a=candidate:",j+=g.foundation||g.id,j+=" ",j+=g.component,j+=" ",j+=g.protocol||JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_DEFAULT,j+=" ",j+=g.priority||JSJAC_JINGLE_SDP_CANDIDATE_PRIORITY_DEFAULT,j+=" ",j+=g.ip,j+=" ",j+=g.port,g.type&&(j+=" ",j+="typ",j+=" ",j+=g.type),g["rel-addr"]&&g["rel-port"]&&(j+=" ",j+="raddr",j+=" ",j+=g["rel-addr"],j+=" ",j+="rport",j+=" ",j+=g["rel-port"]),g.generation&&(j+=" ",j+="generation",j+=" ",j+=g.generation),j+=WEBRTC_SDP_LINE_BREAK,b.push({label:h,id:i,candidate:j})
}}catch(k){this.parent.get_debug().log("[JSJaCJingle:sdp] generate_candidates > "+k,1)}return b},generate_description:function(a,b,c,d){var e={};try{var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb="",ib=this.parent.utils.is_sdp_common_credentials(c);hb+=this.generate_protocol_version(),hb+=WEBRTC_SDP_LINE_BREAK,hb+=this.generate_origin(),hb+=WEBRTC_SDP_LINE_BREAK,hb+=this.generate_session_name(),hb+=WEBRTC_SDP_LINE_BREAK,hb+=this.generate_timing(),hb+=WEBRTC_SDP_LINE_BREAK;for(y in b){z=b[y],hb+="a=group:"+y;for(q in z)A=z[q],hb+=" "+A;hb+=WEBRTC_SDP_LINE_BREAK}if(ib===!0)for(u in c){D=c[u].transports||{},hb+=this.generate_credentials(D.ufrag,D.pwd,D.fingerprint);break}for(t in c)if(v=c[t],x=this.parent.get_senders(t),w=this.parent.get_name(t)?this.parent.utils.media_generate(t):null){if(B=this.parent.utils.network_extract_main(t,d),C=v.transports||{},F=C.pwd,G=C.ufrag,H=C.fingerprint,E=v.descriptions,I=E.attrs,J=E["rtcp-fb"],K=E.bandwidth,T=E.payload,L=E.encryption,M=E.ssrc,P=E["ssrc-group"],eb=E["rtp-hdrext"],gb=E["rtcp-mux"],hb+=this.generate_description_media(w,B.port,L,H,T),hb+=WEBRTC_SDP_LINE_BREAK,hb+="c="+B.scope+" "+B.protocol+" "+B.ip,hb+=WEBRTC_SDP_LINE_BREAK,hb+="a=rtcp:"+B.port+" "+B.scope+" "+B.protocol+" "+B.ip,hb+=WEBRTC_SDP_LINE_BREAK,ib===!1&&(hb+=this.generate_credentials(G,F,H)),H&&H.setup&&(hb+="a=setup:"+H.setup,hb+=WEBRTC_SDP_LINE_BREAK),eb&&eb.length)for(f in eb)fb=eb[f],hb+="a=extmap:"+fb.id,fb.senders&&(hb+="/"+fb.senders),hb+=" "+fb.uri,hb+=WEBRTC_SDP_LINE_BREAK;if(x&&(hb+="a="+JSJAC_JINGLE_SENDERS[x],hb+=WEBRTC_SDP_LINE_BREAK),w&&JSJAC_JINGLE_MEDIAS[w]&&(hb+="a=mid:"+JSJAC_JINGLE_MEDIAS[w].label,hb+=WEBRTC_SDP_LINE_BREAK),gb&&(hb+="a=rtcp-mux",hb+=WEBRTC_SDP_LINE_BREAK),L){for(h in L.crypto)cb=L.crypto[h],hb+="a=crypto:"+cb.tag+" "+cb["crypto-suite"]+" "+cb["key-params"]+(cb["session-params"]?" "+cb["session-params"]:""),hb+=WEBRTC_SDP_LINE_BREAK;for(n in L["zrtp-hash"])db=L["zrtp-hash"][n],hb+="a=zrtp-hash:"+db.version+" "+db.value,hb+=WEBRTC_SDP_LINE_BREAK}for(l in J)S=J[l],hb+="a=rtcp-fb:*",hb+=" "+S.type,S.subtype&&(hb+=" "+S.subtype),hb+=WEBRTC_SDP_LINE_BREAK;for(o in K)cur_d_bandwidth_obj=K[o],hb+="b="+cur_d_bandwidth_obj.type,hb+=":"+cur_d_bandwidth_obj.value,hb+=WEBRTC_SDP_LINE_BREAK;for(i in T){if(U=T[i],V=U.attrs,X=U.parameter,$=U["rtcp-fb"],ab=U["rtcp-fb-trr-int"],W=V.id,hb+="a=rtpmap:"+W,V.name&&(hb+=" "+V.name,V.clockrate&&(hb+="/"+V.clockrate,V.channels&&(hb+="/"+V.channels))),hb+=WEBRTC_SDP_LINE_BREAK,X.length){hb+="a=fmtp:"+W+" ",Z="";for(m in X)Y=X[m],Z&&(Z+=";"),Z+=Y.name,null!==Y.value&&(Z+="=",Z+=Y.value);hb+=Z,hb+=WEBRTC_SDP_LINE_BREAK}for(j in $)_=$[j],hb+="a=rtcp-fb:"+W,hb+=" "+_.type,_.subtype&&(hb+=" "+_.subtype),hb+=WEBRTC_SDP_LINE_BREAK;for(k in ab)bb=ab[k],hb+="a=rtcp-fb:"+W,hb+=" trr-int",hb+=" "+bb.value,hb+=WEBRTC_SDP_LINE_BREAK}I.ptime&&(hb+="a=ptime:"+I.ptime+WEBRTC_SDP_LINE_BREAK),I.maxptime&&(hb+="a=maxptime:"+I.maxptime+WEBRTC_SDP_LINE_BREAK);for(Q in P)for(r in P[Q]){R=P[Q][r],hb+="a=ssrc-group",hb+=":"+Q;for(s in R.sources)hb+=" "+R.sources[s].ssrc;hb+=WEBRTC_SDP_LINE_BREAK}for(N in M)for(p in M[N])O=M[N][p],hb+="a=ssrc",hb+=":"+N,hb+=" "+O.name,O.value&&(hb+=":"+O.value),hb+=WEBRTC_SDP_LINE_BREAK;if("object"==typeof d)for(g in d)d[g].label==JSJAC_JINGLE_MEDIAS[w].label&&(hb+=d[g].candidate)}e.type=a,e.sdp=hb}catch(jb){this.parent.get_debug().log("[JSJaCJingle:sdp] generate_description > "+jb,1)}return e},generate_protocol_version:function(){return"v=0"},generate_origin:function(){var a="";try{var b=new JSJaCJID(this.parent.get_initiator()),c=b.getNode()?b.getNode():"-",d="1",e="1",f=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_DEFAULT,g=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_DEFAULT,h=JSJAC_JINGLE_SDP_CANDIDATE_IP_DEFAULT;a+="o=",a+=c+" ",a+=d+" ",a+=e+" ",a+=f+" ",a+=g+" ",a+=h}catch(i){this.parent.get_debug().log("[JSJaCJingle:sdp] generate_origin > "+i,1)}return a},generate_session_name:function(){return"s="+(this.parent.get_sid()||"-")},generate_timing:function(){return"t=0 0"},generate_credentials:function(a,b,c){var d="";return a&&(d+="a=ice-ufrag:"+a+WEBRTC_SDP_LINE_BREAK),b&&(d+="a=ice-pwd:"+b+WEBRTC_SDP_LINE_BREAK),c&&c.hash&&c.value&&(d+="a=fingerprint:"+c.hash+" "+c.value,d+=WEBRTC_SDP_LINE_BREAK),d},generate_description_media:function(a,b,c,d,e){var f="";try{var g,h=[];f+="m="+a+" "+b+" ",f+=c&&c.length||d&&d.hash&&d.value?"RTP/SAVPF":"RTP/AVPF";for(g in e)h.push(e[g].attrs.id);f+=" "+h.join(" ")}catch(i){this.parent.get_debug().log("[JSJaCJingle:sdp] generate_description_media > "+i,1)}return f}}),JSJaCJinglePeer=ring.create({constructor:function(a){this.parent=a},connection_create:function(a){this.parent.get_debug().log("[JSJaCJingle:peer] connection_create",4);try{var b,c=this.parent.utils.config_ice();if("object"==typeof c.iceServers)for(b=0;b<c.iceServers.length;b++)this.parent.get_debug().log("[JSJaCJingle:peer] connection_create > Using ICE server at: "+c.iceServers[b].url+" ("+(b+1)+").",2);else this.parent.get_debug().log("[JSJaCJingle:peer] connection_create > No ICE server configured. Network may not work properly.",0);this.parent.set_peer_connection(new WEBRTC_PEER_CONNECTION(c,WEBRTC_CONFIGURATION.peer_connection.constraints));var d=this;if(this.parent.get_peer_connection().onicecandidate=function(b){if(b.candidate)d.parent.sdp.parse_candidate_store({media:isNaN(b.candidate.sdpMid)?b.candidate.sdpMid:d.parent.utils.media_generate(parseInt(b.candidate.sdpMid,10)),candidate:b.candidate.candidate});else{if(d.parent.utils.build_content_local(),d.parent.is_initiator()&&d.parent.get_status()==JSJAC_JINGLE_STATUS_INITIATING||d.parent.is_responder()&&d.parent.get_status()==JSJAC_JINGLE_STATUS_ACCEPTING)d.parent.get_debug().log("[JSJaCJingle:peer] connection_create > onicecandidate > Got initial candidates.",2),a();else{d.parent.get_debug().log("[JSJaCJingle:peer] connection_create > onicecandidate > Got more candidates (on the go).",2);var c=d.parent.get_candidates_queue_local();d.parent.utils.object_length(c)>0&&d.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_TRANSPORT_INFO,candidates:c})}d.parent.set_candidates_queue_local(null)}},this.parent.get_peer_connection().oniceconnectionstatechange=function(){switch(d.parent.get_debug().log("[JSJaCJingle:peer] connection_create > oniceconnectionstatechange",2),this.iceConnectionState){case"disconnected":d.timeout(this.iceConnectionState,{timer:JSJAC_JINGLE_PEER_TIMEOUT_DISCONNECT,reason:JSJAC_JINGLE_REASON_CONNECTIVITY_ERROR});break;case"checking":d.timeout(this.iceConnectionState)}d.parent.get_debug().log("[JSJaCJingle:peer] connection_create > oniceconnectionstatechange > (state: "+this.iceConnectionState+").",2)},this.parent.get_peer_connection().onaddstream=function(a){a&&(d.parent.get_debug().log("[JSJaCJingle:peer] connection_create > onaddstream",2),d.parent.set_remote_stream(a.stream))},this.parent.get_peer_connection().onremovestream=function(){d.parent.get_debug().log("[JSJaCJingle:peer] connection_create > onremovestream",2),d.parent.set_remote_stream(null)},this.parent.get_peer_connection().addStream(this.parent.get_local_stream()),this.parent.get_debug().log("[JSJaCJingle:peer] connection_create > Getting local description...",2),this.parent.is_initiator())this.parent.get_peer_connection().createOffer(this.got_description.bind(this),this.fail_description.bind(this),WEBRTC_CONFIGURATION.create_offer);else{sdp_remote=this.parent.sdp.generate(WEBRTC_SDP_TYPE_OFFER,this.parent.get_group_remote(),this.parent.get_payloads_remote(),this.parent.get_candidates_queue_remote()),this.parent.get_sdp_trace()&&this.parent.get_debug().log("[JSJaCJingle:peer] SDP (remote)\n\n"+sdp_remote.description.sdp,4),this.parent.get_peer_connection().setRemoteDescription(new WEBRTC_SESSION_DESCRIPTION(sdp_remote.description),function(){},function(a){d.parent.get_sdp_trace()&&d.parent.get_debug().log("[JSJaCJingle:peer] SDP (remote:error)\n\n"+(a.message||a.name||"Unknown error"),4),d.parent.terminate(JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS)}),this.parent.get_peer_connection().createAnswer(this.got_description.bind(this),this.fail_description.bind(this),WEBRTC_CONFIGURATION.create_answer);var e,f;for(e in sdp_remote.candidates)f=sdp_remote.candidates[e],this.parent.get_peer_connection().addIceCandidate(new WEBRTC_ICE_CANDIDATE({sdpMLineIndex:f.id,candidate:f.candidate}));this.parent.set_candidates_queue_remote(null)}}catch(g){this.parent.get_debug().log("[JSJaCJingle:peer] connection_create > "+g,1)}},get_user_media:function(a){this.parent.get_debug().log("[JSJaCJingle:peer] get_user_media",4);try{this.parent.get_debug().log("[JSJaCJingle:peer] get_user_media > Getting user media...",2),WEBRTC_GET_MEDIA.bind(navigator)(this.parent.utils.generate_constraints(),this.got_user_media_success.bind(this,a),this.got_user_media_error.bind(this))}catch(b){this.parent.get_debug().log("[JSJaCJingle:peer] get_user_media > "+b,1)}},got_user_media_success:function(a,b){this.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_success",4);try{if(this.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_success > Got user media.",2),this.parent.set_local_stream(b),a&&"function"==typeof a)if(this.parent.get_media()==JSJAC_JINGLE_MEDIA_VIDEO&&this.parent.get_local_view().length){this.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_success > Waiting for local video to be loaded...",2);var c=this,d=function(){c.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_success > Local video loaded.",2),this.removeEventListener("loadeddata",d,!1),a()};c.parent.get_local_view()[0].addEventListener("loadeddata",d,!1)}else a()}catch(e){this.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_success > "+e,1)}},got_user_media_error:function(a){this.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_error",4);try{this.parent.get_session_initiate_error()(this),this.parent.is_initiator()&&this.parent.handle_session_initiate_error(),this.parent.is_responder()&&this.parent.terminate(JSJAC_JINGLE_REASON_MEDIA_ERROR),this.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_error > Failed ("+(a.PERMISSION_DENIED?"permission denied":"unknown")+").",1)}catch(b){this.parent.get_debug().log("[JSJaCJingle:peer] got_user_media_error > "+b,1)}},got_description:function(a){this.parent.get_debug().log("[JSJaCJingle:peer] got_description",4);try{this.parent.get_debug().log("[JSJaCJingle:peer] got_description > Got local description.",2),this.parent.get_sdp_trace()&&this.parent.get_debug().log("[JSJaCJingle:peer] SDP (local:raw)\n\n"+a.sdp,4);var b,c=this.parent.sdp.parse_payload(a.sdp);this.parent.sdp.resolution_payload(c);for(b in c)this.parent.set_payloads_local(b,c[b]);var d,e=this.parent.sdp.parse_group(a.sdp);for(d in e)this.parent.set_group_local(d,e[d]);var f=this.parent.sdp.generate_description(a.type,this.parent.get_group_local(),this.parent.get_payloads_local(),this.parent.sdp.generate_candidates(this.parent.get_candidates_local()));this.parent.get_sdp_trace()&&this.parent.get_debug().log("[JSJaCJingle:peer] SDP (local:gen)\n\n"+f.sdp,4);var g=this;this.parent.get_peer_connection().setLocalDescription(new WEBRTC_SESSION_DESCRIPTION(f),function(){},function(a){g.parent.get_sdp_trace()&&g.parent.get_debug().log("[JSJaCJingle:peer] SDP (local:error)\n\n"+(a.message||a.name||"Unknown error"),4)}),this.parent.get_debug().log("[JSJaCJingle:peer] got_description > Waiting for local candidates...",2)}catch(h){this.parent.get_debug().log("[JSJaCJingle:peer] got_description > "+h,1)}},fail_description:function(){this.parent.get_debug().log("[JSJaCJingle:peer] fail_description",4);try{this.parent.get_debug().log("[JSJaCJingle:peer] fail_description > Could not get local description!",1)}catch(a){this.parent.get_debug().log("[JSJaCJingle:peer] fail_description > "+a,1)}},sound:function(a){this.parent.get_debug().log("[JSJaCJingle:peer] sound",4);try{this.parent.get_debug().log("[JSJaCJingle:peer] sound > Enable: "+a+" (current: "+this.parent.get_mute(JSJAC_JINGLE_MEDIA_AUDIO)+").",2);var b,c=this.parent.get_local_stream().getAudioTracks();for(b=0;b<c.length;b++)c[b].enabled=a}catch(d){this.parent.get_debug().log("[JSJaCJingle:peer] sound > "+d,1)}},timeout:function(a,b){try{"object"!=typeof b&&(b={});var c=this.parent.get_sid(),d=this;setTimeout(function(){d.parent.get_sid()==c&&d.parent.get_peer_connection().iceConnectionState==a&&(d.parent.get_debug().log("[JSJaCJingle:peer] stanza_timeout > Peer timeout.",2),d.parent.terminate(b.reason||JSJAC_JINGLE_REASON_FAILED_TRANSPORT))},1e3*(b.timer||JSJAC_JINGLE_PEER_TIMEOUT_DEFAULT))}catch(e){this.parent.get_debug().log("[JSJaCJingle:peer] timeout > "+e,1)}},stop:function(){this.parent.get_debug().log("[JSJaCJingle:peer] stop",4),this.parent.set_local_stream(null),this.parent.set_remote_stream(null),this.parent.get_peer_connection()&&this.parent.get_peer_connection().close(),JSJaCJingle.remove(this.parent.get_sid())},stream_attach:function(a,b,c){try{var d,e=b?URL.createObjectURL(b):"";for(d in a)a[d].src=e,navigator.mozGetUserMedia?a[d].play():a[d].autoplay=!0,"boolean"==typeof c&&(a[d].muted=c)}catch(f){this.parent.get_debug().log("[JSJaCJingle:peer] stream_attach > "+f,1)}},stream_detach:function(a){try{var b;for(b in a)a[b].pause(),a[b].src=""}catch(c){this.parent.get_debug().log("[JSJaCJingle:peer] stream_detach > "+c,1)}}}),__JSJaCJingleBase=ring.create({constructor:function(a){this.utils=new JSJaCJingleUtils(this),this.sdp=new JSJaCJingleSDP(this),this.peer=new JSJaCJinglePeer(this),a&&a.session_initiate_pending&&(this._session_initiate_pending=a.session_initiate_pending),a&&a.session_initiate_success&&(this._session_initiate_success=a.session_initiate_success),a&&a.session_initiate_error&&(this._session_initiate_error=a.session_initiate_error),a&&a.session_initiate_request&&(this._session_initiate_request=a.session_initiate_request),a&&a.session_accept_pending&&(this._session_accept_pending=a.session_accept_pending),a&&a.session_accept_success&&(this._session_accept_success=a.session_accept_success),a&&a.session_accept_error&&(this._session_accept_error=a.session_accept_error),a&&a.session_accept_request&&(this._session_accept_request=a.session_accept_request),a&&a.session_info_success&&(this._session_info_success=a.session_info_success),a&&a.session_info_error&&(this._session_info_error=a.session_info_error),a&&a.session_info_request&&(this._session_info_request=a.session_info_request),a&&a.session_terminate_pending&&(this._session_terminate_pending=a.session_terminate_pending),a&&a.session_terminate_success&&(this._session_terminate_success=a.session_terminate_success),a&&a.session_terminate_error&&(this._session_terminate_error=a.session_terminate_error),a&&a.session_terminate_request&&(this._session_terminate_request=a.session_terminate_request),a&&a.to&&(this._to=a.to),a&&a.media&&(this._media=a.media),a&&a.video_source&&(this._video_source=a.video_source),a&&a.resolution&&(this._resolution=a.resolution),a&&a.bandwidth&&(this._bandwidth=a.bandwidth),a&&a.fps&&(this._fps=a.fps),a&&a.local_view&&(this._local_view=[a.local_view]),a&&a.remote_view&&(this._remote_view=[a.remote_view]),this._stun=a&&a.stun?a.stun:{},this._turn=a&&a.turn?a.turn:{},a&&a.sdp_trace&&(this._sdp_trace=a.sdp_trace),a&&a.net_trace&&(this._net_trace=a.net_trace),this._debug=a&&a.debug&&a.debug.log?a.debug:JSJAC_JINGLE_STORE_DEBUG,this._local_stream=null,this._remote_stream=null,this._content_local={},this._content_remote={},this._payloads_local=[],this._group_local={},this._candidates_local={},this._candidates_queue_local={},this._payloads_remote={},this._group_remote={},this._candidates_remote={},this._candidates_queue_remote={},this._initiator="",this._responder="",this._mute={},this._lock=!1,this._media_busy=!1,this._sid="",this._name={},this._senders={},this._creator={},this._status=JSJAC_JINGLE_STATUS_INACTIVE,this._reason=JSJAC_JINGLE_REASON_CANCEL,this._handlers={},this._peer_connection=null,this._id=0,this._sent_id={},this._received_id={}},get_session_initiate_pending:function(){return"function"==typeof this._session_initiate_pending?this._session_initiate_pending:function(){}},get_session_initiate_success:function(){return"function"==typeof this._session_initiate_success?this._session_initiate_success:function(){}},get_session_initiate_error:function(){return"function"==typeof this._session_initiate_error?this._session_initiate_error:function(){}},get_session_initiate_request:function(){return"function"==typeof this._session_initiate_request?this._session_initiate_request:function(){}},get_session_accept_pending:function(){return"function"==typeof this._session_accept_pending?this._session_accept_pending:function(){}},get_session_accept_success:function(){return"function"==typeof this._session_accept_success?this._session_accept_success:function(){}},get_session_accept_error:function(){return"function"==typeof this._session_accept_error?this._session_accept_error:function(){}},get_session_accept_request:function(){return"function"==typeof this._session_accept_request?this._session_accept_request:function(){}},get_session_info_success:function(){return"function"==typeof this._session_info_success?this._session_info_success:function(){}},get_session_info_error:function(){return"function"==typeof this._session_info_error?this._session_info_error:function(){}},get_session_info_request:function(){return"function"==typeof this._session_info_request?this._session_info_request:function(){}},get_session_terminate_pending:function(){return"function"==typeof this._session_terminate_pending?this._session_terminate_pending:function(){}},get_session_terminate_success:function(){return"function"==typeof this._session_terminate_success?this._session_terminate_success:function(){}},get_session_terminate_error:function(){return"function"==typeof this._session_terminate_error?this._session_terminate_error:function(){}},get_session_terminate_request:function(){return"function"==typeof this._session_terminate_request?this._session_terminate_request:function(){}},get_local_stream:function(){return this._local_stream},get_remote_stream:function(){return this._remote_stream},get_payloads_local:function(a){return a?a in this._payloads_local?this._payloads_local[a]:{}:this._payloads_local},get_group_local:function(a){return a?a in this._group_local?this._group_local[a]:{}:this._group_local},get_candidates_local:function(a){return a?a in this._candidates_local?this._candidates_local[a]:{}:this._candidates_local},get_candidates_queue_local:function(a){return a?a in this._candidates_queue_local?this._candidates_queue_local[a]:{}:this._candidates_queue_local},get_payloads_remote:function(a){return a?a in this._payloads_remote?this._payloads_remote[a]:{}:this._payloads_remote},get_group_remote:function(a){return a?a in this._group_remote?this._group_remote[a]:{}:this._group_remote},get_candidates_remote:function(a){return a?a in this._candidates_remote?this._candidates_remote[a]:[]:this._candidates_remote},get_candidates_queue_remote:function(a){return a?a in this._candidates_queue_remote?this._candidates_queue_remote[a]:{}:this._candidates_queue_remote},get_content_local:function(a){return a?a in this._content_local?this._content_local[a]:{}:this._content_local},get_content_remote:function(a){return a?a in this._content_remote?this._content_remote[a]:{}:this._content_remote},get_handlers:function(a,b){if(a=a||JSJAC_JINGLE_STANZA_TYPE_ALL,b){if(a!=JSJAC_JINGLE_STANZA_TYPE_ALL&&a in this._handlers&&"function"==typeof this._handlers[a][b])return this._handlers[a][b];if(JSJAC_JINGLE_STANZA_TYPE_ALL in this._handlers&&"function"==typeof this._handlers[JSJAC_JINGLE_STANZA_TYPE_ALL][b])return this._handlers[a][b]}return null},get_peer_connection:function(){return this._peer_connection},get_id:function(){return this._id},get_id_pre:function(){return JSJAC_JINGLE_STANZA_ID_PRE+"_"+(this.get_sid()||"0")+"_"},get_id_new:function(){var a=this.get_id()+1;return this.set_id(a),this.get_id_pre()+a},get_sent_id:function(){return this._sent_id},get_received_id:function(){return this._received_id},get_mute:function(a){return a||(a="*"),a in this._mute?this._mute[a]:!1},get_lock:function(){return this._lock||!JSJAC_JINGLE_AVAILABLE},get_media_busy:function(){return this._media_busy},get_sid:function(){return this._sid},get_status:function(){return this._status},get_reason:function(){return this._reason},get_to:function(){return this._to},get_media:function(){return this._media&&this._media in JSJAC_JINGLE_MEDIAS?this._media:JSJAC_JINGLE_MEDIA_VIDEO},get_media_all:function(){return this.get_media()==JSJAC_JINGLE_MEDIA_AUDIO?[JSJAC_JINGLE_MEDIA_AUDIO]:[JSJAC_JINGLE_MEDIA_AUDIO,JSJAC_JINGLE_MEDIA_VIDEO]},get_video_source:function(){return this._video_source&&this._video_source in JSJAC_JINGLE_VIDEO_SOURCES?this._video_source:JSJAC_JINGLE_VIDEO_SOURCE_CAMERA},get_resolution:function(){return this._resolution?this._resolution.toString():null},get_bandwidth:function(){return this._bandwidth?this._bandwidth.toString():null},get_fps:function(){return this._fps?this._fps.toString():null},get_name:function(a){return a?a in this._name:this._name},get_senders:function(a){return a?a in this._senders?this._senders[a]:null:this._senders},get_creator:function(a){return a?a in this._creator?this._creator[a]:null:this._creator},get_creator_this:function(){return this.get_responder()==this.get_to()?JSJAC_JINGLE_CREATOR_INITIATOR:JSJAC_JINGLE_CREATOR_RESPONDER},get_initiator:function(){return this._initiator},get_responder:function(){return this._responder},get_local_view:function(){return"object"==typeof this._local_view?this._local_view:[]},get_remote_view:function(){return"object"==typeof this._remote_view?this._remote_view:[]},get_stun:function(){return"object"==typeof this._stun?this._stun:{}},get_turn:function(){return"object"==typeof this._turn?this._turn:{}},get_sdp_trace:function(){return this._sdp_trace===!0},get_net_trace:function(){return this._net_trace===!0},get_debug:function(){return this._debug},set_session_initiate_pending:function(a){this._session_initiate_pending=a},set_initiate_success:function(a){this._session_initiate_success=a},set_initiate_error:function(a){this._session_initiate_error=a},set_initiate_request:function(a){this._session_initiate_request=a},set_accept_pending:function(a){this._session_accept_pending=a},set_accept_success:function(a){this._session_accept_success=a},set_accept_error:function(a){this._session_accept_error=a},set_accept_request:function(a){this._session_accept_request=a},set_info_success:function(a){this._session_info_success=a},set_info_error:function(a){this._session_info_error=a},set_info_request:function(a){this._session_info_request=a},set_terminate_pending:function(a){this._session_terminate_pending=a},set_terminate_success:function(a){this._session_terminate_success=a},set_terminate_error:function(a){this._session_terminate_error=a},set_terminate_request:function(a){this._session_terminate_request=a},set_local_stream:function(a){try{!a&&this._local_stream&&(this._local_stream.stop(),this.peer.stream_detach(this.get_local_view())),this._local_stream=a,a?this.peer.stream_attach(this.get_local_view(),this.get_local_stream(),!0):this.peer.stream_detach(this.get_local_view())}catch(b){this.get_debug().log("[JSJaCJingle:base] set_local_stream > "+b,1)}},set_remote_stream:function(a){try{!a&&this._remote_stream&&this.peer.stream_detach(this.get_remote_view()),this._remote_stream=a,a?this.peer.stream_attach(this.get_remote_view(),this.get_remote_stream(),!1):this.peer.stream_detach(this.get_remote_view())}catch(b){this.get_debug().log("[JSJaCJingle:base] set_remote_stream > "+b,1)}},set_local_view:function(a){"object"!=typeof this._local_view&&(this._local_view=[]),this._local_view.push(a)},set_remote_view:function(a){"object"!=typeof this._remote_view&&(this._remote_view=[]),this._remote_view.push(a)},set_payloads_local:function(a,b){this._payloads_local[a]=b},set_group_local:function(a,b){this._group_local[a]=b},set_candidates_local:function(a,b){a in this._candidates_local||(this._candidates_local[a]=[]),this._candidates_local[a].push(b)},set_candidates_queue_local:function(a,b){try{null===a?this._candidates_queue_local={}:(a in this._candidates_queue_local||(this._candidates_queue_local[a]=[]),this._candidates_queue_local[a].push(b))}catch(c){this.get_debug().log("[JSJaCJingle:base] set_candidates_queue_local > "+c,1)}},set_payloads_remote:function(a,b){this._payloads_remote[a]=b},set_payloads_remote_add:function(a,b){try{if(a in this._payloads_remote){var c,d=this._payloads_remote[a].descriptions.payload,e=b.descriptions.payload;for(c in e)c in d||(d[c]=e[c])}else this.set_payloads_remote(a,b)}catch(f){this.get_debug().log("[JSJaCJingle:base] set_payloads_remote_add > "+f,1)}},set_group_remote:function(a,b){this._group_remote[a]=b},set_candidates_remote:function(a,b){this._candidates_remote[a]=b},set_candidates_queue_remote:function(a,b){null===a?this._candidates_queue_remote={}:this._candidates_queue_remote[a]=b},set_candidates_remote_add:function(a,b){try{if(!a)return;a in this._candidates_remote||this.set_candidates_remote(a,[]);var c,d,e=[];for(c in this.get_candidates_remote(a))e.push(this.get_candidates_remote(a)[c].id);for(d in b)-1!==b[d].id.indexOf(e)&&this.get_candidates_remote(a).push(b[d])}catch(f){this.get_debug().log("[JSJaCJingle:base] set_candidates_remote_add > "+f,1)}},set_content_local:function(a,b){this._content_local[a]=b},set_content_remote:function(a,b){this._content_remote[a]=b},set_handlers:function(a,b,c){a in this._handlers||(this._handlers[a]={}),this._handlers[a][b]=c},set_peer_connection:function(a){this._peer_connection=a},set_id:function(a){this._id=a},set_sent_id:function(a){this._sent_id[a]=1},set_received_id:function(a){this._received_id[a]=1},set_mute:function(a,b){a&&"*"!=a||(this._mute={},a="*"),this._mute[a]=b},set_lock:function(a){this._lock=a},set_media_busy:function(a){this._media_busy=a},set_sid:function(a){this._sid=a},set_status:function(a){this._status=a},set_reason:function(a){this._reason=a||JSJAC_JINGLE_REASON_CANCEL},set_to:function(a){this._to=a},set_media:function(a){this._media=a},set_video_source:function(){this._video_source=video_source},set_resolution:function(a){this._resolution=a},set_bandwidth:function(a){this._bandwidth=a},set_fps:function(a){this._fps=a},set_name:function(a){this._name[a]=1},set_senders:function(a,b){b in JSJAC_JINGLE_SENDERS||(b=JSJAC_JINGLE_SENDERS_BOTH.jingle),this._senders[a]=b},set_creator:function(a,b){b in JSJAC_JINGLE_CREATORS||(b=JSJAC_JINGLE_CREATOR_INITIATOR),this._creator[a]=b},set_initiator:function(a){this._initiator=a},set_responder:function(a){this._responder=a},set_stun:function(a,b){this._stun[stun_server]=b},set_turn:function(a,b){this._turn[turn_server]=b},set_sdp_trace:function(a){this._sdp_trace=a},set_net_trace:function(a){this._net_trace=a},set_debug:function(a){this._debug=a},is_responder:function(){return this.utils.negotiation_status()==JSJAC_JINGLE_SENDERS_RESPONDER.jingle},is_initiator:function(){return this.utils.negotiation_status()==JSJAC_JINGLE_SENDERS_INITIATOR.jingle}}),JSJaCJingleSingle=ring.create([__JSJaCJingleBase],{constructor:function(a){this.$super(a)},initiate:function(){this.get_debug().log("[JSJaCJingle:single] initiate",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] initiate > Cannot initiate, resource locked. Please open another session or check WebRTC support.",0);var a=this;if(JSJaCJingle.defer(function(){a.initiate()}))return void this.get_debug().log("[JSJaCJingle:single] initiate > Deferred (waiting for the library components to be initiated).",0);if(this.get_status()!=JSJAC_JINGLE_STATUS_INACTIVE)return void this.get_debug().log("[JSJaCJingle:single] initiate > Cannot initiate, resource not inactive (status: "+this.get_status()+").",0);this.get_debug().log("[JSJaCJingle:single] initiate > New Jingle Single session with media: "+this.get_media(),2);var b,c;this.get_session_initiate_pending()(this),this.set_status(JSJAC_JINGLE_STATUS_INITIATING),this.set_sid(this.utils.generate_sid()),this.set_initiator(this.utils.connection_jid()),this.set_responder(this.get_to());for(b in this.get_media_all())c=this.utils.name_generate(this.get_media_all()[b]),this.set_name(c),this.set_senders(c,JSJAC_JINGLE_SENDERS_BOTH.jingle),this.set_creator(c,JSJAC_JINGLE_CREATOR_INITIATOR);JSJaCJingle.add(this.get_sid(),this),this.peer.get_user_media(function(){a.peer.connection_create(function(){a.get_debug().log("[JSJaCJingle:single] initiate > Ready to begin Jingle negotiation.",2),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_INITIATE})})})}catch(d){this.get_debug().log("[JSJaCJingle:single] initiate > "+d,1)}},accept:function(){this.get_debug().log("[JSJaCJingle:single] accept",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] accept > Cannot accept, resource locked. Please open another session or check WebRTC support.",0);var a=this;if(JSJaCJingle.defer(function(){a.accept()}))return void this.get_debug().log("[JSJaCJingle:single] accept > Deferred (waiting for the library components to be initiated).",0);if(this.get_status()!=JSJAC_JINGLE_STATUS_INITIATED)return void this.get_debug().log("[JSJaCJingle:single] accept > Cannot accept, resource not initiated (status: "+this.get_status()+").",0);this.get_debug().log("[JSJaCJingle:single] accept > New Jingle session with media: "+this.get_media(),2),this.get_session_accept_pending()(this),this.set_status(JSJAC_JINGLE_STATUS_ACCEPTING),this.peer.get_user_media(function(){a.peer.connection_create(function(){a.get_debug().log("[JSJaCJingle:single] accept > Ready to complete Jingle negotiation.",2),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_ACCEPT})})})}catch(b){this.get_debug().log("[JSJaCJingle:single] accept > "+b,1)}},info:function(a,b){this.get_debug().log("[JSJaCJingle:single] info",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] info > Cannot accept, resource locked. Please open another session or check WebRTC support.",0);var c=this;if(JSJaCJingle.defer(function(){c.info(a,b)}))return void this.get_debug().log("[JSJaCJingle:single] info > Deferred (waiting for the library components to be initiated).",0);if(this.get_status()!=JSJAC_JINGLE_STATUS_INITIATED&&this.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING&&this.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTED)return void this.get_debug().log("[JSJaCJingle:single] info > Cannot send info, resource not active (status: "+this.get_status()+").",0);"object"!=typeof b&&(b={}),b.action=JSJAC_JINGLE_ACTION_SESSION_INFO,a&&(b.info=a),this.send(JSJAC_JINGLE_STANZA_TYPE_SET,b)}catch(d){this.get_debug().log("[JSJaCJingle:single] info > "+d,1)}},terminate:function(a){this.get_debug().log("[JSJaCJingle:single] terminate",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] terminate > Cannot terminate, resource locked. Please open another session or check WebRTC support.",0);var b=this;if(JSJaCJingle.defer(function(){b.terminate(a)}))return void this.get_debug().log("[JSJaCJingle:single] terminate > Deferred (waiting for the library components to be initiated).",0);if(this.get_status()==JSJAC_JINGLE_STATUS_TERMINATED)return void this.get_debug().log("[JSJaCJingle:single] terminate > Cannot terminate, resource already terminated (status: "+this.get_status()+").",0);this.set_status(JSJAC_JINGLE_STATUS_TERMINATING),this.get_session_terminate_pending()(this),this.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_TERMINATE,reason:a})}catch(c){this.get_debug().log("[JSJaCJingle:single] terminate > "+c,1)}},send:function(a,b){this.get_debug().log("[JSJaCJingle:single] send",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] send > Cannot send, resource locked. Please open another session or check WebRTC support.",0);
var c=this;if(JSJaCJingle.defer(function(){c.send(a,b)}))return void this.get_debug().log("[JSJaCJingle:single] send > Deferred (waiting for the library components to be initiated).",0);"object"!=typeof b&&(b={});var d=new JSJaCIQ;if(d.setTo(this.get_to()),a&&d.setType(a),b.id||(b.id=this.get_id_new()),d.setID(b.id),a==JSJAC_JINGLE_STANZA_TYPE_SET){if(!(b.action&&b.action in JSJAC_JINGLE_ACTIONS))return void this.get_debug().log("[JSJaCJingle:single] send > Stanza action unknown: "+(b.action||"undefined"),1);switch(this.set_sent_id(b.id),b.action){case JSJAC_JINGLE_ACTION_CONTENT_ACCEPT:this.send_content_accept(d);break;case JSJAC_JINGLE_ACTION_CONTENT_ADD:this.send_content_add(d);break;case JSJAC_JINGLE_ACTION_CONTENT_MODIFY:this.send_content_modify(d);break;case JSJAC_JINGLE_ACTION_CONTENT_REJECT:this.send_content_reject(d);break;case JSJAC_JINGLE_ACTION_CONTENT_REMOVE:this.send_content_remove(d);break;case JSJAC_JINGLE_ACTION_DESCRIPTION_INFO:this.send_description_info(d);break;case JSJAC_JINGLE_ACTION_SECURITY_INFO:this.send_security_info(d);break;case JSJAC_JINGLE_ACTION_SESSION_ACCEPT:this.send_session_accept(d,b);break;case JSJAC_JINGLE_ACTION_SESSION_INFO:this.send_session_info(d,b);break;case JSJAC_JINGLE_ACTION_SESSION_INITIATE:this.send_session_initiate(d,b);break;case JSJAC_JINGLE_ACTION_SESSION_TERMINATE:this.send_session_terminate(d,b);break;case JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT:this.send_transport_accept(d);break;case JSJAC_JINGLE_ACTION_TRANSPORT_INFO:this.send_transport_info(d,b);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REJECT:this.send_transport_reject(d);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE:this.send_transport_replace(d);break;default:return this.get_debug().log("[JSJaCJingle:single] send > Unexpected error.",1),!1}}else if(a!=JSJAC_JINGLE_STANZA_TYPE_RESULT)return this.get_debug().log("[JSJaCJingle:single] send > Stanza type must either be set or result.",1),!1;return JSJAC_JINGLE_STORE_CONNECTION.send(d),this.get_net_trace()&&this.get_debug().log("[JSJaCJingle:single] Outgoing packet sent\n\n"+d.xml()),!0}catch(e){this.get_debug().log("[JSJaCJingle:single] send > "+e,1)}return!1},handle:function(a){this.get_debug().log("[JSJaCJingle:single] handle",4);try{if(this.get_net_trace()&&this.get_debug().log("[JSJaCJingle:single] Incoming packet received\n\n"+a.xml()),this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] handle > Cannot handle, resource locked. Please open another session or check WebRTC support.",0);var b=this;if(JSJaCJingle.defer(function(){b.handle(a)}))return void this.get_debug().log("[JSJaCJingle:single] handle > Deferred (waiting for the library components to be initiated).",0);var c=a.getID(),d=a.getType();if(c&&d==JSJAC_JINGLE_STANZA_TYPE_RESULT&&this.set_received_id(c),"function"==typeof this.get_handlers(d,c))return this.get_debug().log("[JSJaCJingle:single] handle > Submitted to custom handler.",2),this.get_handlers(d,c)(a),void this.unregister_handler(d,c);var e=this.utils.stanza_jingle(a);if(!e)return;var f=this.utils.stanza_get_attribute(e,"action");if(!f)return;switch(f){case JSJAC_JINGLE_ACTION_CONTENT_ACCEPT:this.handle_content_accept(a);break;case JSJAC_JINGLE_ACTION_CONTENT_ADD:this.handle_content_add(a);break;case JSJAC_JINGLE_ACTION_CONTENT_MODIFY:this.handle_content_modify(a);break;case JSJAC_JINGLE_ACTION_CONTENT_REJECT:this.handle_content_reject(a);break;case JSJAC_JINGLE_ACTION_CONTENT_REMOVE:this.handle_content_remove(a);break;case JSJAC_JINGLE_ACTION_DESCRIPTION_INFO:this.handle_description_info(a);break;case JSJAC_JINGLE_ACTION_SECURITY_INFO:this.handle_security_info(a);break;case JSJAC_JINGLE_ACTION_SESSION_ACCEPT:this.handle_session_accept(a);break;case JSJAC_JINGLE_ACTION_SESSION_INFO:this.handle_session_info(a);break;case JSJAC_JINGLE_ACTION_SESSION_INITIATE:this.handle_session_initiate(a);break;case JSJAC_JINGLE_ACTION_SESSION_TERMINATE:this.handle_session_terminate(a);break;case JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT:this.handle_transport_accept(a);break;case JSJAC_JINGLE_ACTION_TRANSPORT_INFO:this.handle_transport_info(a);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REJECT:this.handle_transport_reject(a);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE:this.handle_transport_replace(a)}}catch(g){this.get_debug().log("[JSJaCJingle:single] handle > "+g,1)}},mute:function(a){this.get_debug().log("[JSJaCJingle:single] mute",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] mute > Cannot mute, resource locked. Please open another session or check WebRTC support.",0);var b=this;if(JSJaCJingle.defer(function(){b.mute(a)}))return void this.get_debug().log("[JSJaCJingle:single] mute > Deferred (waiting for the library components to be initiated).",0);if(this.get_mute(a))return void this.get_debug().log("[JSJaCJingle:single] mute > Resource already muted.",0);this.peer.sound(!1),this.set_mute(a,!0),this.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_INFO,info:JSJAC_JINGLE_SESSION_INFO_MUTE,name:a})}catch(c){this.get_debug().log("[JSJaCJingle:single] mute > "+c,1)}},unmute:function(a){this.get_debug().log("[JSJaCJingle:single] unmute",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] unmute > Cannot unmute, resource locked. Please open another session or check WebRTC support.",0);var b=this;if(JSJaCJingle.defer(function(){b.unmute(a)}))return void this.get_debug().log("[JSJaCJingle:single] unmute > Deferred (waiting for the library components to be initiated).",0);if(!this.get_mute(a))return void this.get_debug().log("[JSJaCJingle:single] unmute > Resource already unmuted.",0);this.peer.sound(!0),this.set_mute(a,!1),this.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_INFO,info:JSJAC_JINGLE_SESSION_INFO_UNMUTE,name:a})}catch(c){this.get_debug().log("[JSJaCJingle:single] unmute > "+c,1)}},media:function(a){this.get_debug().log("[JSJaCJingle:single] media",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:single] media > Cannot change media, resource locked. Please open another session or check WebRTC support.",0);var b=this;if(JSJaCJingle.defer(function(){b.media(a)}))return void this.get_debug().log("[JSJaCJingle:single] media > Deferred (waiting for the library components to be initiated).",0);if(a||(a=this.get_media()==JSJAC_JINGLE_MEDIA_VIDEO?JSJAC_JINGLE_MEDIA_AUDIO:JSJAC_JINGLE_MEDIA_VIDEO),!(a in JSJAC_JINGLE_MEDIAS))return void this.get_debug().log("[JSJaCJingle:single] media > No media provided or media unsupported (media: "+a+").",0);if(this.get_media()==a)return void this.get_debug().log("[JSJaCJingle:single] media > Resource already using this media (media: "+a+").",0);if(this.get_media_busy())return void this.get_debug().log("[JSJaCJingle:single] media > Resource already busy switching media (busy: "+this.get_media()+", media: "+a+").",0);this.get_debug().log("[JSJaCJingle:single] media > Changing media to: "+a+"...",2),this.set_media(a),this.set_media_busy(!0)}catch(c){this.get_debug().log("[JSJaCJingle:single] media > "+c,1)}},register_handler:function(a,b,c){this.get_debug().log("[JSJaCJingle:single] register_handler",4);try{return a=a||JSJAC_JINGLE_STANZA_TYPE_ALL,"function"!=typeof c?(this.get_debug().log("[JSJaCJingle:single] register_handler > fn parameter not passed or not a function!",1),!1):b?(this.set_handlers(a,b,c),this.get_debug().log("[JSJaCJingle:single] register_handler > Registered handler for id: "+b+" and type: "+a,3),!0):(this.get_debug().log("[JSJaCJingle:single] register_handler > Could not register handler (no ID).",1),!1)}catch(d){this.get_debug().log("[JSJaCJingle:single] register_handler > "+d,1)}return!1},unregister_handler:function(a,b){this.get_debug().log("[JSJaCJingle:single] unregister_handler",4);try{return a=a||JSJAC_JINGLE_STANZA_TYPE_ALL,a in this._handlers&&b in this._handlers[a]?(delete this._handlers[a][b],this.get_debug().log("[JSJaCJingle:single] unregister_handler > Unregistered handler for id: "+b+" and type: "+a,3),!0):(this.get_debug().log("[JSJaCJingle:single] unregister_handler > Could not unregister handler with id: "+b+" and type: "+a+" (not found).",2),!1)}catch(c){this.get_debug().log("[JSJaCJingle:single] unregister_handler > "+c,1)}return!1},register_view:function(a,b){this.get_debug().log("[JSJaCJingle:single] register_view",4);try{var c=this.utils.map_register_view(a);if(c.type==a){var d;for(d in c.view.get())if(c.view.get()[d]==b)return this.get_debug().log("[JSJaCJingle:single] register_view > Could not register view of type: "+a+" (already registered).",2),!0;return c.view.set(b),this.utils.peer_stream_attach([b],c.stream.get(),c.mute),this.get_debug().log("[JSJaCJingle:single] register_view > Registered view of type: "+a,3),!0}return this.get_debug().log("[JSJaCJingle:single] register_view > Could not register view of type: "+a+" (type unknown).",1),!1}catch(e){this.get_debug().log("[JSJaCJingle:single] register_view > "+e,1)}return!1},unregister_view:function(a,b){this.get_debug().log("[JSJaCJingle:single] unregister_view",4);try{var c=this.utils.map_unregister_view(a);if(c.type==a){var d;for(d in c.view.get())if(c.view.get()[d]==b)return this.utils.peer_stream_detach([b]),this.utils.array_remove_value(c.view.get(),b),this.get_debug().log("[JSJaCJingle:single] unregister_view > Unregistered view of type: "+a,3),!0;return this.get_debug().log("[JSJaCJingle:single] unregister_view > Could not unregister view of type: "+a+" (not found).",2),!0}return this.get_debug().log("[JSJaCJingle:single] unregister_view > Could not unregister view of type: "+a+" (type unknown).",1),!1}catch(e){this.get_debug().log("[JSJaCJingle:single] unregister_view > "+e,1)}return!1},send_content_accept:function(){this.get_debug().log("[JSJaCJingle:single] send_content_accept",4);try{this.get_debug().log("[JSJaCJingle:single] send_content_accept > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_content_accept > "+a,1)}},send_content_add:function(){this.get_debug().log("[JSJaCJingle:single] send_content_add",4);try{this.get_debug().log("[JSJaCJingle:single] send_content_add > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_content_add > "+a,1)}},send_content_modify:function(){this.get_debug().log("[JSJaCJingle:single] send_content_modify",4);try{this.get_debug().log("[JSJaCJingle:single] send_content_modify > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_content_modify > "+a,1)}},send_content_reject:function(){this.get_debug().log("[JSJaCJingle:single] send_content_reject",4);try{this.get_debug().log("[JSJaCJingle:single] send_content_reject > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_content_reject > "+a,1)}},send_content_remove:function(){this.get_debug().log("[JSJaCJingle:single] send_content_remove",4);try{this.get_debug().log("[JSJaCJingle:single] send_content_remove > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_content_remove > "+a,1)}},send_description_info:function(){this.get_debug().log("[JSJaCJingle:single] send_description_info",4);try{this.get_debug().log("[JSJaCJingle:single] send_description_info > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_description_info > "+a,1)}},send_security_info:function(){this.get_debug().log("[JSJaCJingle:single] send_security_info",4);try{this.get_debug().log("[JSJaCJingle:single] send_security_info > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_security_info > "+a,1)}},send_session_accept:function(a,b){this.get_debug().log("[JSJaCJingle:single] send_session_accept",4);try{if(this.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING)return this.get_debug().log("[JSJaCJingle:single] send_session_accept > Cannot send accept stanza, resource not accepting (status: "+this.get_status()+").",0),void this.send_error(a,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);if(!b)return void this.get_debug().log("[JSJaCJingle:single] send_session_accept > Argument not provided.",1);var c=this.utils.stanza_generate_jingle(a,{action:JSJAC_JINGLE_ACTION_SESSION_ACCEPT,responder:this.get_responder()});this.utils.stanza_generate_content_local(a,c),this.utils.stanza_generate_group_local(a,c);var d=this;this.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,function(a){d.get_session_accept_success()(d,a),d.handle_session_accept_success(a)}),this.utils.stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,{external:this.get_session_accept_error(),internal:this.handle_session_accept_error}),this.get_debug().log("[JSJaCJingle:single] send_session_accept > Sent.",4)}catch(e){this.get_debug().log("[JSJaCJingle:single] send_session_accept > "+e,1)}},send_session_info:function(a,b){this.get_debug().log("[JSJaCJingle:single] send_session_info",4);try{if(!b)return void this.get_debug().log("[JSJaCJingle:single] send_session_info > Argument not provided.",1);b.info=b.info||JSJAC_JINGLE_SESSION_INFO_ACTIVE;var c=this.utils.stanza_generate_jingle(a,{action:JSJAC_JINGLE_ACTION_SESSION_INFO,initiator:this.get_initiator()});this.utils.stanza_generate_session_info(a,c,b);var d=this;this.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,function(a){d.get_session_info_success()(this,a),d.handle_session_info_success(a)}),this.utils.stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,{external:this.get_session_info_error(),internal:this.handle_session_info_error}),this.get_debug().log("[JSJaCJingle:single] send_session_info > Sent (name: "+b.info+").",2)}catch(e){this.get_debug().log("[JSJaCJingle:single] send_session_info > "+e,1)}},send_session_initiate:function(a,b){this.get_debug().log("[JSJaCJingle:single] send_session_initiate",4);try{if(this.get_status()!=JSJAC_JINGLE_STATUS_INITIATING)return void this.get_debug().log("[JSJaCJingle:single] send_session_initiate > Cannot send initiate stanza, resource not initiating (status: "+this.get_status()+").",0);if(!b)return void this.get_debug().log("[JSJaCJingle:single] send_session_initiate > Argument not provided.",1);var c=this.utils.stanza_generate_jingle(a,{action:JSJAC_JINGLE_ACTION_SESSION_INITIATE,initiator:this.get_initiator()});this.utils.stanza_generate_content_local(a,c),this.utils.stanza_generate_group_local(a,c);var d=this;this.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,function(a){d.get_session_initiate_success()(d,a),d.handle_session_initiate_success(a)}),this.utils.stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,{external:this.get_session_initiate_error(),internal:this.handle_session_initiate_error}),this.get_debug().log("[JSJaCJingle:single] send_session_initiate > Sent.",2)}catch(e){this.get_debug().log("[JSJaCJingle:single] send_session_initiate > "+e,1)}},send_session_terminate:function(a,b){this.get_debug().log("[JSJaCJingle:single] send_session_terminate",4);try{if(this.get_status()!=JSJAC_JINGLE_STATUS_TERMINATING)return void this.get_debug().log("[JSJaCJingle:single] send_session_terminate > Cannot send terminate stanza, resource not terminating (status: "+this.get_status()+").",0);if(!b)return void this.get_debug().log("[JSJaCJingle:single] send_session_terminate > Argument not provided.",1);b.reason=b.reason||JSJAC_JINGLE_REASON_SUCCESS,this.set_reason(b.reason);var c=this.utils.stanza_generate_jingle(a,{action:JSJAC_JINGLE_ACTION_SESSION_TERMINATE}),d=c.appendChild(a.buildNode("reason",{xmlns:NS_JINGLE}));d.appendChild(a.buildNode(b.reason,{xmlns:NS_JINGLE}));var e=this;this.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,function(a){e.get_session_terminate_success()(e,a),e.handle_session_terminate_success(a)}),this.utils.stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,{external:this.get_session_terminate_error(),internal:this.handle_session_terminate_error}),this.get_debug().log("[JSJaCJingle:single] send_session_terminate > Sent (reason: "+b.reason+").",2)}catch(f){this.get_debug().log("[JSJaCJingle:single] send_session_terminate > "+f,1)}},send_transport_accept:function(){this.get_debug().log("[JSJaCJingle:single] send_transport_accept",4);try{this.get_debug().log("[JSJaCJingle:single] send_transport_accept > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_transport_accept > "+a,1)}},send_transport_info:function(a,b){this.get_debug().log("[JSJaCJingle:single] send_transport_info",4);try{if(this.get_status()!=JSJAC_JINGLE_STATUS_INITIATED&&this.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING&&this.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTED)return void this.get_debug().log("[JSJaCJingle:single] send_transport_info > Cannot send transport info, resource not initiated, nor accepting, nor accepted (status: "+this.get_status()+").",0);if(!b)return void this.get_debug().log("[JSJaCJingle:single] send_transport_info > Argument not provided.",1);if(0===this.utils.object_length(this.get_candidates_queue_local()))return void this.get_debug().log("[JSJaCJingle:single] send_transport_info > No local candidate in queue.",1);var c,d=this.utils.stanza_generate_jingle(a,{action:JSJAC_JINGLE_ACTION_TRANSPORT_INFO,initiator:this.get_initiator()}),e={};for(c in this.get_name())e[c]=this.utils.generate_content(this.get_creator(c),c,this.get_senders(c),this.get_payloads_local(c),this.get_candidates_queue_local(c));this.utils.stanza_generate_content_local(a,d,e),this.utils.stanza_generate_group_local(a,d);var f=this;this.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,function(a){f.handle_transport_info_success(a)}),this.utils.stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,b.id,{internal:this.handle_transport_info_error}),this.get_debug().log("[JSJaCJingle:single] send_transport_info > Sent.",2)}catch(g){this.get_debug().log("[JSJaCJingle:single] send_transport_info > "+g,1)}},send_transport_reject:function(){this.get_debug().log("[JSJaCJingle:single] send_transport_reject",4);try{this.get_debug().log("[JSJaCJingle:single] send_transport_reject > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_transport_reject > "+a,1)}},send_transport_replace:function(){this.get_debug().log("[JSJaCJingle:single] send_transport_replace",4);try{this.get_debug().log("[JSJaCJingle:single] send_transport_replace > Feature not implemented!",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] send_transport_replace > "+a,1)}},send_error:function(a,b){this.get_debug().log("[JSJaCJingle:single] send_error",4);try{if(!("type"in b))return void this.get_debug().log("[JSJaCJingle:single] send_error > Type unknown.",1);if("jingle"in b&&!(b.jingle in JSJAC_JINGLE_ERRORS))return void this.get_debug().log("[JSJaCJingle:single] send_error > Jingle condition unknown ("+b.jingle+").",1);if("xmpp"in b&&!(b.xmpp in XMPP_ERRORS))return void this.get_debug().log("[JSJaCJingle:single] send_error > XMPP condition unknown ("+b.xmpp+").",1);var c=new JSJaCIQ;c.setType("error"),c.setID(a.getID()),c.setTo(this.get_to());var d=c.getNode().appendChild(c.buildNode("error",{xmlns:NS_CLIENT,type:b.type}));"xmpp"in b&&d.appendChild(c.buildNode(b.xmpp,{xmlns:NS_STANZAS})),"jingle"in b&&d.appendChild(c.buildNode(b.jingle,{xmlns:NS_JINGLE_ERRORS})),JSJAC_JINGLE_STORE_CONNECTION.send(c),this.get_debug().log("[JSJaCJingle:single] send_error > Sent: "+(b.jingle||b.xmpp),2)}catch(e){this.get_debug().log("[JSJaCJingle:single] send_error > "+e,1)}},handle_content_accept:function(a){this.get_debug().log("[JSJaCJingle:single] handle_content_accept",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_content_accept > "+b,1)}},handle_content_add:function(a){this.get_debug().log("[JSJaCJingle:single] handle_content_add",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_content_add > "+b,1)}},handle_content_modify:function(a){this.get_debug().log("[JSJaCJingle:single] handle_content_modify",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_content_modify > "+b,1)}},handle_content_reject:function(a){this.get_debug().log("[JSJaCJingle:single] handle_content_reject",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_content_reject > "+b,1)}},handle_content_remove:function(a){this.get_debug().log("[JSJaCJingle:single] handle_content_remove",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_content_remove > "+b,1)}},handle_description_info:function(a){this.get_debug().log("[JSJaCJingle:single] handle_description_info",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_description_info > "+b,1)}},handle_security_info:function(a){this.get_debug().log("[JSJaCJingle:single] handle_security_info",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_security_info > "+b,1)}},handle_session_accept:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_accept",4);try{if(!this.utils.stanza_safe(a))return this.get_debug().log("[JSJaCJingle:single] handle_session_accept > Dropped unsafe stanza.",0),void this.send_error(a,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION);switch(a.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:this.get_session_accept_success()(this,a),this.handle_session_accept_success(a);break;case"error":this.get_session_accept_error()(this,a),this.handle_session_accept_error(a);break;case JSJAC_JINGLE_STANZA_TYPE_SET:this.get_session_accept_request()(this,a),this.handle_session_accept_request(a);break;default:this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_session_accept > "+b,1)}},handle_session_accept_success:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_accept_success",4);try{this.set_status(JSJAC_JINGLE_STATUS_ACCEPTED)}catch(a){this.get_debug().log("[JSJaCJingle:single] handle_session_accept_success > "+a,1)}},handle_session_accept_error:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_accept_error",4);try{this.terminate(JSJAC_JINGLE_REASON_TIMEOUT)}catch(a){this.get_debug().log("[JSJaCJingle:single] handle_session_accept_error > "+a,1)}},handle_session_accept_request:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_accept_request",4);try{if(this.get_status()!=JSJAC_JINGLE_STATUS_INITIATED)return this.get_debug().log("[JSJaCJingle:single] handle_session_accept_request > Cannot handle, resource already accepted (status: "+this.get_status()+").",0),void this.send_error(a,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);var b,c;this.set_status(JSJAC_JINGLE_STATUS_ACCEPTING);var d=this.utils.stanza_sid(a);if(d&&this.is_initiator()&&this.utils.stanza_parse_content(a)){this.utils.stanza_parse_group(a),this.utils.build_content_remote(),this.get_session_accept_success()(this,a),this.handle_session_accept_success(a);var e=this.sdp.generate(WEBRTC_SDP_TYPE_ANSWER,this.get_group_remote(),this.get_payloads_remote(),this.get_candidates_queue_remote());this.get_sdp_trace()&&this.get_debug().log("[JSJaCJingle:single] SDP (remote)\n\n"+e.description.sdp,4);var f=this;this.get_peer_connection().setRemoteDescription(new WEBRTC_SESSION_DESCRIPTION(e.description),function(){},function(a){f.get_sdp_trace()&&f.get_debug().log("[JSJaCJingle:single] SDP (remote:error)\n\n"+(a.message||a.name||"Unknown error"),4),f.terminate(JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS)});for(b in e.candidates)c=e.candidates[b],this.get_peer_connection().addIceCandidate(new WEBRTC_ICE_CANDIDATE({sdpMLineIndex:c.id,candidate:c.candidate}));this.set_candidates_queue_remote(null),this.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:a.getID()})}else this.get_session_accept_error()(this,a),this.handle_session_accept_error(a),this.send_error(a,XMPP_ERROR_BAD_REQUEST),this.get_debug().log("[JSJaCJingle:single] handle_session_accept_request > Error.",1)}catch(g){this.get_debug().log("[JSJaCJingle:single] handle_session_accept_request > "+g,1)}},handle_session_info:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_info",4);try{if(!this.utils.stanza_safe(a))return this.get_debug().log("[JSJaCJingle:single] handle_session_info > Dropped unsafe stanza.",0),void this.send_error(a,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION);switch(a.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:this.get_session_info_success()(this,a),this.handle_session_info_success(a);break;case"error":this.get_session_info_error()(this,a),this.handle_session_info_error(a);break;case JSJAC_JINGLE_STANZA_TYPE_SET:this.get_session_info_request()(this,a),this.handle_session_info_request(a);break;default:this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_session_info > "+b,1)}},handle_session_info_success:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_info_success",4)},handle_session_info_error:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_info_error",4)},handle_session_info_request:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_info_request",4);try{var b=this.utils.stanza_session_info(a),c=!1;switch(b){case JSJAC_JINGLE_SESSION_INFO_ACTIVE:case JSJAC_JINGLE_SESSION_INFO_RINGING:case JSJAC_JINGLE_SESSION_INFO_MUTE:case JSJAC_JINGLE_SESSION_INFO_UNMUTE:c=!0}c?(this.get_debug().log("[JSJaCJingle:single] handle_session_info_request > (name: "+(b||"undefined")+").",3),this.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:a.getID()}),this.get_session_info_success()(this,a),this.handle_session_info_success(a)):(this.get_debug().log("[JSJaCJingle:single] handle_session_info_request > Error (name: "+(b||"undefined")+").",1),this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED),this.get_session_info_error()(this,a),this.handle_session_info_error(a))}catch(d){this.get_debug().log("[JSJaCJingle:single] handle_session_info_request > "+d,1)}},handle_session_initiate:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate",4);try{switch(a.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:this.get_session_initiate_success()(this,a),this.handle_session_initiate_success(a);break;case"error":this.get_session_initiate_error()(this,a),this.handle_session_initiate_error(a);break;case JSJAC_JINGLE_STANZA_TYPE_SET:this.get_session_initiate_request()(this,a),this.handle_session_initiate_request(a);break;default:this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate > "+b,1)}},handle_session_initiate_success:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_success",4);try{this.set_status(JSJAC_JINGLE_STATUS_INITIATED)}catch(a){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_success > "+a,1)}},handle_session_initiate_error:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_error",4);try{this.set_status(JSJAC_JINGLE_STATUS_INACTIVE),this.peer.stop(),this.set_lock(!0)}catch(a){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_error > "+a,1)}},handle_session_initiate_request:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_request",4);try{if(this.get_status()!=JSJAC_JINGLE_STATUS_INACTIVE)return this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_request > Cannot handle, resource already initiated (status: "+this.get_status()+").",0),void this.send_error(a,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);this.set_status(JSJAC_JINGLE_STATUS_INITIATING);var b=this.utils.stanza_from(a),c=this.utils.stanza_sid(a);if(c&&this.utils.stanza_parse_content(a)){if(this.utils.stanza_parse_group(a),this.set_sid(c),this.set_to(b),this.set_initiator(b),this.set_responder(this.utils.connection_jid()),JSJaCJingle.add(c,this),this.utils.build_content_remote(),JSJAC_JINGLE_MEDIA_VIDEO in this.get_content_remote())this.set_media(JSJAC_JINGLE_MEDIA_VIDEO);else{if(!(JSJAC_JINGLE_MEDIA_AUDIO in this.get_content_remote()))return this.get_session_initiate_error()(this,a),this.handle_session_initiate_error(a),this.terminate(JSJAC_JINGLE_REASON_UNSUPPORTED_APPLICATIONS),void this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_request > Error (unsupported media).",1);this.set_media(JSJAC_JINGLE_MEDIA_AUDIO)}this.get_session_initiate_success()(this,a),this.handle_session_initiate_success(a),this.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:a.getID()})}else this.get_session_initiate_error()(this,a),this.handle_session_initiate_error(a),this.send_error(a,XMPP_ERROR_BAD_REQUEST),this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_request > Error (bad request).",1)}catch(d){this.get_debug().log("[JSJaCJingle:single] handle_session_initiate_request > "+d,1)}},handle_session_terminate:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate",4);try{{a.getType()}if(!this.utils.stanza_safe(a))return this.get_debug().log("[JSJaCJingle:single] handle_session_terminate > Dropped unsafe stanza.",0),void this.send_error(a,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION);switch(a.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:this.get_session_terminate_success()(this,a),this.handle_session_terminate_success(a);break;case"error":this.get_session_terminate_error()(this,a),this.handle_session_terminate_error(a);break;case JSJAC_JINGLE_STANZA_TYPE_SET:this.get_session_terminate_request()(this,a),this.handle_session_terminate_request(a);break;default:this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate > "+b,1)}},handle_session_terminate_success:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_success",4);try{this.set_status(JSJAC_JINGLE_STATUS_TERMINATED),this.peer.stop()}catch(a){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_success > "+a,1)}},handle_session_terminate_error:function(){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_error",4);try{this.set_status(JSJAC_JINGLE_STATUS_TERMINATED),this.peer.stop(),this.set_lock(!0),this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_error > Forced session termination locally.",0)}catch(a){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_error > "+a,1)}},handle_session_terminate_request:function(a){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_request",4);try{if(this.get_status()==JSJAC_JINGLE_STATUS_INACTIVE||this.get_status()==JSJAC_JINGLE_STATUS_TERMINATED)return this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_request > Cannot handle, resource not active (status: "+this.get_status()+").",0),void this.send_error(a,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);this.set_status(JSJAC_JINGLE_STATUS_TERMINATING),this.set_reason(this.utils.stanza_terminate_reason(a)),this.get_session_terminate_success()(this,a),this.handle_session_terminate_success(a),this.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:a.getID()}),this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_request > (reason: "+this.get_reason()+").",3)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_session_terminate_request > "+b,1)}},handle_transport_accept:function(a){this.get_debug().log("[JSJaCJingle:single] handle_transport_accept",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_content_accept > "+b,1)}},handle_transport_info:function(a){this.get_debug().log("[JSJaCJingle:single] handle_transport_info",4);try{if(this.get_status()!=JSJAC_JINGLE_STATUS_INITIATED&&this.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING&&this.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTED)return this.get_debug().log("[JSJaCJingle:single] handle_transport_info > Cannot handle, resource not initiated, nor accepting, nor accepted (status: "+this.get_status()+").",0),void this.send_error(a,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);
var b,c,d=this.utils.stanza_sid(a);if(d&&this.utils.stanza_parse_content(a)){this.utils.build_content_remote();var e=this.utils.sdp_generate_candidates(this.get_candidates_queue_remote());for(b in e)c=e[b],this.get_peer_connection().addIceCandidate(new WEBRTC_ICE_CANDIDATE({sdpMLineIndex:c.id,candidate:c.candidate}));this.set_candidates_queue_remote(null),this.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:a.getID()})}else this.send_error(a,XMPP_ERROR_BAD_REQUEST),this.get_debug().log("[JSJaCJingle:single] handle_transport_info > Error.",1)}catch(f){this.get_debug().log("[JSJaCJingle:single] handle_transport_info > "+f,1)}},handle_transport_info_success:function(){this.get_debug().log("[JSJaCJingle:single] handle_transport_info_success",4)},handle_transport_info_error:function(){this.get_debug().log("[JSJaCJingle:single] handle_transport_info_error",4)},handle_transport_reject:function(a){this.get_debug().log("[JSJaCJingle:single] handle_transport_reject",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_transport_reject > "+b,1)}},handle_transport_replace:function(a){this.get_debug().log("[JSJaCJingle:single] handle_transport_replace",4);try{this.send_error(a,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(b){this.get_debug().log("[JSJaCJingle:single] handle_transport_replace > "+b,1)}}}),JSJaCJingleMuji=ring.create([__JSJaCJingleBase],{constructor:function(a){this.$super(a),a&&a.add_remote_view&&(this._add_remote_view=a.add_remote_view),a&&a.remove_remote_view&&(this._remove_remote_view=a.remove_remote_view)},join:function(){this.get_debug().log("[JSJaCJingle:muji] join",4);try{if(this.get_lock())return void this.get_debug().log("[JSJaCJingle:muji] join > Cannot join, resource locked. Please open another session or check WebRTC support.",0);var a=this;if(JSJaCJingle.defer(function(){a.join()}))return void this.get_debug().log("[JSJaCJingle:muji] join > Deferred (waiting for the library components to be initiated).",0);if(this.get_status()!=JSJAC_JINGLE_STATUS_INACTIVE)return void this.get_debug().log("[JSJaCJingle:muji] join > Cannot join, resource not inactive (status: "+this.get_status()+").",0);this.get_debug().log("[JSJaCJingle:muji] join > New Jingle Muji session with media: "+this.get_media(),2);var b,c;this.get_session_initiate_pending()(this),this.set_status(JSJAC_JINGLE_STATUS_INITIATING),this.set_sid(this.utils.generate_hash_md5(this.get_to()));for(b in this.get_media_all())c=this.utils.name_generate(this.get_media_all()[b]),this.set_name(c);JSJaCJingle.add(this.get_sid(),this),this.peer.get_user_media(function(){a.peer.connection_create(function(){a.get_debug().log("[JSJaCJingle:single] initiate > Ready to begin Jingle negotiation.",2),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_INITIATE})})})}catch(d){this.get_debug().log("[JSJaCJingle:muji] join > "+d,1)}},get_creator:function(){return this.get_to()},get_initiator:function(){return this.get_to()},get_responder:function(){return this.get_to()},get_add_remote_view:function(){return"function"==typeof this._add_remote_view?this._add_remote_view:function(){}},get_remove_remote_view:function(){return"function"==typeof this._remove_remote_view?this._remove_remote_view:function(){}}}),JSJaCJingleInit=new(ring.create({extdisco:function(){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > Discovering available services...",2);try{JSJaCJingle.defer(!0);var a=new JSJaCIQ;a.setTo(JSJAC_JINGLE_STORE_CONNECTION.domain),a.setType(JSJAC_JINGLE_STANZA_TYPE_GET),a.getNode().appendChild(a.buildNode("services",{xmlns:NS_EXTDISCO})),JSJAC_JINGLE_STORE_CONNECTION.send(a,function(a){try{if(a.getType()==JSJAC_JINGLE_STANZA_TYPE_RESULT){var b,c,d,e,f,g,h,i,j,k=a.getChild("services",NS_EXTDISCO);if(k)for(c=k.getElementsByTagNameNS(NS_EXTDISCO,"service"),b=0;b<c.length;b++)d=c[b],e=d.getAttribute("host")||null,g=d.getAttribute("port")||null,h=d.getAttribute("transport")||null,i=d.getAttribute("type")||null,j=d.getAttribute("username")||null,f=d.getAttribute("password")||null,e&&i&&(i in JSJAC_JINGLE_STORE_EXTDISCO?(JSJAC_JINGLE_STORE_EXTDISCO[i][e]={port:g,transport:h,type:i},"turn"==i&&(JSJAC_JINGLE_STORE_EXTDISCO[i][e].username=j,JSJAC_JINGLE_STORE_EXTDISCO[i][e].password=f),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > handle > Service stored (type: "+i+", host: "+e+", port: "+g+", transport: "+h+").",4)):JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > handle > Service skipped (type: "+i+", host: "+e+", port: "+g+", transport: "+h+").",4));JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > handle > Discovered available services.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > handle > Could not discover services (server might not support XEP-0215).",0)}catch(l){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > handle > "+l,1)}JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > Ready.",2),JSJaCJingle.defer(!1)})}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:extdisco > "+b,1),JSJaCJingle.defer(!1)}},relaynodes:function(){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:relaynodes > Discovering available Jingle Relay Nodes services...",2);try{JSJaCJingle.defer(!0);var a=new JSJaCIQ;a.setTo(JSJAC_JINGLE_STORE_CONNECTION.domain),a.setType(JSJAC_JINGLE_STANZA_TYPE_GET),a.getNode().appendChild(a.buildNode("services",{xmlns:NS_JABBER_JINGLENODES})),JSJAC_JINGLE_STORE_CONNECTION.send(a,function(a){try{if(a.getType()==JSJAC_JINGLE_STANZA_TYPE_RESULT){var b,c,d,e,f,g,h=a.getChild("services",NS_JABBER_JINGLENODES);if(h)for(c=h.getElementsByTagNameNS(NS_JABBER_JINGLENODES,"stun"),b=0;b<c.length;b++)d=c[b],e=d.getAttribute("policy")||null,f=d.getAttribute("address")||null,cur_port=d.getAttribute("port")||null,g=d.getAttribute("protocol")||null,f&&g&&e&&(!e||"public"==e)&&(JSJAC_JINGLE_STORE_RELAYNODES.stun[f]={port:cur_port,transport:g,type:"stun"},JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:relaynodes > handle > STUN service stored (address: "+f+", port: "+cur_port+", policy: "+e+", protocol: "+g+").",4));JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:relaynodes > handle > Discovered available Jingle Relay Nodes services.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:relaynodes > handle > Could not discover Jingle Relay Nodes services (server might not support XEP-0278).",0)}catch(i){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:relaynodes > handle > "+i,1)}JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:relaynodes > Ready.",2),JSJaCJingle.defer(!1)})}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:relaynodes > "+b,1),JSJaCJingle.defer(!1)}},fallback:function(a){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > Discovering fallback services...",2);try{JSJaCJingle.defer(!0),a+="?username="+encodeURIComponent(JSJAC_JINGLE_STORE_CONNECTION.username+"@"+JSJAC_JINGLE_STORE_CONNECTION.domain);var b=new XMLHttpRequest;b.open("GET",a,!0),b.onreadystatechange=function(){if(4===b.readyState){if(200===b.status){var a,c,d,e,f,g,h,i,j,k=JSON.parse(b.responseText);if(k.uris&&k.uris.length){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > Parsing "+k.uris.length+" URIs...",2);for(c in k.uris)if(d=k.uris[c])if(a=R_JSJAC_JINGLE_SERVICE_URI.exec(d)){if(e=a[1]||null,f=a[2]||null,g=a[3]||null,h=a[4]||null,i=k.username||null,j=k.password||null,!f||!e)continue;if(!(e in JSJAC_JINGLE_STORE_FALLBACK)){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > Service skipped (type: "+e+", host: "+f+", port: "+g+", transport: "+h+").",4);continue}JSJAC_JINGLE_STORE_FALLBACK[e][f]={port:g,transport:h,type:e},"turn"==e&&(JSJAC_JINGLE_STORE_FALLBACK[e][f].username=i,JSJAC_JINGLE_STORE_FALLBACK[e][f].password=j),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > Fallback service stored (type: "+e+", host: "+f+", port: "+g+", transport: "+h+").",4)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > Fallback service not stored, weird URI ("+d+").",0);JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > Finished parsing URIs.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > No URI to parse.",2);JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > Discovered fallback services.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > handle > Could not discover fallback services (API malfunction).",0);JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > Ready.",2),JSJaCJingle.defer(!1)}},b.send()}catch(c){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:init] lib:fallback > "+c,1)}}})),JSJaCJingle=new(ring.create({session:function(a,b){var c;try{switch(a){case JSJAC_JINGLE_SESSION_SINGLE:c=new JSJaCJingleSingle(b);break;case JSJAC_JINGLE_SESSION_MUJI:c=new JSJaCJingleMuji(b);break;default:throw"Unknown session type: "+a}}catch(d){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] session > "+d,1)}finally{return c}},listen:function(a){try{a&&a.connection&&(JSJAC_JINGLE_STORE_CONNECTION=a.connection),a&&a.initiate&&(JSJAC_JINGLE_STORE_INITIATE=a.initiate),a&&a.debug&&(JSJAC_JINGLE_STORE_DEBUG=a.debug),JSJAC_JINGLE_STORE_CONNECTION.registerHandler("iq",this.route.bind(this)),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] listen > Listening.",2),a&&a.extdisco===!1||JSJaCJingleInit.extdisco(),a&&a.relaynodes===!1||JSJaCJingleInit.relaynodes(),a.fallback&&"string"==typeof a.fallback&&JSJaCJingleInit.fallback(a.fallback)}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] listen > "+b,1)}},route:function(a){try{var b=null,c=null,d=a.getChild("jingle",NS_JINGLE);if(d)c=d.getAttribute("sid"),b=d.getAttribute("action");else{var e=a.getID();if(e){var f=-1!==e.indexOf(JSJAC_JINGLE_STANZA_ID_PRE+"_");if(f){var g=e.split("_");c=g[1]}}}if(d&&!JSJAC_JINGLE_AVAILABLE)JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] route > Dropped Jingle packet (WebRTC not available).",0),new JSJaCJingleSingle({to:a.getFrom()}).send_error(a,XMPP_ERROR_SERVICE_UNAVAILABLE);else{var h=this.read(c);b==JSJAC_JINGLE_ACTION_SESSION_INITIATE&&null===h?(JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] route > New Jingle session (sid: "+c+").",2),JSJAC_JINGLE_STORE_INITIATE(a)):c&&(null!==h?(JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] route > Routed to Jingle session (sid: "+c+").",2),h.handle(a)):a.getType()==JSJAC_JINGLE_STANZA_TYPE_SET&&a.getFrom()&&(JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] route > Unknown Jingle session (sid: "+c+").",0),new JSJaCJingleSingle({to:a.getFrom()}).send_error(a,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION)))}}catch(i){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] route > "+i,1)}},add:function(a,b){JSJAC_JINGLE_STORE_SESSIONS[a]=b},read:function(a){return a in JSJAC_JINGLE_STORE_SESSIONS?JSJAC_JINGLE_STORE_SESSIONS[a]:null},remove:function(a){delete JSJAC_JINGLE_STORE_SESSIONS[a]},defer:function(a){try{if("function"==typeof a)return JSJAC_JINGLE_STORE_DEFER.deferred&&(JSJAC_JINGLE_STORE_DEFER.fn.push(a),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] defer > Registered a function to be executed once ready.",2)),JSJAC_JINGLE_STORE_DEFER.deferred;if(!a||"boolean"==typeof a)if(JSJAC_JINGLE_STORE_DEFER.deferred=a===!0,JSJAC_JINGLE_STORE_DEFER.deferred===!1){if(--JSJAC_JINGLE_STORE_DEFER.count<=0){for(JSJAC_JINGLE_STORE_DEFER.count=0,JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] defer > Executing "+JSJAC_JINGLE_STORE_DEFER.fn.length+" deferred functions...",2);JSJAC_JINGLE_STORE_DEFER.fn.length;)JSJAC_JINGLE_STORE_DEFER.fn.shift()();JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] defer > Done executing deferred functions.",2)}}else++JSJAC_JINGLE_STORE_DEFER.count}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:main] defer > "+b,1)}},disco:function(){return JSJAC_JINGLE_AVAILABLE?MAP_DISCO_JINGLE:[]}}));