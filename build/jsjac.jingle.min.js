/**
 * jsjac-jingle [compressed]
 * @fileoverview JSJaC Jingle library, implementation of XEP-0166.
 *
 * @version 0.7.0
 * @date 2014-06-11
 * @author Val√©rian Saliou https://valeriansaliou.name/
 * @license MPL 2.0
 *
 * @url https://github.com/valeriansaliou/jsjac-jingle
 * @repository git+https://github.com/valeriansaliou/jsjac-jingle.git
 * @depends https://github.com/sstrigler/JSJaC
 */

function __JSJaCJingleUtils(){var a=this;a.util_array_remove_value=function(b,c){try{var d;for(d=0;d<b.length;d++)b[d]===c&&(b.splice(d,1),d--)}catch(e){a.get_debug().log("[JSJaCJingle:utils] util_array_remove_value > "+e,1)}return b},a.util_object_length=function(b){var c,d=0;try{for(c in b)b.hasOwnProperty(c)&&d++}catch(e){a.get_debug().log("[JSJaCJingle:utils] util_object_length > "+e,1)}return d},a.util_object_collect=function(){var a,b,c={},d=arguments.length;for(a=0;d>a;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&(c[b]=arguments[a][b]);return c},a.util_object_clone=function(b){try{var c,d,e;if(null===b||"object"!=typeof b)return b;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){for(c=[],d=0,len=b.length;len>d;d++)c[d]=a.util_object_clone(b[d]);return c}if(b instanceof Object){c={};for(e in b)b.hasOwnProperty(e)&&(c[e]=a.util_object_clone(b[e]));return c}}catch(f){a.get_debug().log("[JSJaCJingle:utils] util_object_clone > "+f,1)}a.get_debug().log("[JSJaCJingle:utils] util_object_clone > Cannot clone this object.",1)},a._util_browser=function(){var b={name:"Generic"};try{var c,d,e;d={firefox:JSJAC_JINGLE_BROWSER_FIREFOX,chrome:JSJAC_JINGLE_BROWSER_CHROME,safari:JSJAC_JINGLE_BROWSER_SAFARI,opera:JSJAC_JINGLE_BROWSER_OPERA,msie:JSJAC_JINGLE_BROWSER_IE},c=navigator.userAgent.toLowerCase();for(e in d)if(c.indexOf(e)>-1){b.name=d[e];break}}catch(f){a.get_debug().log("[JSJaCJingle:utils] _util_browser > "+f,1)}return b},a._util_config_ice=function(){try{var b=a.util_object_collect(a.get_stun(),JSJAC_JINGLE_STORE_EXTDISCO.stun,JSJAC_JINGLE_STORE_RELAYNODES.stun,JSJAC_JINGLE_STORE_FALLBACK.stun),c=a.util_object_collect(a.get_turn(),JSJAC_JINGLE_STORE_EXTDISCO.turn,JSJAC_JINGLE_STORE_FALLBACK.turn);if(b&&a.util_object_length(b)||c&&a.util_object_length(c)){var d,e,f,g={iceServers:[]};for(d in b)d&&(e=b[d],f={},f.url="stun:"+d,e.port&&(f.url+=":"+e.port),e.transport&&a._util_browser().name!=JSJAC_JINGLE_BROWSER_FIREFOX&&(f.url+="?transport="+e.transport),g.iceServers.push(f));var h,i,j;for(h in c)h&&(i=c[h],j={},j.url="turn:"+h,i.port&&(j.url+=":"+i.port),i.transport&&(j.url+="?transport="+i.transport),i.username&&(j.username=i.username),i.password&&(j.password=i.password),g.iceServers.push(j));var k,l=!1;for(k in g.iceServers)if(g.iceServers[k].url.match(R_NETWORK_PROTOCOLS.stun)){l=!0;break}return l||g.iceServers.push({url:WEBRTC_CONFIGURATION.peer_connection.config.iceServers[0].url}),g}}catch(m){a.get_debug().log("[JSJaCJingle:utils] _util_config_ice > "+m,1)}return WEBRTC_CONFIGURATION.peer_connection.config},a.util_stanza_get_value=function(b){try{return b.firstChild.nodeValue||null}catch(c){try{return b[0].firstChild.nodeValue||null}catch(d){a.get_debug().log("[JSJaCJingle:utils] util_stanza_get_value > "+d,1)}}return null},a.util_stanza_get_attribute=function(b,c){if(!c)return null;try{return b.getAttribute(c)||null}catch(d){try{return b[0].getAttribute(c)||null}catch(e){a.get_debug().log("[JSJaCJingle:utils] util_stanza_get_attribute > "+e,1)}}return null},a.util_stanza_set_attribute=function(b,c,d){if(c&&d&&b)try{b.setAttribute(c,d)}catch(e){try{b[0].setAttribute(c,d)}catch(f){a.get_debug().log("[JSJaCJingle:utils] util_stanza_set_attribute > "+f,1)}}},a.util_stanza_get_element=function(b,c,d){var e=[];if(!b)return e;b.length&&(b=b[0]);try{var f,g=b.getElementsByTagNameNS(d,c);if(g&&g.length)for(f=0;f<g.length;f++)g[f]&&g[f].parentNode==b&&e.push(g[f]);return e}catch(h){a.get_debug().log("[JSJaCJingle:utils] util_stanza_get_element > "+h,1)}return e},a.util_stanza_jingle=function(b){try{return b.getChild("jingle",NS_JINGLE)}catch(c){a.get_debug().log("[JSJaCJingle:utils] util_stanza_jingle > "+c,1)}return null},a.util_stanza_from=function(b){try{return b.getFrom()||null}catch(c){a.get_debug().log("[JSJaCJingle:utils] util_stanza_from > "+c,1)}return null},a.util_stanza_sid=function(b){try{return a.util_stanza_get_attribute(a.util_stanza_jingle(b),"sid")}catch(c){a.get_debug().log("[JSJaCJingle:utils] util_stanza_sid > "+c,1)}},a.util_stanza_safe=function(b){try{return!(b.getType()==JSJAC_JINGLE_STANZA_TYPE_SET&&a.util_stanza_sid(b)!=a.get_sid()||a.util_stanza_from(b)!=a.get_to())}catch(c){a.get_debug().log("[JSJaCJingle:utils] util_stanza_safe > "+c,1)}return!1},a.util_stanza_terminate_reason=function(b){try{var c=a.util_stanza_jingle(b);if(c){var d=a.util_stanza_get_element(c,"reason",NS_JINGLE);if(d.length){var e;for(e in JSJAC_JINGLE_REASONS)if(a.util_stanza_get_element(d[0],e,NS_JINGLE).length)return e}}}catch(f){a.get_debug().log("[JSJaCJingle:utils] util_stanza_terminate_reason > "+f,1)}return null},a.util_stanza_session_info=function(b){try{var c=a.util_stanza_jingle(b);if(c){var d;for(d in JSJAC_JINGLE_SESSION_INFOS)if(a.util_stanza_get_element(c,d,NS_JINGLE_APPS_RTP_INFO).length)return d}}catch(e){a.get_debug().log("[JSJaCJingle:utils] util_stanza_session_info > "+e,1)}return null},a.util_stanza_timeout=function(b,c,d){try{b=b||JSJAC_JINGLE_STANZA_TYPE_ALL;var e=a.get_sid(),f=a.get_status();a.get_debug().log("[JSJaCJingle:utils] util_stanza_timeout > Registered (id: "+c+", status: "+f+").",4),setTimeout(function(){a.get_debug().log("[JSJaCJingle:utils] util_stanza_timeout > Cheking (id: "+c+", status: "+f+"-"+a.get_status()+").",4),a.get_sid()!=e||a.get_status()!=f||c in a._get_received_id()?a.get_debug().log("[JSJaCJingle:utils] util_stanza_timeout > Stanza successful.",4):(a.get_debug().log("[JSJaCJingle:utils] util_stanza_timeout > Stanza timeout.",2),a.unregister_handler(b,c),d.external&&d.external(a),d.internal&&d.internal())},1e3*JSJAC_JINGLE_STANZA_TIMEOUT)}catch(g){a.get_debug().log("[JSJaCJingle:utils] util_stanza_timeout > "+g,1)}},a._util_stanza_parse_node=function(b,c,d,e,f,g){try{var h,i,j,k,l,m=a.util_stanza_get_element(b,c,d);if(m.length)for(h=0;h<m.length;h++){j=0,k=m[h],l={};for(i in f)if(l[f[i].n]=a.util_stanza_get_attribute(k,f[i].n),f[i].r&&!l[f[i].n]){j++;break}g&&(l[g.n]=a.util_stanza_get_value(k),g.r&&!l[g.n]&&j++),0===j&&e.push(l)}}catch(n){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_parse_node > "+n,1)}},a._util_stanza_parse_content=function(b){try{var c,d,e,f,g,h,i;if(d=a.util_stanza_jingle(b),d&&(e=a.util_stanza_get_element(d,"content",NS_JINGLE),e&&e.length)){for(c=0;c<e.length;c++)f=e[c],h=a.util_stanza_get_attribute(f,"name"),i=a.get_senders(h)||a.util_stanza_get_attribute(f,"senders"),g=a.get_creator(h)||a.util_stanza_get_attribute(f,"creator"),a._set_name(h),a._set_senders(h,i),a._set_creator(h,g),a._set_payloads_remote_add(h,a._util_stanza_parse_payload(f)),cur_candidate=a._util_stanza_parse_candidate(f),a._set_candidates_remote_add(h,cur_candidate),a._set_candidates_queue_remote(h,cur_candidate);return!0}}catch(j){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_parse_content > "+j,1)}return!1},a._util_stanza_parse_group=function(b){try{var c,d,e,f,g,h,i,j;if(e=a.util_stanza_jingle(b),e&&(f=a.util_stanza_get_element(e,"group",NS_JINGLE_APPS_GROUPING),f&&f.length))for(c=0;c<f.length;c++){for(g=f[c],j=[],group_semantics=a.util_stanza_get_attribute(g,"semantics"),h=a.util_stanza_get_element(g,"content",NS_JINGLE_APPS_GROUPING),d=0;d<h.length;d++)i=h[d],j.push(a.util_stanza_get_attribute(i,"name"));a._set_group_remote(group_semantics,j)}return!0}catch(k){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_parse_group > "+k,1)}return!1},a._util_stanza_parse_payload=function(b){var c={descriptions:{},transports:{}};try{var d,e,f,g,h,i,j,k,l,m,n,o=function(){var a,b={attrs:{},"rtcp-fb":[],bandwidth:[],payload:{},"rtp-hdrext":[],"rtcp-mux":0,encryption:{attrs:{},crypto:[],"zrtp-hash":[]},ssrc:{},"ssrc-group":{}};for(a in b)a in c.descriptions||(c.descriptions[a]=b[a])},p=function(a){var b,d={attrs:{},parameter:[],"rtcp-fb":[],"rtcp-fb-trr-int":[]};a in c.descriptions.payload||(c.descriptions.payload[a]={});for(b in d)b in c.descriptions.payload[a]||(c.descriptions.payload[a][b]=d[b])},q=function(a){"object"!=typeof c.descriptions["ssrc-group"][a]&&(c.descriptions["ssrc-group"][a]=[])},r=a.util_stanza_get_element(b,"description",NS_JINGLE_APPS_RTP);if(r.length){r=r[0];var s=a.util_stanza_get_attribute(r,"media"),t=a.util_stanza_get_attribute(r,"ssrc");s||a.get_debug().log("[JSJaCJingle:utils] util_stanza_parse_payload > No media attribute to "+cc_name+" stanza.",1),o(),c.descriptions.attrs.media=s,c.descriptions.attrs.ssrc=t;var u=a.util_stanza_get_element(r,"payload-type",NS_JINGLE_APPS_RTP);if(u.length)for(d=0;d<u.length;d++)g=0,l=u[d],m={},m.channels=a.util_stanza_get_attribute(l,"channels"),m.clockrate=a.util_stanza_get_attribute(l,"clockrate"),m.id=a.util_stanza_get_attribute(l,"id")||g++,m.name=a.util_stanza_get_attribute(l,"name"),c.descriptions.attrs.ptime=a.util_stanza_get_attribute(l,"ptime"),c.descriptions.attrs.maxptime=a.util_stanza_get_attribute(l,"maxptime"),0===g&&(n=m.id,p(n),c.descriptions.payload[n].attrs=m,a._util_stanza_parse_node(l,"parameter",NS_JINGLE_APPS_RTP,c.descriptions.payload[n].parameter,[{n:"name",r:1},{n:"value",r:0}]),a._util_stanza_parse_node(l,"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB,c.descriptions.payload[n]["rtcp-fb"],[{n:"type",r:1},{n:"subtype",r:0}]),a._util_stanza_parse_node(l,"rtcp-fb-trr-int",NS_JINGLE_APPS_RTP_RTCP_FB,c.descriptions.payload[n]["rtcp-fb-trr-int"],[{n:"value",r:1}]));var v=a.util_stanza_get_element(r,"encryption",NS_JINGLE_APPS_RTP);v.length&&(v=v[0],c.descriptions.encryption.attrs.required=a.util_stanza_get_attribute(v,"required")||"0",a._util_stanza_parse_node(v,"crypto",NS_JINGLE_APPS_RTP,c.descriptions.encryption.crypto,[{n:"crypto-suite",r:1},{n:"key-params",r:1},{n:"session-params",r:0},{n:"tag",r:1}]),a._util_stanza_parse_node(v,"zrtp-hash",NS_JINGLE_APPS_RTP_ZRTP,c.descriptions.encryption["zrtp-hash"],[{n:"version",r:1}],{n:"value",r:1}));var w=a.util_stanza_get_element(r,"ssrc-group",NS_JINGLE_APPS_RTP_SSMA);if(w&&w.length)for(e=0;e<w.length;e++)j=w[e],k=a.util_stanza_get_attribute(j,"semantics")||null,null!==k&&(cur_ssrc_group_semantics_obj={sources:[]},q(k),a._util_stanza_parse_node(j,"source",NS_JINGLE_APPS_RTP_SSMA,cur_ssrc_group_semantics_obj.sources,[{n:"ssrc",r:1}]),c.descriptions["ssrc-group"][k].push(cur_ssrc_group_semantics_obj));var x=a.util_stanza_get_element(r,"source",NS_JINGLE_APPS_RTP_SSMA);if(x&&x.length)for(f=0;f<x.length;f++)h=x[f],i=a.util_stanza_get_attribute(h,"ssrc")||null,null!==i&&(c.descriptions.ssrc[i]=[],a._util_stanza_parse_node(h,"parameter",NS_JINGLE_APPS_RTP_SSMA,c.descriptions.ssrc[i],[{n:"name",r:1},{n:"value",r:0}]));a._util_stanza_parse_node(r,"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB,c.descriptions["rtcp-fb"],[{n:"type",r:1},{n:"subtype",r:0}]),a._util_stanza_parse_node(r,"bandwidth",NS_JINGLE_APPS_RTP,c.descriptions.bandwidth,[{n:"type",r:1}],{n:"value",r:1}),a._util_stanza_parse_node(r,"rtp-hdrext",NS_JINGLE_APPS_RTP_RTP_HDREXT,c.descriptions["rtp-hdrext"],[{n:"id",r:1},{n:"uri",r:1},{n:"senders",r:0}]);var y=a.util_stanza_get_element(r,"rtcp-mux",NS_JINGLE_APPS_RTP);y.length&&(c.descriptions["rtcp-mux"]=1)}var z=a.util_stanza_get_element(b,"transport",NS_JINGLE_TRANSPORTS_ICEUDP);if(z.length){c.transports.pwd=a.util_stanza_get_attribute(z,"pwd"),c.transports.ufrag=a.util_stanza_get_attribute(z,"ufrag");var A=a.util_stanza_get_element(z,"fingerprint",NS_JINGLE_APPS_DTLS);A.length&&(c.transports.fingerprint={},c.transports.fingerprint.setup=a.util_stanza_get_attribute(A,"setup"),c.transports.fingerprint.hash=a.util_stanza_get_attribute(A,"hash"),c.transports.fingerprint.value=a.util_stanza_get_value(A))}}catch(B){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_parse_payload > "+B,1)}return c},a._util_stanza_parse_candidate=function(b){var c=[];try{var d=function(d,e){var f=a.util_stanza_get_element(b,"transport",d);f.length&&a._util_stanza_parse_node(f,"candidate",d,c,e)};d(NS_JINGLE_TRANSPORTS_ICEUDP,JSJAC_JINGLE_SDP_CANDIDATE_MAP_ICEUDP),d(NS_JINGLE_TRANSPORTS_RAWUDP,JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP)}catch(e){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_parse_candidate > "+e,1)}return c},a._util_stanza_build_node=function(b,c,d,e,f,g){var h=null;try{var i,j,k;if(d&&d.length)for(i in d)if(j=d[i]){h=c.appendChild(b.buildNode(e,{xmlns:f},g&&j[g]?j[g]:null));for(k in j)k!=g&&a.util_stanza_set_attribute(h,k,j[k])}}catch(l){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_build_node > name: "+e+" > "+l,1)}return h},a._util_stanza_generate_jingle=function(b,c){var d=null;try{var e;d=b.getNode().appendChild(b.buildNode("jingle",{xmlns:NS_JINGLE})),c.sid||(c.sid=a.get_sid());for(e in c)a.util_stanza_set_attribute(d,e,c[e])}catch(f){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_generate_jingle > "+f,1)}return d},a._util_stanza_generate_session_info=function(b,c,d){try{var e=c.appendChild(b.buildNode(d.info,{xmlns:NS_JINGLE_APPS_RTP_INFO}));switch(d.info){case JSJAC_JINGLE_SESSION_INFO_MUTE:case JSJAC_JINGLE_SESSION_INFO_UNMUTE:a.util_stanza_set_attribute(e,"creator",a.get_creator_this()),a.util_stanza_set_attribute(e,"name",d.name)}}catch(f){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_generate_session_info > "+f,1)}},a._util_stanza_generate_content_local=function(b,c,d){try{var e,f=d?d:a._get_content_local(),g=function(c,d,e){var f=a._util_stanza_build_node(b,c,[d.attrs],"transport",e);a._util_stanza_build_node(b,f,[d.fingerprint],"fingerprint",NS_JINGLE_APPS_DTLS,"value"),a._util_stanza_build_node(b,f,d.candidate,"candidate",e)};for(e in f){var h=f[e],i=c.appendChild(b.buildNode("content",{xmlns:NS_JINGLE}));if(a.util_stanza_set_attribute(i,"creator",h.creator),a.util_stanza_set_attribute(i,"name",h.name),a.util_stanza_set_attribute(i,"senders",h.senders),a.util_stanza_get_attribute(c,"action")!=JSJAC_JINGLE_ACTION_TRANSPORT_INFO){var j=h.description,k=j.attrs,l=j["rtcp-fb"],m=j.bandwidth,n=j.payload,o=j.encryption,p=j.ssrc,q=j["ssrc-group"],r=j["rtp-hdrext"],s=j["rtcp-mux"],t=a._util_stanza_build_node(b,i,[k],"description",NS_JINGLE_APPS_RTP);if(n){var u,v,w,x,y,z;for(u in n)y=n[u],z=a._util_stanza_build_node(b,t,[y.attrs],"payload-type",NS_JINGLE_APPS_RTP),a._util_stanza_build_node(b,z,y.parameter,"parameter",NS_JINGLE_APPS_RTP),a._util_stanza_build_node(b,z,y["rtcp-fb"],"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB),a._util_stanza_build_node(b,z,y["rtcp-fb-trr-int"],"rtcp-fb-trr-int",NS_JINGLE_APPS_RTP_RTCP_FB);if(q)for(x in q)for(v in q[x]){var A=t.appendChild(b.buildNode("ssrc-group",{semantics:x,xmlns:NS_JINGLE_APPS_RTP_SSMA}));a._util_stanza_build_node(b,A,q[x][v].sources,"source",NS_JINGLE_APPS_RTP_SSMA)}if(p)for(w in p){var B=t.appendChild(b.buildNode("source",{ssrc:w,xmlns:NS_JINGLE_APPS_RTP_SSMA}));a._util_stanza_build_node(b,B,p[w],"parameter",NS_JINGLE_APPS_RTP_SSMA)}if(o&&(o.crypto&&o.crypto.length||o["zrtp-hash"]&&o["zrtp-hash"].length)){var C=t.appendChild(b.buildNode("encryption",{xmlns:NS_JINGLE_APPS_RTP}));a.util_stanza_set_attribute(C,"required",o.attrs.required||"0"),a._util_stanza_build_node(b,C,o.crypto,"crypto",NS_JINGLE_APPS_RTP),a._util_stanza_build_node(b,C,o["zrtp-hash"],"zrtp-hash",NS_JINGLE_APPS_RTP_ZRTP,"value")}a._util_stanza_build_node(b,t,l,"rtcp-fb",NS_JINGLE_APPS_RTP_RTCP_FB),a._util_stanza_build_node(b,t,m,"bandwidth",NS_JINGLE_APPS_RTP,"value"),a._util_stanza_build_node(b,t,r,"rtp-hdrext",NS_JINGLE_APPS_RTP_RTP_HDREXT),s&&t.appendChild(b.buildNode("rtcp-mux",{xmlns:NS_JINGLE_APPS_RTP}))}}var D=a._util_generate_transport(h.transport);D.ice.candidate.length>0&&g(i,D.ice,NS_JINGLE_TRANSPORTS_ICEUDP),D.raw.candidate.length>0&&g(i,D.raw,NS_JINGLE_TRANSPORTS_RAWUDP)}}catch(E){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_generate_content_local > "+E,1)}},a._util_stanza_generate_group_local=function(b,c){try{var d,e,f,g,h,i=a._get_group_local();for(e in i){f=i[e],h=c.appendChild(b.buildNode("group",{xmlns:NS_JINGLE_APPS_GROUPING,semantics:e}));for(d in f)g=f[d],h.appendChild(b.buildNode("content",{xmlns:NS_JINGLE_APPS_GROUPING,name:g}))}}catch(j){a.get_debug().log("[JSJaCJingle:utils] _util_stanza_generate_group_local > "+j,1)}},a._util_generate_content=function(b,c,d,e,f){var g={};try{g.creator=b,g.name=c,g.senders=d,g.description={},g.transport={};var h,i=a.util_object_clone(e.descriptions),j=i.attrs.ptime,k=i.attrs.maxptime;j&&delete i.attrs.ptime,k&&delete i.attrs.maxptime;for(h in i.payload)"attrs"in i.payload[h]||(i.payload[h].attrs={}),i.payload[h].attrs.ptime=j,i.payload[h].attrs.maxptime=k;g.description=i,g.transport.candidate=f,g.transport.attrs={},g.transport.attrs.pwd=e.transports?e.transports.pwd:null,g.transport.attrs.ufrag=e.transports?e.transports.ufrag:null,e.transports&&e.transports.fingerprint&&(g.transport.fingerprint=e.transports.fingerprint)}catch(l){a.get_debug().log("[JSJaCJingle:utils] _util_generate_content > "+l,1)}return g},a._util_generate_transport=function(b){var c={ice:{},raw:{}};try{var d,e,f,g,h,i,j={};for(d in JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP)j[JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP[d].n]=1;var k=function(a){a.attrs=b.attrs,a.fingerprint=b.fingerprint,a.candidate=[]};for(e in c)k(c[e]);for(f=0;f<b.candidate.length;f++)if(h=a.util_object_clone(b.candidate[f]),h.type in JSJAC_JINGLE_SDP_CANDIDATE_TYPES){if(JSJAC_JINGLE_SDP_CANDIDATE_TYPES[h.type]===JSJAC_JINGLE_SDP_CANDIDATE_METHOD_RAW)for(g in h)"undefined"==typeof j[g]&&delete h[g];i=c[JSJAC_JINGLE_SDP_CANDIDATE_TYPES[h.type]],i.candidate.push(h)}}catch(l){a.get_debug().log("[JSJaCJingle:utils] _util_generate_transport > "+l,1)}return c},a._util_build_content_local=function(){try{var b;for(b in a.get_name())a._set_content_local(b,a._util_generate_content(JSJAC_JINGLE_SENDERS_INITIATOR.jingle,b,a.get_senders(b),a._get_payloads_local(b),a._get_candidates_local(b)))}catch(c){a.get_debug().log("[JSJaCJingle:utils] _util_build_content_local > "+c,1)}},a._util_build_content_remote=function(){try{var b;for(b in a.get_name())a._set_content_remote(b,a._util_generate_content(a.get_creator(b),b,a.get_senders(b),a._get_payloads_remote(b),a._get_candidates_remote(b)))}catch(c){a.get_debug().log("[JSJaCJingle:utils] _util_build_content_remote > "+c,1)}},a._util_name_generate=function(b){var c=null;try{var d,e,f=[a._get_content_remote(),a._get_content_local()];for(d in f){for(e in f[d])try{if(f[d][e].description.attrs.media==b){c=e;break}}catch(g){}if(c)break}c||(c=b)}catch(g){a.get_debug().log("[JSJaCJingle:utils] _util_name_generate > "+g,1)}return c},a._util_media_generate=function(b){var c,d=null;try{if("number"==typeof b){for(c in JSJAC_JINGLE_MEDIAS)if(b==parseInt(JSJAC_JINGLE_MEDIAS[c].label,10)){d=c;break}}else for(c in JSJAC_JINGLE_MEDIAS)if(b==a._util_name_generate(c)){d=c;break}d||(d=b)}catch(e){a.get_debug().log("[JSJaCJingle:utils] _util_media_generate > "+e,1)}return d},a._util_sdp_generate=function(b,c,d,e){try{var f={};return f.candidates=a._util_sdp_generate_candidates(e),f.description=a._util_sdp_generate_description(b,c,d,f.candidates),f}catch(g){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_generate > "+g,1)}return{}},a._util_sdp_generate_candidates=function(b){var c=[];try{var d,e,f,g,h,i,j,k;for(f in b){g=b[f],e=a._util_media_generate(f);for(d in g)h=g[d],i=JSJAC_JINGLE_MEDIAS[e].label,j=i,k="",k+="a=candidate:",k+=h.foundation||h.id,k+=" ",k+=h.component,k+=" ",k+=h.protocol||JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_DEFAULT,k+=" ",k+=h.priority||JSJAC_JINGLE_SDP_CANDIDATE_PRIORITY_DEFAULT,k+=" ",k+=h.ip,k+=" ",k+=h.port,h.type&&(k+=" ",k+="typ",k+=" ",k+=h.type),h["rel-addr"]&&h["rel-port"]&&(k+=" ",k+="raddr",k+=" ",k+=h["rel-addr"],k+=" ",k+="rport",k+=" ",k+=h["rel-port"]),h.generation&&(k+=" ",k+="generation",k+=" ",k+=h.generation),k+=WEBRTC_SDP_LINE_BREAK,c.push({label:i,id:j,candidate:k})}}catch(l){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_generate_candidates > "+l,1)}return c},a._util_sdp_generate_description=function(b,c,d,e){var f={};try{var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib="",jb=a._util_is_sdp_common_credentials(d);ib+=a._util_sdp_generate_protocol_version(),ib+=WEBRTC_SDP_LINE_BREAK,ib+=a._util_sdp_generate_origin(),ib+=WEBRTC_SDP_LINE_BREAK,ib+=a._util_sdp_generate_session_name(),ib+=WEBRTC_SDP_LINE_BREAK,ib+=a._util_sdp_generate_timing(),ib+=WEBRTC_SDP_LINE_BREAK;for(z in c){A=c[z],ib+="a=group:"+z;for(r in A)B=A[r],ib+=" "+B;ib+=WEBRTC_SDP_LINE_BREAK}if(jb===!0)for(v in d){E=d[v].transports||{},ib+=a._util_sdp_generate_credentials(E.ufrag,E.pwd,E.fingerprint);break}for(u in d)if(w=d[u],y=a.get_senders(u),x=a.get_name(u)?a._util_media_generate(u):null){if(C=a._util_network_extract_main(u,e),D=w.transports||{},G=D.pwd,H=D.ufrag,I=D.fingerprint,F=w.descriptions,J=F.attrs,K=F["rtcp-fb"],L=F.bandwidth,U=F.payload,M=F.encryption,N=F.ssrc,Q=F["ssrc-group"],fb=F["rtp-hdrext"],hb=F["rtcp-mux"],ib+=a._util_sdp_generate_description_media(x,C.port,M,I,U),ib+=WEBRTC_SDP_LINE_BREAK,ib+="c="+C.scope+" "+C.protocol+" "+C.ip,ib+=WEBRTC_SDP_LINE_BREAK,ib+="a=rtcp:"+C.port+" "+C.scope+" "+C.protocol+" "+C.ip,ib+=WEBRTC_SDP_LINE_BREAK,jb===!1&&(ib+=a._util_sdp_generate_credentials(H,G,I)),I&&I.setup&&(ib+="a=setup:"+I.setup,ib+=WEBRTC_SDP_LINE_BREAK),fb&&fb.length)for(g in fb)gb=fb[g],ib+="a=extmap:"+gb.id,gb.senders&&(ib+="/"+gb.senders),ib+=" "+gb.uri,ib+=WEBRTC_SDP_LINE_BREAK;if(y&&(ib+="a="+JSJAC_JINGLE_SENDERS[y],ib+=WEBRTC_SDP_LINE_BREAK),x&&JSJAC_JINGLE_MEDIAS[x]&&(ib+="a=mid:"+JSJAC_JINGLE_MEDIAS[x].label,ib+=WEBRTC_SDP_LINE_BREAK),hb&&(ib+="a=rtcp-mux",ib+=WEBRTC_SDP_LINE_BREAK),M){for(i in M.crypto)db=M.crypto[i],ib+="a=crypto:"+db.tag+" "+db["crypto-suite"]+" "+db["key-params"]+(db["session-params"]?" "+db["session-params"]:""),ib+=WEBRTC_SDP_LINE_BREAK;for(o in M["zrtp-hash"])eb=M["zrtp-hash"][o],ib+="a=zrtp-hash:"+eb.version+" "+eb.value,ib+=WEBRTC_SDP_LINE_BREAK}for(m in K)T=K[m],ib+="a=rtcp-fb:*",ib+=" "+T.type,T.subtype&&(ib+=" "+T.subtype),ib+=WEBRTC_SDP_LINE_BREAK;for(p in L)cur_d_bandwidth_obj=L[p],ib+="b="+cur_d_bandwidth_obj.type,ib+=":"+cur_d_bandwidth_obj.value,ib+=WEBRTC_SDP_LINE_BREAK;for(j in U){if(V=U[j],W=V.attrs,Y=V.parameter,_=V["rtcp-fb"],bb=V["rtcp-fb-trr-int"],X=W.id,ib+="a=rtpmap:"+X,W.name&&(ib+=" "+W.name,W.clockrate&&(ib+="/"+W.clockrate,W.channels&&(ib+="/"+W.channels))),ib+=WEBRTC_SDP_LINE_BREAK,Y.length){ib+="a=fmtp:"+X+" ",$="";for(n in Y)Z=Y[n],$&&($+=";"),$+=Z.name,null!==Z.value&&($+="=",$+=Z.value);ib+=$,ib+=WEBRTC_SDP_LINE_BREAK}for(k in _)ab=_[k],ib+="a=rtcp-fb:"+X,ib+=" "+ab.type,ab.subtype&&(ib+=" "+ab.subtype),ib+=WEBRTC_SDP_LINE_BREAK;for(l in bb)cb=bb[l],ib+="a=rtcp-fb:"+X,ib+=" trr-int",ib+=" "+cb.value,ib+=WEBRTC_SDP_LINE_BREAK}J.ptime&&(ib+="a=ptime:"+J.ptime+WEBRTC_SDP_LINE_BREAK),J.maxptime&&(ib+="a=maxptime:"+J.maxptime+WEBRTC_SDP_LINE_BREAK);for(R in Q)for(s in Q[R]){S=Q[R][s],ib+="a=ssrc-group",ib+=":"+R;for(t in S.sources)ib+=" "+S.sources[t].ssrc;ib+=WEBRTC_SDP_LINE_BREAK}for(O in N)for(q in N[O])P=N[O][q],ib+="a=ssrc",ib+=":"+O,ib+=" "+P.name,P.value&&(ib+=":"+P.value),ib+=WEBRTC_SDP_LINE_BREAK;if("object"==typeof e)for(h in e)e[h].label==JSJAC_JINGLE_MEDIAS[x].label&&(ib+=e[h].candidate)}f.type=b,f.sdp=ib}catch(kb){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_generate_description > "+kb,1)}return f},a._util_sdp_generate_protocol_version=function(){return"v=0"},a._util_sdp_generate_origin=function(){var b="";try{var c=new JSJaCJID(a.get_initiator()),d=c.getNode()?c.getNode():"-",e="1",f="1",g=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_DEFAULT,h=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_DEFAULT,i=JSJAC_JINGLE_SDP_CANDIDATE_IP_DEFAULT;b+="o=",b+=d+" ",b+=e+" ",b+=f+" ",b+=g+" ",b+=h+" ",b+=i}catch(j){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_generate_origin > "+j,1)}return b},a._util_sdp_generate_session_name=function(){return"s="+(a.get_sid()||"-")},a._util_sdp_generate_timing=function(){return"t=0 0"},a._util_sdp_generate_credentials=function(a,b,c){var d="";return a&&(d+="a=ice-ufrag:"+a+WEBRTC_SDP_LINE_BREAK),b&&(d+="a=ice-pwd:"+b+WEBRTC_SDP_LINE_BREAK),c&&c.hash&&c.value&&(d+="a=fingerprint:"+c.hash+" "+c.value,d+=WEBRTC_SDP_LINE_BREAK),d},a._util_sdp_generate_description_media=function(b,c,d,e,f){var g="";try{var h,i=[];g+="m="+b+" "+c+" ",g+=d&&d.length||e&&e.hash&&e.value?"RTP/SAVPF":"RTP/AVPF";for(h in f)i.push(f[h].attrs.id);g+=" "+i.join(" ")}catch(j){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_generate_description_media > "+j,1)}return g},a.util_generate_sid=function(){return cnonce(16)},a.util_generate_id=function(){return cnonce(10)},a.util_generate_constraints=function(){var b={audio:!1,video:!1};try{if(b.audio=!0,b.video=a.get_media()==JSJAC_JINGLE_MEDIA_VIDEO,b.video===!0){switch(a.get_resolution()){case"720":case"hd":b.video={mandatory:{minWidth:1280,minHeight:720,minAspectRatio:1.77}};break;case"360":case"md":b.video={mandatory:{minWidth:640,minHeight:360,minAspectRatio:1.77}};break;case"180":case"sd":b.video={mandatory:{minWidth:320,minHeight:180,minAspectRatio:1.77}};break;case"960":b.video={mandatory:{minWidth:960,minHeight:720}};break;case"640":case"vga":b.video={mandatory:{maxWidth:640,maxHeight:480}};break;case"320":b.video={mandatory:{maxWidth:320,maxHeight:240}}}if(a.get_bandwidth()&&(b.video.optional=[{bandwidth:a.get_bandwidth()}]),a.get_fps()&&(b.video.mandatory.minFrameRate=a.get_fps()),a.get_media()==JSJAC_JINGLE_MEDIA_VIDEO&&a.get_video_source()!=JSJAC_JINGLE_VIDEO_SOURCE_CAMERA){if("https:"!==document.location.protocol&&a.get_debug().log("[JSJaCJingle:utils] util_generate_constraints > HTTPS might be required to share screen, otherwise you may get a permission denied error.",0),a._util_browser().name!=JSJAC_JINGLE_BROWSER_CHROME)return a.get_debug().log("[JSJaCJingle:utils] util_generate_constraints > Video source not supported by "+a._util_browser().name+" (source: "+a.get_video_source()+").",1),void a.terminate(JSJAC_JINGLE_REASON_MEDIA_ERROR);b.audio=!1,b.video.mandatory={chromeMediaSource:a.get_video_source()}}}}catch(c){a.get_debug().log("[JSJaCJingle:utils] util_generate_constraints > "+c,1)}return b},a._util_is_sdp_common_credentials=function(b){var c=!0;try{var d,e,f;for(d in b){if(f=b[d].transports,"object"==typeof e&&(e.ufrag!==f.ufrag||e.pwd!==f.pwd||JSON.stringify(e.fingerprint)!==JSON.stringify(f.fingerprint))){c=!1;break}e=f}}catch(g){a.get_debug().log("[JSJaCJingle:utils] _util_is_sdp_common_credentials > "+g,1)}return c},a._util_network_extract_main=function(b,c){var d,e,f={ip:JSJAC_JINGLE_SDP_CANDIDATE_IP_DEFAULT,port:JSJAC_JINGLE_SDP_CANDIDATE_PORT_DEFAULT,scope:JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_DEFAULT,protocol:JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_DEFAULT};try{var g,h,i,j=function(a,b){var c,d={ip:b.ip,port:b.port};if(b.ip.match(R_NETWORK_IP.all.v4))c=R_NETWORK_IP.lan.v4,d.protocol=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V4;else{if(!b.ip.match(R_NETWORK_IP.all.v6))return;c=R_NETWORK_IP.lan.v6,d.protocol=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V6}if(a===JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST&&b.ip.match(c))d.scope=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_LOCAL;else{if(a!==JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX)return;d.scope=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_REMOTE}return d};for(g in c)h=c[g],(h.id==b||h.label==b)&&(i=a._util_sdp_parse_candidate(h.candidate),i.type===JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST?"undefined"==typeof d&&(d=j(JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST,i)):i.type===JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX&&"undefined"==typeof e&&(e=j(JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX,i)));"undefined"!=typeof e?f=e:"undefined"!=typeof d&&(f=d)}catch(k){a.get_debug().log("[JSJaCJingle:utils] _util_network_extract_main > "+k,1)}return f},a.util_negotiation_status=function(){return a.get_initiator()==a.util_connection_jid()?JSJAC_JINGLE_SENDERS_INITIATOR.jingle:JSJAC_JINGLE_SENDERS_RESPONDER.jingle},a.util_connection_jid=function(){return JSJAC_JINGLE_STORE_CONNECTION.username+"@"+JSJAC_JINGLE_STORE_CONNECTION.domain+"/"+JSJAC_JINGLE_STORE_CONNECTION.resource},a._util_map_register_view=function(b){var c={type:null,mute:!1,view:{get:null,set:null},stream:{get:null,set:null}};try{switch(b){case"local":c.type=b,c.mute=!0,c.view.get=a.get_local_view,c.view.set=a._set_local_view,c.stream.get=a._get_local_stream,c.stream.set=a._set_local_stream;break;case"remote":c.type=b,c.view.get=a.get_remote_view,c.view.set=a._set_remote_view,c.stream.get=a._get_remote_stream,c.stream.set=a._set_remote_stream}}catch(d){a.get_debug().log("[JSJaCJingle:utils] _util_map_register_view > "+d,1)}return c},a._util_map_unregister_view=function(b){return a._util_map_register_view(b)},a._util_peer_stream_attach=function(b,c,d){try{var e,f=c?URL.createObjectURL(c):"";for(e in b)b[e].src=f,navigator.mozGetUserMedia?b[e].play():b[e].autoplay=!0,"boolean"==typeof d&&(b[e].muted=d)}catch(g){a.get_debug().log("[JSJaCJingle:utils] _util_peer_stream_attach > "+g,1)}},a._util_peer_stream_detach=function(b){try{var c;for(c in b)b[c].pause(),b[c].src=""}catch(d){a.get_debug().log("[JSJaCJingle:utils] _util_peer_stream_detach > "+d,1)}},a._util_sdp_parse_payload=function(b){var c={};try{if(!b||-1==b.indexOf("\n"))return c;var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=b.split("\n"),U=null,V=null,W={fingerprint:{},pwd:null,ufrag:null},X=function(a){a in c||(c[a]={})},Y=function(a,b,d){X(a),"descriptions"in c[a]||(c[a].descriptions={}),b in c[a].descriptions||(c[a].descriptions[b]=d)},Z=function(a,b,d){X(a),"transports"in c[a]||(c[a].transports={}),b in c[a].transports||(c[a].transports[b]=d)},$=function(a,b){Y(a,"ssrc",{}),b in c[a].descriptions.ssrc||(c[a].descriptions.ssrc[b]=[])},_=function(a,b){Y(a,"ssrc-group",{}),b in c[a].descriptions["ssrc-group"]||(c[a].descriptions["ssrc-group"][b]=[])},ab=function(a,b){Y(a,"payload",{}),b in c[a].descriptions.payload||(c[a].descriptions.payload[b]={attrs:{},parameter:[],"rtcp-fb":[],"rtcp-fb-trr-int":[]})},bb=function(a){Y(a,"encryption",{attrs:{required:"1"},crypto:[],"zrtp-hash":[]})};for(e in T)if(h=T[e],P=R_WEBRTC_SDP_ICE_PAYLOAD.media.exec(h))V=P[1],U=a._util_name_generate(V),Y(U,"attrs",{}),c[U].descriptions.attrs.media=V;else if(O=R_WEBRTC_SDP_ICE_PAYLOAD.bandwidth.exec(h)){if(d=0,C={},C.type=O[1]||d++,C.value=O[2]||d++,0!==d)continue;Y(U,"bandwidth",[]),c[U].descriptions.bandwidth.push(C)}else if(D=R_WEBRTC_SDP_ICE_PAYLOAD.rtpmap.exec(h)){if(d=0,o={},o.channels=D[6],o.clockrate=D[4],o.id=D[1]||d++,o.name=D[3],0!==d)continue;A=o.id,ab(U,A),c[U].descriptions.payload[A].attrs=o}else if(E=R_WEBRTC_SDP_ICE_PAYLOAD.fmtp.exec(h)){if(j=E[1]){k=E[2]?E[2].split(";"):[];for(f in k){if(-1!==k[f].indexOf("="))for(l=k[f].split("="),m=l[0],n=l[1];m.length&&!m[0];)m=m.substring(1);else m=k[f],n=null;d=0,i={},i.name=m||d++,i.value=n,0===d&&(ab(U,j),c[U].descriptions.payload[j].parameter.push(i))}}}else if(F=R_WEBRTC_SDP_ICE_PAYLOAD.rtcp_fb.exec(h)){if(d=0,p={},p.id=F[1]||d++,p.type=F[2],p.subtype=F[4],0!==d)continue;B=p.id,"*"==B?(Y(U,"rtcp-fb",[]),c[U].descriptions["rtcp-fb"].push(p)):(ab(U,B),c[U].descriptions.payload[B]["rtcp-fb"].push(p))}else if(G=R_WEBRTC_SDP_ICE_PAYLOAD.rtcp_fb_trr_int.exec(h)){if(d=0,q={},q.id=G[1]||d++,q.value=G[2]||d++,0!==d)continue;cur_rtcp_fb_trr_int_id=q.id,ab(U,cur_rtcp_fb_trr_int_id),c[U].descriptions.payload[cur_rtcp_fb_trr_int_id]["rtcp-fb-trr-int"].push(q)}else if(H=R_WEBRTC_SDP_ICE_PAYLOAD.crypto.exec(h)){if(d=0,r={},r["crypto-suite"]=H[2]||d++,r["key-params"]=H[3]||d++,r["session-params"]=H[5],r.tag=H[1]||d++,0!==d)continue;bb(U),c[U].descriptions.encryption.crypto.push(r)}else if(I=R_WEBRTC_SDP_ICE_PAYLOAD.zrtp_hash.exec(h)){if(d=0,s={},s.version=I[1]||d++,s.value=I[2]||d++,0!==d)continue;bb(U),c[U].descriptions.encryption["zrtp-hash"].push(s)}else if(M=R_WEBRTC_SDP_ICE_PAYLOAD.ptime.exec(h))Y(U,"attrs",{}),c[U].descriptions.attrs.ptime=M[1];else if(N=R_WEBRTC_SDP_ICE_PAYLOAD.maxptime.exec(h))Y(U,"attrs",{}),c[U].descriptions.attrs.maxptime=N[1];else if(m_ssrc=R_WEBRTC_SDP_ICE_PAYLOAD.ssrc.exec(h)){if(d=0,u={},cur_ssrc_id=m_ssrc[1]||d++,u.name=m_ssrc[2]||d++,u.value=m_ssrc[4],0!==d)continue;$(U,cur_ssrc_id),c[U].descriptions.ssrc[cur_ssrc_id].push(u),Y(U,"attrs",{}),c[U].descriptions.attrs.ssrc=cur_ssrc_id
}else if(m_ssrc_group=R_WEBRTC_SDP_ICE_PAYLOAD.ssrc_group.exec(h)){if(d=0,v={},w=m_ssrc_group[1]||d++,x=m_ssrc_group[2]||d++,v.sources=[],x=x.trim()){x=x.split(" ");for(g in x)y=x[g].trim(),y&&v.sources.push({ssrc:y})}if(0===v.sources.length&&d++,0!==d)continue;_(U,w),c[U].descriptions["ssrc-group"][w].push(v)}else if(m_rtcp_mux=R_WEBRTC_SDP_ICE_PAYLOAD.rtcp_mux.exec(h))Y(U,"rtcp-mux",1);else if(m_extmap=R_WEBRTC_SDP_ICE_PAYLOAD.extmap.exec(h)){if(d=0,z={},z.id=m_extmap[1]||d++,z.uri=m_extmap[4]||d++,z.senders=m_extmap[3],0!==d)continue;Y(U,"rtp-hdrext",[]),c[U].descriptions["rtp-hdrext"].push(z)}else if(J=R_WEBRTC_SDP_ICE_PAYLOAD.fingerprint.exec(h)){if(d=0,t=W.fingerprint||{},t.hash=J[1]||d++,t.value=J[2]||d++,0!==d)continue;Z(U,"fingerprint",t),W.fingerprint=t}else m_setup=R_WEBRTC_SDP_ICE_PAYLOAD.setup.exec(h),m_setup?(t=W.fingerprint||{},t.setup=m_setup[1],t.setup&&(Z(U,"fingerprint",t),W.fingerprint=t)):(K=R_WEBRTC_SDP_ICE_PAYLOAD.pwd.exec(h),K?(Z(U,"pwd",K[1]),W.pwd||(W.pwd=K[1])):(L=R_WEBRTC_SDP_ICE_PAYLOAD.ufrag.exec(h),L?(Z(U,"ufrag",L[1]),W.ufrag||(W.ufrag=L[1])):(Q=R_WEBRTC_SDP_CANDIDATE.exec(h),Q&&a._util_sdp_parse_candidate_store({media:V,candidate:h}))));for(R in c)if(a.get_name()[R]){"object"!=typeof c[R].transports&&(c[R].transports={});for(S in W)c[R].transports[S]||(c[R].transports[S]=W[S])}else delete c[R]}catch(cb){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_parse_payload > "+cb,1)}return c},a._util_sdp_parse_group=function(b){var c={};try{if(!b||-1==b.indexOf("\n"))return c;var d,e,f,g=b.split("\n"),h=function(a){a in c||(c[a]=[])};for(d in g)e=g[d],f=R_WEBRTC_SDP_ICE_PAYLOAD.group.exec(e),f&&f[1]&&f[2]&&(h(f[1]),c[f[1]]=-1===f[2].indexOf(" ")?[f[2]]:f[2].split(" "))}catch(i){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_parse_group > "+i,1)}return c},a._util_sdp_resolution_payload=function(b){try{if(!b||"object"!=typeof b)return{};if(-1===a.get_media_all().indexOf(JSJAC_JINGLE_MEDIA_VIDEO))return b;var c,d,e,f,g,h,i,j=null,k=null;for(c in a.get_local_view())if("number"==typeof a.get_local_view()[c].videoWidth&&"number"==typeof a.get_local_view()[c].videoHeight&&(j=a.get_local_view()[c].videoHeight,k=a.get_local_view()[c].videoWidth,j&&k))break;if(!j||!k){if(a.get_debug().log("[JSJaCJingle:utils] _util_sdp_resolution_payload > Could not get local video resolution, falling back on constraints (local video may not be ready).",0),i=a.util_generate_constraints(),"object"!=typeof i.video||"object"!=typeof i.video.mandatory||"number"!=typeof i.video.mandatory.minWidth||"number"!=typeof i.video.mandatory.minHeight)return a.get_debug().log("[JSJaCJingle:utils] _util_sdp_resolution_payload > Could not get local video resolution (not sending it).",1),b;j=i.video.mandatory.minHeight,k=i.video.mandatory.minWidth}h=[{name:"height",value:j},{name:"width",value:k}];for(f in b)if(f==JSJAC_JINGLE_MEDIA_VIDEO){g=b[f].descriptions.payload;for(d in g){"object"!=typeof g[d].parameter&&(g[d].parameter=[]);for(e in h)g[d].parameter.push(h[e])}}a.get_debug().log("[JSJaCJingle:utils] _util_sdp_resolution_payload > Got local video resolution ("+k+"x"+j+").",2)}catch(l){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_resolution_payload > "+l,1)}return b},a._util_sdp_parse_candidate=function(b){var c={};try{if(!b)return c;var d=0,e=R_WEBRTC_SDP_CANDIDATE.exec(b);if(e&&(c.component=e[2]||d++,c.foundation=e[1]||d++,c.generation=e[16]||JSJAC_JINGLE_GENERATION,c.id=a.util_generate_id(),c.ip=e[5]||d++,c.network=JSJAC_JINGLE_NETWORK,c.port=e[6]||d++,c.priority=e[4]||d++,c.protocol=e[3]||d++,c["rel-addr"]=e[11],c["rel-port"]=e[13],c.type=e[8]||d++),0!==d)return{}}catch(f){a.get_debug().log("[JSJaCJingle:utils] _util_sdp_parse_candidate > "+f,1)}return c},a._util_sdp_parse_candidate_store=function(b){var c=b.media,d=b.candidate,e=a._util_sdp_parse_candidate(d);a._set_candidates_local(a._util_name_generate(c),e),a._set_candidates_queue_local(a._util_name_generate(c),e)}}function __JSJaCJinglePeer(){var a=this;a._peer_connection_create=function(b){a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create",4);try{var c,d=a._util_config_ice();if("object"==typeof d.iceServers)for(c=0;c<d.iceServers.length;c++)a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > Using ICE server at: "+d.iceServers[c].url+" ("+(c+1)+").",2);else a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > No ICE server configured. Network may not work properly.",0);if(a._set_peer_connection(new WEBRTC_PEER_CONNECTION(d,WEBRTC_CONFIGURATION.peer_connection.constraints)),a._get_peer_connection().onicecandidate=function(c){if(c.candidate)a._util_sdp_parse_candidate_store({media:isNaN(c.candidate.sdpMid)?c.candidate.sdpMid:a._util_media_generate(parseInt(c.candidate.sdpMid,10)),candidate:c.candidate.candidate});else{if(a._util_build_content_local(),a.is_initiator()&&a.get_status()==JSJAC_JINGLE_STATUS_INITIATING||a.is_responder()&&a.get_status()==JSJAC_JINGLE_STATUS_ACCEPTING)a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > onicecandidate > Got initial candidates.",2),b();else{a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > onicecandidate > Got more candidates (on the go).",2);var d=a._get_candidates_queue_local();a.util_object_length(d)>0&&a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_TRANSPORT_INFO,candidates:d})}a._set_candidates_queue_local(null)}},a._get_peer_connection().oniceconnectionstatechange=function(){switch(a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > oniceconnectionstatechange",2),this.iceConnectionState){case"disconnected":a._peer_timeout(this.iceConnectionState,{timer:JSJAC_JINGLE_PEER_TIMEOUT_DISCONNECT,reason:JSJAC_JINGLE_REASON_CONNECTIVITY_ERROR});break;case"checking":a._peer_timeout(this.iceConnectionState)}a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > oniceconnectionstatechange > (state: "+this.iceConnectionState+").",2)},a._get_peer_connection().onaddstream=function(b){b&&(a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > onaddstream",2),a._set_remote_stream(b.stream))},a._get_peer_connection().onremovestream=function(){a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > onremovestream",2),a._set_remote_stream(null)},a._get_peer_connection().addStream(a._get_local_stream()),a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > Getting local description...",2),a.is_initiator())a._get_peer_connection().createOffer(a._peer_got_description,a._peer_fail_description,WEBRTC_CONFIGURATION.create_offer);else{sdp_remote=a._util_sdp_generate(WEBRTC_SDP_TYPE_OFFER,a._get_group_remote(),a._get_payloads_remote(),a._get_candidates_queue_remote()),a.get_sdp_trace()&&a.get_debug().log("[JSJaCJingle:peer] SDP (remote)\n\n"+sdp_remote.description.sdp,4),a._get_peer_connection().setRemoteDescription(new WEBRTC_SESSION_DESCRIPTION(sdp_remote.description),function(){},function(b){a.get_sdp_trace()&&a.get_debug().log("[JSJaCJingle:peer] SDP (remote:error)\n\n"+(b.message||b.name||"Unknown error"),4),a.terminate(JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS)}),a._get_peer_connection().createAnswer(a._peer_got_description,a._peer_fail_description,WEBRTC_CONFIGURATION.create_answer);var e,f;for(e in sdp_remote.candidates)f=sdp_remote.candidates[e],a._get_peer_connection().addIceCandidate(new WEBRTC_ICE_CANDIDATE({sdpMLineIndex:f.id,candidate:f.candidate}));a._set_candidates_queue_remote(null)}}catch(g){a.get_debug().log("[JSJaCJingle:peer] _peer_connection_create > "+g,1)}},a._peer_get_user_media=function(b){a.get_debug().log("[JSJaCJingle:peer] _peer_get_user_media",4);try{a.get_debug().log("[JSJaCJingle:peer] _peer_get_user_media > Getting user media...",2),WEBRTC_GET_MEDIA.bind(navigator)(a.util_generate_constraints(),a._peer_got_user_media_success.bind(this,b),a._peer_got_user_media_error.bind(this))}catch(c){a.get_debug().log("[JSJaCJingle:peer] _peer_get_user_media > "+c,1)}},a._peer_got_user_media_success=function(b,c){a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_success",4);try{if(a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_success > Got user media.",2),a._set_local_stream(c),b&&"function"==typeof b)if(a.get_media()==JSJAC_JINGLE_MEDIA_VIDEO&&a.get_local_view().length){a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_success > Waiting for local video to be loaded...",2);var d=function(){a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_success > Local video loaded.",2),this.removeEventListener("loadeddata",d,!1),b()};a.get_local_view()[0].addEventListener("loadeddata",d,!1)}else b()}catch(e){a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_success > "+e,1)}},a._peer_got_user_media_error=function(b){a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_error",4);try{a._get_session_initiate_error()(a),a.is_initiator()&&a.handle_session_initiate_error(),a.is_responder()&&a.terminate(JSJAC_JINGLE_REASON_MEDIA_ERROR),a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_error > Failed ("+(b.PERMISSION_DENIED?"permission denied":"unknown")+").",1)}catch(c){a.get_debug().log("[JSJaCJingle:peer] _peer_got_user_media_error > "+c,1)}},a._peer_got_description=function(b){a.get_debug().log("[JSJaCJingle:peer] _peer_got_description",4);try{a.get_debug().log("[JSJaCJingle:peer] _peer_got_description > Got local description.",2),a.get_sdp_trace()&&a.get_debug().log("[JSJaCJingle:peer] SDP (local:raw)\n\n"+b.sdp,4);var c,d=a._util_sdp_parse_payload(b.sdp);a._util_sdp_resolution_payload(d);for(c in d)a._set_payloads_local(c,d[c]);var e,f=a._util_sdp_parse_group(b.sdp);for(e in f)a._set_group_local(e,f[e]);var g=a._util_sdp_generate_description(b.type,a._get_group_local(),a._get_payloads_local(),a._util_sdp_generate_candidates(a._get_candidates_local()));a.get_sdp_trace()&&a.get_debug().log("[JSJaCJingle:peer] SDP (local:gen)\n\n"+g.sdp,4),a._get_peer_connection().setLocalDescription(new WEBRTC_SESSION_DESCRIPTION(g),function(){},function(b){a.get_sdp_trace()&&a.get_debug().log("[JSJaCJingle:peer] SDP (local:error)\n\n"+(b.message||b.name||"Unknown error"),4)}),a.get_debug().log("[JSJaCJingle:peer] _peer_got_description > Waiting for local candidates...",2)}catch(h){a.get_debug().log("[JSJaCJingle:peer] _peer_got_description > "+h,1)}},a._peer_fail_description=function(){a.get_debug().log("[JSJaCJingle:peer] _peer_fail_description",4);try{a.get_debug().log("[JSJaCJingle:peer] _peer_fail_description > Could not get local description!",1)}catch(b){a.get_debug().log("[JSJaCJingle:peer] _peer_fail_description > "+b,1)}},a._peer_sound=function(b){a.get_debug().log("[JSJaCJingle:peer] _peer_sound",4);try{a.get_debug().log("[JSJaCJingle:peer] _peer_sound > Enable: "+b+" (current: "+a.get_mute(JSJAC_JINGLE_MEDIA_AUDIO)+").",2);var c,d=a._get_local_stream().getAudioTracks();for(c=0;c<d.length;c++)d[c].enabled=b}catch(e){a.get_debug().log("[JSJaCJingle:peer] _peer_sound > "+e,1)}},a._peer_timeout=function(b,c){try{"object"!=typeof c&&(c={});var d=a.get_sid();setTimeout(function(){a.get_sid()==d&&a._get_peer_connection().iceConnectionState==b&&(a.get_debug().log("[JSJaCJingle:peer] util_stanza_timeout > Peer timeout.",2),a.terminate(c.reason||JSJAC_JINGLE_REASON_FAILED_TRANSPORT))},1e3*(c.timer||JSJAC_JINGLE_PEER_TIMEOUT_DEFAULT))}catch(e){a.get_debug().log("[JSJaCJingle:peer] _peer_timeout > "+e,1)}},a._peer_stop=function(){a.get_debug().log("[JSJaCJingle:peer] _peer_stop",4),a._set_local_stream(null),a._set_remote_stream(null),a._get_peer_connection()&&a._get_peer_connection().close(),JSJaCJingle_remove(a.get_sid())}}function JSJaCJingleSingle(){var a=this;a.initiate=function(){a.get_debug().log("[JSJaCJingle:peer] initiate",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] initiate > Cannot initiate, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.initiate()}))return void a.get_debug().log("[JSJaCJingle:peer] initiate > Deferred (waiting for the library components to be initiated).",0);if(a.get_status()!=JSJAC_JINGLE_STATUS_INACTIVE)return void a.get_debug().log("[JSJaCJingle:peer] initiate > Cannot initiate, resource not inactive (status: "+a.get_status()+").",0);a.get_debug().log("[JSJaCJingle:peer] initiate > New Jingle session with media: "+a.get_media(),2);var b,c;a._get_session_initiate_pending()(a),a._set_status(JSJAC_JINGLE_STATUS_INITIATING),a._set_sid(a.util_generate_sid()),a._set_initiator(a.util_connection_jid()),a._set_responder(a.get_to());for(b in a.get_media_all())c=a._util_name_generate(a.get_media_all()[b]),a._set_name(c),a._set_senders(c,JSJAC_JINGLE_SENDERS_BOTH.jingle),a._set_creator(c,JSJAC_JINGLE_CREATOR_INITIATOR);JSJaCJingle_add(a.get_sid(),a),a._peer_get_user_media(function(){a._peer_connection_create(function(){a.get_debug().log("[JSJaCJingle:peer] initiate > Ready to begin Jingle negotiation.",2),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_INITIATE})})})}catch(d){a.get_debug().log("[JSJaCJingle:peer] initiate > "+d,1)}},a.accept=function(){a.get_debug().log("[JSJaCJingle:peer] accept",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] accept > Cannot accept, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.accept()}))return void a.get_debug().log("[JSJaCJingle:peer] accept > Deferred (waiting for the library components to be initiated).",0);if(a.get_status()!=JSJAC_JINGLE_STATUS_INITIATED)return void a.get_debug().log("[JSJaCJingle:peer] accept > Cannot accept, resource not initiated (status: "+a.get_status()+").",0);a.get_debug().log("[JSJaCJingle:peer] accept > New Jingle session with media: "+a.get_media(),2),a._get_session_accept_pending()(a),a._set_status(JSJAC_JINGLE_STATUS_ACCEPTING),a._peer_get_user_media(function(){a._peer_connection_create(function(){a.get_debug().log("[JSJaCJingle:peer] accept > Ready to complete Jingle negotiation.",2),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_ACCEPT})})})}catch(b){a.get_debug().log("[JSJaCJingle:peer] accept > "+b,1)}},a.info=function(b,c){a.get_debug().log("[JSJaCJingle:peer] info",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] info > Cannot accept, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.info(b,c)}))return void a.get_debug().log("[JSJaCJingle:peer] info > Deferred (waiting for the library components to be initiated).",0);if(a.get_status()!=JSJAC_JINGLE_STATUS_INITIATED&&a.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING&&a.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTED)return void a.get_debug().log("[JSJaCJingle:peer] info > Cannot send info, resource not active (status: "+a.get_status()+").",0);"object"!=typeof c&&(c={}),c.action=JSJAC_JINGLE_ACTION_SESSION_INFO,b&&(c.info=b),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,c)}catch(d){a.get_debug().log("[JSJaCJingle:peer] info > "+d,1)}},a.terminate=function(b){a.get_debug().log("[JSJaCJingle:peer] terminate",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] terminate > Cannot terminate, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.terminate(b)}))return void a.get_debug().log("[JSJaCJingle:peer] terminate > Deferred (waiting for the library components to be initiated).",0);if(a.get_status()==JSJAC_JINGLE_STATUS_TERMINATED)return void a.get_debug().log("[JSJaCJingle:peer] terminate > Cannot terminate, resource already terminated (status: "+a.get_status()+").",0);a._set_status(JSJAC_JINGLE_STATUS_TERMINATING),a._get_session_terminate_pending()(a),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_TERMINATE,reason:b})}catch(c){a.get_debug().log("[JSJaCJingle:peer] terminate > "+c,1)}},a.send=function(b,c){a.get_debug().log("[JSJaCJingle:peer] send",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] send > Cannot send, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.send(b,c)}))return void a.get_debug().log("[JSJaCJingle:peer] send > Deferred (waiting for the library components to be initiated).",0);"object"!=typeof c&&(c={});var d=new JSJaCIQ;if(d.setTo(a.get_to()),b&&d.setType(b),c.id||(c.id=a._get_id_new()),d.setID(c.id),b==JSJAC_JINGLE_STANZA_TYPE_SET){if(!(c.action&&c.action in JSJAC_JINGLE_ACTIONS))return void a.get_debug().log("[JSJaCJingle:peer] send > Stanza action unknown: "+(c.action||"undefined"),1);switch(a._set_sent_id(c.id),c.action){case JSJAC_JINGLE_ACTION_CONTENT_ACCEPT:a.send_content_accept(d);break;case JSJAC_JINGLE_ACTION_CONTENT_ADD:a.send_content_add(d);break;case JSJAC_JINGLE_ACTION_CONTENT_MODIFY:a.send_content_modify(d);break;case JSJAC_JINGLE_ACTION_CONTENT_REJECT:a.send_content_reject(d);break;case JSJAC_JINGLE_ACTION_CONTENT_REMOVE:a.send_content_remove(d);break;case JSJAC_JINGLE_ACTION_DESCRIPTION_INFO:a.send_description_info(d);break;case JSJAC_JINGLE_ACTION_SECURITY_INFO:a.send_security_info(d);break;case JSJAC_JINGLE_ACTION_SESSION_ACCEPT:a.send_session_accept(d,c);break;case JSJAC_JINGLE_ACTION_SESSION_INFO:a.send_session_info(d,c);break;case JSJAC_JINGLE_ACTION_SESSION_INITIATE:a.send_session_initiate(d,c);break;case JSJAC_JINGLE_ACTION_SESSION_TERMINATE:a.send_session_terminate(d,c);break;case JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT:a.send_transport_accept(d);break;case JSJAC_JINGLE_ACTION_TRANSPORT_INFO:a.send_transport_info(d,c);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REJECT:a.send_transport_reject(d);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE:a.send_transport_replace(d);break;default:return a.get_debug().log("[JSJaCJingle:peer] send > Unexpected error.",1),!1}}else if(b!=JSJAC_JINGLE_STANZA_TYPE_RESULT)return a.get_debug().log("[JSJaCJingle:peer] send > Stanza type must either be set or result.",1),!1;return JSJAC_JINGLE_STORE_CONNECTION.send(d),a.get_net_trace()&&a.get_debug().log("[JSJaCJingle:peer] Outgoing packet sent\n\n"+d.xml()),!0}catch(e){a.get_debug().log("[JSJaCJingle:peer] send > "+e,1)}return!1},a.handle=function(b){a.get_debug().log("[JSJaCJingle:peer] handle",4);try{if(a.get_net_trace()&&a.get_debug().log("[JSJaCJingle:peer] Incoming packet received\n\n"+b.xml()),a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] handle > Cannot handle, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.handle(b)}))return void a.get_debug().log("[JSJaCJingle:peer] handle > Deferred (waiting for the library components to be initiated).",0);var c=b.getID(),d=b.getType();if(c&&d==JSJAC_JINGLE_STANZA_TYPE_RESULT&&a._set_received_id(c),"function"==typeof a._get_handlers(d,c))return a.get_debug().log("[JSJaCJingle:peer] handle > Submitted to custom handler.",2),a._get_handlers(d,c)(b),void a.unregister_handler(d,c);var e=a.util_stanza_jingle(b);if(!e)return;var f=a.util_stanza_get_attribute(e,"action");if(!f)return;switch(f){case JSJAC_JINGLE_ACTION_CONTENT_ACCEPT:a.handle_content_accept(b);break;case JSJAC_JINGLE_ACTION_CONTENT_ADD:a.handle_content_add(b);break;case JSJAC_JINGLE_ACTION_CONTENT_MODIFY:a.handle_content_modify(b);break;case JSJAC_JINGLE_ACTION_CONTENT_REJECT:a.handle_content_reject(b);break;case JSJAC_JINGLE_ACTION_CONTENT_REMOVE:a.handle_content_remove(b);break;case JSJAC_JINGLE_ACTION_DESCRIPTION_INFO:a.handle_description_info(b);break;case JSJAC_JINGLE_ACTION_SECURITY_INFO:a.handle_security_info(b);break;case JSJAC_JINGLE_ACTION_SESSION_ACCEPT:a.handle_session_accept(b);break;case JSJAC_JINGLE_ACTION_SESSION_INFO:a.handle_session_info(b);break;case JSJAC_JINGLE_ACTION_SESSION_INITIATE:a.handle_session_initiate(b);break;case JSJAC_JINGLE_ACTION_SESSION_TERMINATE:a.handle_session_terminate(b);break;case JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT:a.handle_transport_accept(b);break;case JSJAC_JINGLE_ACTION_TRANSPORT_INFO:a.handle_transport_info(b);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REJECT:a.handle_transport_reject(b);break;case JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE:a.handle_transport_replace(b)}}catch(g){a.get_debug().log("[JSJaCJingle:peer] handle > "+g,1)}},a.mute=function(b){a.get_debug().log("[JSJaCJingle:peer] mute",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] mute > Cannot mute, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.mute(b)}))return void a.get_debug().log("[JSJaCJingle:peer] mute > Deferred (waiting for the library components to be initiated).",0);if(a.get_mute(b))return void a.get_debug().log("[JSJaCJingle:peer] mute > Resource already muted.",0);a._peer_sound(!1),a._set_mute(b,!0),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_INFO,info:JSJAC_JINGLE_SESSION_INFO_MUTE,name:b})}catch(c){a.get_debug().log("[JSJaCJingle:peer] mute > "+c,1)}},a.unmute=function(b){a.get_debug().log("[JSJaCJingle:peer] unmute",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] unmute > Cannot unmute, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.unmute(b)}))return void a.get_debug().log("[JSJaCJingle:peer] unmute > Deferred (waiting for the library components to be initiated).",0);if(!a.get_mute(b))return void a.get_debug().log("[JSJaCJingle:peer] unmute > Resource already unmuted.",0);a._peer_sound(!0),a._set_mute(b,!1),a.send(JSJAC_JINGLE_STANZA_TYPE_SET,{action:JSJAC_JINGLE_ACTION_SESSION_INFO,info:JSJAC_JINGLE_SESSION_INFO_UNMUTE,name:b})}catch(c){a.get_debug().log("[JSJaCJingle:peer] unmute > "+c,1)}},a.media=function(b){a.get_debug().log("[JSJaCJingle:peer] media",4);try{if(a.get_lock())return void a.get_debug().log("[JSJaCJingle:peer] media > Cannot change media, resource locked. Please open another session or check WebRTC support.",0);if(JSJaCJingle_defer(function(){a.media(b)}))return void a.get_debug().log("[JSJaCJingle:peer] media > Deferred (waiting for the library components to be initiated).",0);if(b||(b=a.get_media()==JSJAC_JINGLE_MEDIA_VIDEO?JSJAC_JINGLE_MEDIA_AUDIO:JSJAC_JINGLE_MEDIA_VIDEO),!(b in JSJAC_JINGLE_MEDIAS))return void a.get_debug().log("[JSJaCJingle:peer] media > No media provided or media unsupported (media: "+b+").",0);if(a.get_media()==b)return void a.get_debug().log("[JSJaCJingle:peer] media > Resource already using this media (media: "+b+").",0);if(a.get_media_busy())return void a.get_debug().log("[JSJaCJingle:peer] media > Resource already busy switching media (busy: "+a.get_media()+", media: "+b+").",0);a.get_debug().log("[JSJaCJingle:peer] media > Changing media to: "+b+"...",2),a._set_media(b),a._set_media_busy(!0)}catch(c){a.get_debug().log("[JSJaCJingle:peer] media > "+c,1)}},a.register_handler=function(b,c,d){a.get_debug().log("[JSJaCJingle:peer] register_handler",4);try{return b=b||JSJAC_JINGLE_STANZA_TYPE_ALL,"function"!=typeof d?(a.get_debug().log("[JSJaCJingle:peer] register_handler > fn parameter not passed or not a function!",1),!1):c?(a._set_handlers(b,c,d),a.get_debug().log("[JSJaCJingle:peer] register_handler > Registered handler for id: "+c+" and type: "+b,3),!0):(a.get_debug().log("[JSJaCJingle:peer] register_handler > Could not register handler (no ID).",1),!1)}catch(e){a.get_debug().log("[JSJaCJingle:peer] register_handler > "+e,1)}return!1},a.unregister_handler=function(b,c){a.get_debug().log("[JSJaCJingle:peer] unregister_handler",4);try{return b=b||JSJAC_JINGLE_STANZA_TYPE_ALL,b in a._handlers&&c in a._handlers[b]?(delete a._handlers[b][c],a.get_debug().log("[JSJaCJingle:peer] unregister_handler > Unregistered handler for id: "+c+" and type: "+b,3),!0):(a.get_debug().log("[JSJaCJingle:peer] unregister_handler > Could not unregister handler with id: "+c+" and type: "+b+" (not found).",2),!1)}catch(d){a.get_debug().log("[JSJaCJingle:peer] unregister_handler > "+d,1)}return!1},a.register_view=function(b,c){a.get_debug().log("[JSJaCJingle:peer] register_view",4);try{var d=a._util_map_register_view(b);if(d.type==b){var e;for(e in d.view.get())if(d.view.get()[e]==c)return a.get_debug().log("[JSJaCJingle:peer] register_view > Could not register view of type: "+b+" (already registered).",2),!0;return d.view.set(c),a._util_peer_stream_attach([c],d.stream.get(),d.mute),a.get_debug().log("[JSJaCJingle:peer] register_view > Registered view of type: "+b,3),!0}return a.get_debug().log("[JSJaCJingle:peer] register_view > Could not register view of type: "+b+" (type unknown).",1),!1}catch(f){a.get_debug().log("[JSJaCJingle:peer] register_view > "+f,1)}return!1},a.unregister_view=function(b,c){a.get_debug().log("[JSJaCJingle:peer] unregister_view",4);try{var d=a._util_map_unregister_view(b);if(d.type==b){var e;for(e in d.view.get())if(d.view.get()[e]==c)return a._util_peer_stream_detach([c]),a.util_array_remove_value(d.view.get(),c),a.get_debug().log("[JSJaCJingle:peer] unregister_view > Unregistered view of type: "+b,3),!0;return a.get_debug().log("[JSJaCJingle:peer] unregister_view > Could not unregister view of type: "+b+" (not found).",2),!0}return a.get_debug().log("[JSJaCJingle:peer] unregister_view > Could not unregister view of type: "+b+" (type unknown).",1),!1}catch(f){a.get_debug().log("[JSJaCJingle:peer] unregister_view > "+f,1)}return!1},a.send_content_accept=function(){a.get_debug().log("[JSJaCJingle:peer] send_content_accept",4);try{a.get_debug().log("[JSJaCJingle:peer] send_content_accept > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_content_accept > "+b,1)}},a.send_content_add=function(){a.get_debug().log("[JSJaCJingle:peer] send_content_add",4);try{a.get_debug().log("[JSJaCJingle:peer] send_content_add > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_content_add > "+b,1)}},a.send_content_modify=function(){a.get_debug().log("[JSJaCJingle:peer] send_content_modify",4);try{a.get_debug().log("[JSJaCJingle:peer] send_content_modify > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_content_modify > "+b,1)}},a.send_content_reject=function(){a.get_debug().log("[JSJaCJingle:peer] send_content_reject",4);try{a.get_debug().log("[JSJaCJingle:peer] send_content_reject > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_content_reject > "+b,1)}},a.send_content_remove=function(){a.get_debug().log("[JSJaCJingle:peer] send_content_remove",4);try{a.get_debug().log("[JSJaCJingle:peer] send_content_remove > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_content_remove > "+b,1)}},a.send_description_info=function(){a.get_debug().log("[JSJaCJingle:peer] send_description_info",4);try{a.get_debug().log("[JSJaCJingle:peer] send_description_info > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_description_info > "+b,1)}},a.send_security_info=function(){a.get_debug().log("[JSJaCJingle:peer] send_security_info",4);try{a.get_debug().log("[JSJaCJingle:peer] send_security_info > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_security_info > "+b,1)}},a.send_session_accept=function(b,c){a.get_debug().log("[JSJaCJingle:peer] send_session_accept",4);try{if(a.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING)return a.get_debug().log("[JSJaCJingle:peer] send_session_accept > Cannot send accept stanza, resource not accepting (status: "+a.get_status()+").",0),void a.send_error(b,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);if(!c)return void a.get_debug().log("[JSJaCJingle:peer] send_session_accept > Argument not provided.",1);var d=a._util_stanza_generate_jingle(b,{action:JSJAC_JINGLE_ACTION_SESSION_ACCEPT,responder:a.get_responder()});a._util_stanza_generate_content_local(b,d),a._util_stanza_generate_group_local(b,d),a.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,function(b){a._get_session_accept_success()(a,b),a.handle_session_accept_success(b)}),a.util_stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,{external:a._get_session_accept_error(),internal:a.handle_session_accept_error}),a.get_debug().log("[JSJaCJingle:peer] send_session_accept > Sent.",4)}catch(e){a.get_debug().log("[JSJaCJingle:peer] send_session_accept > "+e,1)}},a.send_session_info=function(b,c){a.get_debug().log("[JSJaCJingle:peer] send_session_info",4);try{if(!c)return void a.get_debug().log("[JSJaCJingle:peer] send_session_info > Argument not provided.",1);c.info=c.info||JSJAC_JINGLE_SESSION_INFO_ACTIVE;var d=a._util_stanza_generate_jingle(b,{action:JSJAC_JINGLE_ACTION_SESSION_INFO,initiator:a.get_initiator()});a._util_stanza_generate_session_info(b,d,c),a.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,function(b){a._get_session_info_success()(a,b),a.handle_session_info_success(b)}),a.util_stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,{external:a._get_session_info_error(),internal:a.handle_session_info_error}),a.get_debug().log("[JSJaCJingle:peer] send_session_info > Sent (name: "+c.info+").",2)}catch(e){a.get_debug().log("[JSJaCJingle:peer] send_session_info > "+e,1)}},a.send_session_initiate=function(b,c){a.get_debug().log("[JSJaCJingle:peer] send_session_initiate",4);try{if(a.get_status()!=JSJAC_JINGLE_STATUS_INITIATING)return void a.get_debug().log("[JSJaCJingle:peer] send_session_initiate > Cannot send initiate stanza, resource not initiating (status: "+a.get_status()+").",0);if(!c)return void a.get_debug().log("[JSJaCJingle:peer] send_session_initiate > Argument not provided.",1);var d=a._util_stanza_generate_jingle(b,{action:JSJAC_JINGLE_ACTION_SESSION_INITIATE,initiator:a.get_initiator()});a._util_stanza_generate_content_local(b,d),a._util_stanza_generate_group_local(b,d),a.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,function(b){a._get_session_initiate_success()(a,b),a.handle_session_initiate_success(b)}),a.util_stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,{external:a._get_session_initiate_error(),internal:a.handle_session_initiate_error}),a.get_debug().log("[JSJaCJingle:peer] send_session_initiate > Sent.",2)}catch(e){a.get_debug().log("[JSJaCJingle:peer] send_session_initiate > "+e,1)}},a.send_session_terminate=function(b,c){a.get_debug().log("[JSJaCJingle:peer] send_session_terminate",4);try{if(a.get_status()!=JSJAC_JINGLE_STATUS_TERMINATING)return void a.get_debug().log("[JSJaCJingle:peer] send_session_terminate > Cannot send terminate stanza, resource not terminating (status: "+a.get_status()+").",0);if(!c)return void a.get_debug().log("[JSJaCJingle:peer] send_session_terminate > Argument not provided.",1);c.reason=c.reason||JSJAC_JINGLE_REASON_SUCCESS,a._set_reason(c.reason);var d=a._util_stanza_generate_jingle(b,{action:JSJAC_JINGLE_ACTION_SESSION_TERMINATE}),e=d.appendChild(b.buildNode("reason",{xmlns:NS_JINGLE}));e.appendChild(b.buildNode(c.reason,{xmlns:NS_JINGLE})),a.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,function(b){a._get_session_terminate_success()(a,b),a.handle_session_terminate_success(b)}),a.util_stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,{external:a._get_session_terminate_error(),internal:a.handle_session_terminate_error}),a.get_debug().log("[JSJaCJingle:peer] send_session_terminate > Sent (reason: "+c.reason+").",2)}catch(f){a.get_debug().log("[JSJaCJingle:peer] send_session_terminate > "+f,1)}},a.send_transport_accept=function(){a.get_debug().log("[JSJaCJingle:peer] send_transport_accept",4);try{a.get_debug().log("[JSJaCJingle:peer] send_transport_accept > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_transport_accept > "+b,1)}},a.send_transport_info=function(b,c){a.get_debug().log("[JSJaCJingle:peer] send_transport_info",4);try{if(a.get_status()!=JSJAC_JINGLE_STATUS_INITIATED&&a.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING&&a.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTED)return void a.get_debug().log("[JSJaCJingle:peer] send_transport_info > Cannot send transport info, resource not initiated, nor accepting, nor accepted (status: "+a.get_status()+").",0);
if(!c)return void a.get_debug().log("[JSJaCJingle:peer] send_transport_info > Argument not provided.",1);if(0===a.util_object_length(a._get_candidates_queue_local()))return void a.get_debug().log("[JSJaCJingle:peer] send_transport_info > No local candidate in queue.",1);var d,e=a._util_stanza_generate_jingle(b,{action:JSJAC_JINGLE_ACTION_TRANSPORT_INFO,initiator:a.get_initiator()}),f={};for(d in a.get_name())f[d]=a._util_generate_content(a.get_creator(d),d,a.get_senders(d),a._get_payloads_local(d),a._get_candidates_queue_local(d));a._util_stanza_generate_content_local(b,e,f),a._util_stanza_generate_group_local(b,e),a.register_handler(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,function(b){a.handle_transport_info_success(b)}),a.util_stanza_timeout(JSJAC_JINGLE_STANZA_TYPE_RESULT,c.id,{internal:a.handle_transport_info_error}),a.get_debug().log("[JSJaCJingle:peer] send_transport_info > Sent.",2)}catch(g){a.get_debug().log("[JSJaCJingle:peer] send_transport_info > "+g,1)}},a.send_transport_reject=function(){a.get_debug().log("[JSJaCJingle:peer] send_transport_reject",4);try{a.get_debug().log("[JSJaCJingle:peer] send_transport_reject > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_transport_reject > "+b,1)}},a.send_transport_replace=function(){a.get_debug().log("[JSJaCJingle:peer] send_transport_replace",4);try{a.get_debug().log("[JSJaCJingle:peer] send_transport_replace > Feature not implemented!",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] send_transport_replace > "+b,1)}},a.send_error=function(b,c){a.get_debug().log("[JSJaCJingle:peer] send_error",4);try{if(!("type"in c))return void a.get_debug().log("[JSJaCJingle:peer] send_error > Type unknown.",1);if("jingle"in c&&!(c.jingle in JSJAC_JINGLE_ERRORS))return void a.get_debug().log("[JSJaCJingle:peer] send_error > Jingle condition unknown ("+c.jingle+").",1);if("xmpp"in c&&!(c.xmpp in XMPP_ERRORS))return void a.get_debug().log("[JSJaCJingle:peer] send_error > XMPP condition unknown ("+c.xmpp+").",1);var d=new JSJaCIQ;d.setType("error"),d.setID(b.getID()),d.setTo(a.get_to());var e=d.getNode().appendChild(d.buildNode("error",{xmlns:NS_CLIENT,type:c.type}));"xmpp"in c&&e.appendChild(d.buildNode(c.xmpp,{xmlns:NS_STANZAS})),"jingle"in c&&e.appendChild(d.buildNode(c.jingle,{xmlns:NS_JINGLE_ERRORS})),JSJAC_JINGLE_STORE_CONNECTION.send(d),a.get_debug().log("[JSJaCJingle:peer] send_error > Sent: "+(c.jingle||c.xmpp),2)}catch(f){a.get_debug().log("[JSJaCJingle:peer] send_error > "+f,1)}},a.handle_content_accept=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_content_accept",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_content_accept > "+c,1)}},a.handle_content_add=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_content_add",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_content_add > "+c,1)}},a.handle_content_modify=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_content_modify",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_content_modify > "+c,1)}},a.handle_content_reject=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_content_reject",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_content_reject > "+c,1)}},a.handle_content_remove=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_content_remove",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_content_remove > "+c,1)}},a.handle_description_info=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_description_info",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_description_info > "+c,1)}},a.handle_security_info=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_security_info",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_security_info > "+c,1)}},a.handle_session_accept=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept",4);try{if(!a.util_stanza_safe(b))return a.get_debug().log("[JSJaCJingle:peer] handle_session_accept > Dropped unsafe stanza.",0),void a.send_error(b,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION);switch(b.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:a._get_session_accept_success()(a,b),a.handle_session_accept_success(b);break;case"error":a._get_session_accept_error()(a,b),a.handle_session_accept_error(b);break;case JSJAC_JINGLE_STANZA_TYPE_SET:a._get_session_accept_request()(a,b),a.handle_session_accept_request(b);break;default:a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept > "+c,1)}},a.handle_session_accept_success=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_success",4);try{a._set_status(JSJAC_JINGLE_STATUS_ACCEPTED)}catch(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_success > "+b,1)}},a.handle_session_accept_error=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_error",4);try{a.terminate(JSJAC_JINGLE_REASON_TIMEOUT)}catch(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_error > "+b,1)}},a.handle_session_accept_request=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_request",4);try{if(a.get_status()!=JSJAC_JINGLE_STATUS_INITIATED)return a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_request > Cannot handle, resource already accepted (status: "+a.get_status()+").",0),void a.send_error(b,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);var c,d;a._set_status(JSJAC_JINGLE_STATUS_ACCEPTING);var e=a.util_stanza_sid(b);if(e&&a.is_initiator()&&a._util_stanza_parse_content(b)){a._util_stanza_parse_group(b),a._util_build_content_remote(),a._get_session_accept_success()(a,b),a.handle_session_accept_success(b);var f=a._util_sdp_generate(WEBRTC_SDP_TYPE_ANSWER,a._get_group_remote(),a._get_payloads_remote(),a._get_candidates_queue_remote());a.get_sdp_trace()&&a.get_debug().log("[JSJaCJingle:peer] SDP (remote)\n\n"+f.description.sdp,4),a._get_peer_connection().setRemoteDescription(new WEBRTC_SESSION_DESCRIPTION(f.description),function(){},function(b){a.get_sdp_trace()&&a.get_debug().log("[JSJaCJingle:peer] SDP (remote:error)\n\n"+(b.message||b.name||"Unknown error"),4),a.terminate(JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS)});for(c in f.candidates)d=f.candidates[c],a._get_peer_connection().addIceCandidate(new WEBRTC_ICE_CANDIDATE({sdpMLineIndex:d.id,candidate:d.candidate}));a._set_candidates_queue_remote(null),a.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:b.getID()})}else a._get_session_accept_error()(a,b),a.handle_session_accept_error(b),a.send_error(b,XMPP_ERROR_BAD_REQUEST),a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_request > Error.",1)}catch(g){a.get_debug().log("[JSJaCJingle:peer] handle_session_accept_request > "+g,1)}},a.handle_session_info=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_info",4);try{if(!a.util_stanza_safe(b))return a.get_debug().log("[JSJaCJingle:peer] handle_session_info > Dropped unsafe stanza.",0),void a.send_error(b,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION);switch(b.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:a._get_session_info_success()(a,b),a.handle_session_info_success(b);break;case"error":a._get_session_info_error()(a,b),a.handle_session_info_error(b);break;case JSJAC_JINGLE_STANZA_TYPE_SET:a._get_session_info_request()(a,b),a.handle_session_info_request(b);break;default:a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_session_info > "+c,1)}},a.handle_session_info_success=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_info_success",4)},a.handle_session_info_error=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_info_error",4)},a.handle_session_info_request=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_info_request",4);try{var c=a.util_stanza_session_info(b),d=!1;switch(c){case JSJAC_JINGLE_SESSION_INFO_ACTIVE:case JSJAC_JINGLE_SESSION_INFO_RINGING:case JSJAC_JINGLE_SESSION_INFO_MUTE:case JSJAC_JINGLE_SESSION_INFO_UNMUTE:d=!0}d?(a.get_debug().log("[JSJaCJingle:peer] handle_session_info_request > (name: "+(c||"undefined")+").",3),a.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:b.getID()}),a._get_session_info_success()(a,b),a.handle_session_info_success(b)):(a.get_debug().log("[JSJaCJingle:peer] handle_session_info_request > Error (name: "+(c||"undefined")+").",1),a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED),a._get_session_info_error()(a,b),a.handle_session_info_error(b))}catch(e){a.get_debug().log("[JSJaCJingle:peer] handle_session_info_request > "+e,1)}},a.handle_session_initiate=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate",4);try{switch(b.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:a._get_session_initiate_success()(a,b),a.handle_session_initiate_success(b);break;case"error":a._get_session_initiate_error()(a,b),a.handle_session_initiate_error(b);break;case JSJAC_JINGLE_STANZA_TYPE_SET:a._get_session_initiate_request()(a,b),a.handle_session_initiate_request(b);break;default:a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate > "+c,1)}},a.handle_session_initiate_success=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_success",4);try{a._set_status(JSJAC_JINGLE_STATUS_INITIATED)}catch(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_success > "+b,1)}},a.handle_session_initiate_error=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_error",4);try{a._set_status(JSJAC_JINGLE_STATUS_INACTIVE),a._peer_stop(),a._set_lock(!0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_error > "+b,1)}},a.handle_session_initiate_request=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_request",4);try{if(a.get_status()!=JSJAC_JINGLE_STATUS_INACTIVE)return a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_request > Cannot handle, resource already initiated (status: "+a.get_status()+").",0),void a.send_error(b,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);a._set_status(JSJAC_JINGLE_STATUS_INITIATING);var c=a.util_stanza_from(b),d=a.util_stanza_sid(b);if(d&&a._util_stanza_parse_content(b)){if(a._util_stanza_parse_group(b),a._set_sid(d),a._set_to(c),a._set_initiator(c),a._set_responder(a.util_connection_jid()),JSJaCJingle_add(d,a),a._util_build_content_remote(),JSJAC_JINGLE_MEDIA_VIDEO in a._get_content_remote())a._set_media(JSJAC_JINGLE_MEDIA_VIDEO);else{if(!(JSJAC_JINGLE_MEDIA_AUDIO in a._get_content_remote()))return a._get_session_initiate_error()(a,b),a.handle_session_initiate_error(b),a.terminate(JSJAC_JINGLE_REASON_UNSUPPORTED_APPLICATIONS),void a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_request > Error (unsupported media).",1);a._set_media(JSJAC_JINGLE_MEDIA_AUDIO)}a._get_session_initiate_success()(a,b),a.handle_session_initiate_success(b),a.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:b.getID()})}else a._get_session_initiate_error()(a,b),a.handle_session_initiate_error(b),a.send_error(b,XMPP_ERROR_BAD_REQUEST),a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_request > Error (bad request).",1)}catch(e){a.get_debug().log("[JSJaCJingle:peer] handle_session_initiate_request > "+e,1)}},a.handle_session_terminate=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate",4);try{{b.getType()}if(!a.util_stanza_safe(b))return a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate > Dropped unsafe stanza.",0),void a.send_error(b,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION);switch(b.getType()){case JSJAC_JINGLE_STANZA_TYPE_RESULT:a._get_session_terminate_success()(a,b),a.handle_session_terminate_success(b);break;case"error":a._get_session_terminate_error()(a,b),a.handle_session_terminate_error(b);break;case JSJAC_JINGLE_STANZA_TYPE_SET:a._get_session_terminate_request()(a,b),a.handle_session_terminate_request(b);break;default:a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate > "+c,1)}},a.handle_session_terminate_success=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_success",4);try{a._set_status(JSJAC_JINGLE_STATUS_TERMINATED),a._peer_stop()}catch(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_success > "+b,1)}},a.handle_session_terminate_error=function(){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_error",4);try{a._set_status(JSJAC_JINGLE_STATUS_TERMINATED),a._peer_stop(),a._set_lock(!0),a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_error > Forced session termination locally.",0)}catch(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_error > "+b,1)}},a.handle_session_terminate_request=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_request",4);try{if(a.get_status()==JSJAC_JINGLE_STATUS_INACTIVE||a.get_status()==JSJAC_JINGLE_STATUS_TERMINATED)return a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_request > Cannot handle, resource not active (status: "+a.get_status()+").",0),void a.send_error(b,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);a._set_status(JSJAC_JINGLE_STATUS_TERMINATING),a._set_reason(a.util_stanza_terminate_reason(b)),a._get_session_terminate_success()(a,b),a.handle_session_terminate_success(b),a.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:b.getID()}),a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_request > (reason: "+a.get_reason()+").",3)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_session_terminate_request > "+c,1)}},a.handle_transport_accept=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_transport_accept",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_content_accept > "+c,1)}},a.handle_transport_info=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_transport_info",4);try{if(a.get_status()!=JSJAC_JINGLE_STATUS_INITIATED&&a.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTING&&a.get_status()!=JSJAC_JINGLE_STATUS_ACCEPTED)return a.get_debug().log("[JSJaCJingle:peer] handle_transport_info > Cannot handle, resource not initiated, nor accepting, nor accepted (status: "+a.get_status()+").",0),void a.send_error(b,JSJAC_JINGLE_ERROR_OUT_OF_ORDER);var c,d,e=a.util_stanza_sid(b);if(e&&a._util_stanza_parse_content(b)){a._util_build_content_remote();var f=a._util_sdp_generate_candidates(a._get_candidates_queue_remote());for(c in f)d=f[c],a._get_peer_connection().addIceCandidate(new WEBRTC_ICE_CANDIDATE({sdpMLineIndex:d.id,candidate:d.candidate}));a._set_candidates_queue_remote(null),a.send(JSJAC_JINGLE_STANZA_TYPE_RESULT,{id:b.getID()})}else a.send_error(b,XMPP_ERROR_BAD_REQUEST),a.get_debug().log("[JSJaCJingle:peer] handle_transport_info > Error.",1)}catch(g){a.get_debug().log("[JSJaCJingle:peer] handle_transport_info > "+g,1)}},a.handle_transport_info_success=function(){a.get_debug().log("[JSJaCJingle:peer] handle_transport_info_success",4)},a.handle_transport_info_error=function(){a.get_debug().log("[JSJaCJingle:peer] handle_transport_info_error",4)},a.handle_transport_reject=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_transport_reject",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_transport_reject > "+c,1)}},a.handle_transport_replace=function(b){a.get_debug().log("[JSJaCJingle:peer] handle_transport_replace",4);try{a.send_error(b,XMPP_ERROR_FEATURE_NOT_IMPLEMENTED)}catch(c){a.get_debug().log("[JSJaCJingle:peer] handle_transport_replace > "+c,1)}},a.is_responder=function(){return a.util_negotiation_status()==JSJAC_JINGLE_SENDERS_RESPONDER.jingle},a.is_initiator=function(){return a.util_negotiation_status()==JSJAC_JINGLE_SENDERS_INITIATOR.jingle}}function JSJaCJingleMuji(a){return"object"!=typeof a&&(a={}),a.is_muji=!0,new JSJaCJingle(a)}function JSJaCJingle_listen(a){try{a&&a.connection&&(JSJAC_JINGLE_STORE_CONNECTION=a.connection),a&&a.initiate&&(JSJAC_JINGLE_STORE_INITIATE=a.initiate),a&&a.debug&&(JSJAC_JINGLE_STORE_DEBUG=a.debug),JSJAC_JINGLE_STORE_CONNECTION.registerHandler("iq",JSJaCJingle_route),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:listen > Listening.",2),a&&a.extdisco===!1||JSJaCJingle_extdisco(),a&&a.relaynodes===!1||JSJaCJingle_relaynodes(),a.fallback&&"string"==typeof a.fallback&&JSJaCJingle_fallback(a.fallback)}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:listen > "+b,1)}}function JSJaCJingle_route(a){try{var b=null,c=null,d=a.getChild("jingle",NS_JINGLE);if(d)c=d.getAttribute("sid"),b=d.getAttribute("action");else{var e=a.getID();if(e){var f=-1!==e.indexOf(JSJAC_JINGLE_STANZA_ID_PRE+"_");if(f){var g=e.split("_");c=g[1]}}}if(d&&!JSJAC_JINGLE_AVAILABLE)JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:route > Dropped Jingle packet (WebRTC not available).",0),new JSJaCJingle({to:a.getFrom()}).send_error(a,XMPP_ERROR_SERVICE_UNAVAILABLE);else{var h=JSJaCJingle_read(c);b==JSJAC_JINGLE_ACTION_SESSION_INITIATE&&null===h?(JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:route > New Jingle session (sid: "+c+").",2),JSJAC_JINGLE_STORE_INITIATE(a)):c&&(null!==h?(JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:route > Routed to Jingle session (sid: "+c+").",2),h.handle(a)):a.getType()==JSJAC_JINGLE_STANZA_TYPE_SET&&a.getFrom()&&(JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:route > Unknown Jingle session (sid: "+c+").",0),new JSJaCJingle({to:a.getFrom()}).send_error(a,JSJAC_JINGLE_ERROR_UNKNOWN_SESSION)))}}catch(i){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:route > "+i,1)}}function JSJaCJingle_add(a,b){JSJAC_JINGLE_STORE_SESSIONS[a]=b}function JSJaCJingle_read(a){return a in JSJAC_JINGLE_STORE_SESSIONS?JSJAC_JINGLE_STORE_SESSIONS[a]:null}function JSJaCJingle_remove(a){delete JSJAC_JINGLE_STORE_SESSIONS[a]}function JSJaCJingle_defer(a){try{if("function"==typeof a)return JSJAC_JINGLE_STORE_DEFER.deferred&&(JSJAC_JINGLE_STORE_DEFER.fn.push(a),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:defer > Registered a function to be executed once ready.",2)),JSJAC_JINGLE_STORE_DEFER.deferred;if(!a||"boolean"==typeof a)if(JSJAC_JINGLE_STORE_DEFER.deferred=a===!0,JSJAC_JINGLE_STORE_DEFER.deferred===!1){if(--JSJAC_JINGLE_STORE_DEFER.count<=0){for(JSJAC_JINGLE_STORE_DEFER.count=0,JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:defer > Executing "+JSJAC_JINGLE_STORE_DEFER.fn.length+" deferred functions...",2);JSJAC_JINGLE_STORE_DEFER.fn.length;)JSJAC_JINGLE_STORE_DEFER.fn.shift()();JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:defer > Done executing deferred functions.",2)}}else++JSJAC_JINGLE_STORE_DEFER.count}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:defer > "+b,1)}}function JSJaCJingle_disco(){return JSJAC_JINGLE_AVAILABLE?MAP_DISCO_JINGLE:[]}function JSJaCJingle_extdisco(){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > Discovering available services...",2);try{JSJaCJingle_defer(!0);var a=new JSJaCIQ;a.setTo(JSJAC_JINGLE_STORE_CONNECTION.domain),a.setType(JSJAC_JINGLE_STANZA_TYPE_GET),a.getNode().appendChild(a.buildNode("services",{xmlns:NS_EXTDISCO})),JSJAC_JINGLE_STORE_CONNECTION.send(a,function(a){try{if(a.getType()==JSJAC_JINGLE_STANZA_TYPE_RESULT){var b,c,d,e,f,g,h,i,j,k=a.getChild("services",NS_EXTDISCO);if(k)for(c=k.getElementsByTagNameNS(NS_EXTDISCO,"service"),b=0;b<c.length;b++)d=c[b],e=d.getAttribute("host")||null,g=d.getAttribute("port")||null,h=d.getAttribute("transport")||null,i=d.getAttribute("type")||null,j=d.getAttribute("username")||null,f=d.getAttribute("password")||null,e&&i&&(i in JSJAC_JINGLE_STORE_EXTDISCO?(JSJAC_JINGLE_STORE_EXTDISCO[i][e]={port:g,transport:h,type:i},"turn"==i&&(JSJAC_JINGLE_STORE_EXTDISCO[i][e].username=j,JSJAC_JINGLE_STORE_EXTDISCO[i][e].password=f),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > handle > Service stored (type: "+i+", host: "+e+", port: "+g+", transport: "+h+").",4)):JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > handle > Service skipped (type: "+i+", host: "+e+", port: "+g+", transport: "+h+").",4));JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > handle > Discovered available services.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > handle > Could not discover services (server might not support XEP-0215).",0)}catch(l){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > handle > "+l,1)}JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > Ready.",2),JSJaCJingle_defer(!1)})}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:extdisco > "+b,1),JSJaCJingle_defer(!1)}}function JSJaCJingle_relaynodes(){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:relaynodes > Discovering available Jingle Relay Nodes services...",2);try{JSJaCJingle_defer(!0);var a=new JSJaCIQ;a.setTo(JSJAC_JINGLE_STORE_CONNECTION.domain),a.setType(JSJAC_JINGLE_STANZA_TYPE_GET),a.getNode().appendChild(a.buildNode("services",{xmlns:NS_JABBER_JINGLENODES})),JSJAC_JINGLE_STORE_CONNECTION.send(a,function(a){try{if(a.getType()==JSJAC_JINGLE_STANZA_TYPE_RESULT){var b,c,d,e,f,g,h=a.getChild("services",NS_JABBER_JINGLENODES);if(h)for(c=h.getElementsByTagNameNS(NS_JABBER_JINGLENODES,"stun"),b=0;b<c.length;b++)d=c[b],e=d.getAttribute("policy")||null,f=d.getAttribute("address")||null,cur_port=d.getAttribute("port")||null,g=d.getAttribute("protocol")||null,f&&g&&e&&(!e||"public"==e)&&(JSJAC_JINGLE_STORE_RELAYNODES.stun[f]={port:cur_port,transport:g,type:"stun"},JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:relaynodes > handle > STUN service stored (address: "+f+", port: "+cur_port+", policy: "+e+", protocol: "+g+").",4));JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:relaynodes > handle > Discovered available Jingle Relay Nodes services.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:relaynodes > handle > Could not discover Jingle Relay Nodes services (server might not support XEP-0278).",0)}catch(i){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:relaynodes > handle > "+i,1)}JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:relaynodes > Ready.",2),JSJaCJingle_defer(!1)})}catch(b){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:relaynodes > "+b,1),JSJaCJingle_defer(!1)}}function JSJaCJingle_fallback(a){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > Discovering fallback services...",2);try{JSJaCJingle_defer(!0),a+="?username="+encodeURIComponent(JSJAC_JINGLE_STORE_CONNECTION.username+"@"+JSJAC_JINGLE_STORE_CONNECTION.domain);var b=new XMLHttpRequest;b.open("GET",a,!0),b.onreadystatechange=function(){if(4===b.readyState){if(200===b.status){var a,c,d,e,f,g,h,i,j,k=JSON.parse(b.responseText);if(k.uris&&k.uris.length){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > Parsing "+k.uris.length+" URIs...",2);for(c in k.uris)if(d=k.uris[c])if(a=R_JSJAC_JINGLE_SERVICE_URI.exec(d)){if(e=a[1]||null,f=a[2]||null,g=a[3]||null,h=a[4]||null,i=k.username||null,j=k.password||null,!f||!e)continue;if(!(e in JSJAC_JINGLE_STORE_FALLBACK)){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > Service skipped (type: "+e+", host: "+f+", port: "+g+", transport: "+h+").",4);continue}JSJAC_JINGLE_STORE_FALLBACK[e][f]={port:g,transport:h,type:e},"turn"==e&&(JSJAC_JINGLE_STORE_FALLBACK[e][f].username=i,JSJAC_JINGLE_STORE_FALLBACK[e][f].password=j),JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > Fallback service stored (type: "+e+", host: "+f+", port: "+g+", transport: "+h+").",4)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > Fallback service not stored, weird URI ("+d+").",0);JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > Finished parsing URIs.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > No URI to parse.",2);JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > Discovered fallback services.",2)}else JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > handle > Could not discover fallback services (API malfunction).",0);JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > Ready.",2),JSJaCJingle_defer(!1)}},b.send()}catch(c){JSJAC_JINGLE_STORE_DEBUG.log("[JSJaCJingle:commons] lib:fallback > "+c,1)}}(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b){var c=[],d=[];return y(a,function(a){(b(a)?c:d).push(a)}),[c,d]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);
return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this),function(){"use strict";function a(a){function b(){}var c={};c.Object=b,a.extend(c.Object,{__mro__:[c.Object],__properties__:{__ringConstructor__:function(){}},__classId__:1,__parents__:[],__classIndex__:{1:c.Object}}),a.extend(c.Object.prototype,{__ringConstructor__:c.Object.__properties__.__ringConstructor__});var d=function(a){function b(){}b.prototype=a;var c=new b;return c.__proto__=a,c};c.__objectCreate=d;var e=3,f=/xyz/.test(function(){xyz()})?/\$super\b/:/.*/;c.create=function(){var b=a.toArray(arguments);b.reverse();var i=b[0],j=b.length>=2?b[1]:[];j instanceof Array||(j=[j]),a.each(j,function(a){h(a)}),0===j.length&&(j=[c.Object]);var k=i.constructor!==Object?i.constructor:void 0;i=a.clone(i),delete i.constructor,k?i.__ringConstructor__=k:(k=i.init,delete i.init,k&&(i.__ringConstructor__=k));var l=function(){this.$super=null,this.__ringConstructor__.apply(this,arguments)};l.__properties__=i;var m=a.pluck(j,"__mro__");m=m.concat([j]);var n=[l].concat(g(m)),o=Object.prototype;a.each(a.clone(n).reverse(),function(b){var c=d(o);a.extend(c,b.__properties__),a.each(a.keys(c),function(a){var d=c[a];"function"!=typeof d||!f.test(d)||"__ringConstructor__"!==a&&b.__ringConvertedObject__||(c[a]=function(a,b,c){return function(){var d=this.$super;this.$super=c[a];try{return b.apply(this,arguments)}finally{this.$super=d}}}(a,d,o))}),c.constructor=b,o=c});var p=e++;return l.__mro__=n,l.__parents__=j,l.prototype=o,l.__classId__=p,l.__classIndex__={},a.each(l.__mro__,function(a){l.__classIndex__[a.__classId__]=a}),l.prototype.classInit&&(l.__classInit__=l.prototype.classInit,delete l.prototype.classInit),a.each(a.chain(l.__mro__).clone().reverse().value(),function(a){if(a.__classInit__){var b=a.__classInit__(l.prototype);void 0!==b&&(l.prototype=b)}}),l};var g=function(b){for(var d=[],e=a.clone(b);;){for(var f=!1,g=0;g<e.length;g++)if(0!==e[g].length){var h=e[g][0],i=a.find(e,function(b){return a.contains(a.rest(b),h)});if(!i){f=!0,d.push(h),e=a.map(e,function(b){return a.head(b)===h?a.rest(b):b});break}}if(!f){if(a.all(e,function(a){return 0===a.length}))return d;throw new c.ValueError("Cannot create a consistent method resolution order (MRO)")}}},h=function(b){if(!b.__classId__){var d=Object.getOwnPropertyNames?function(){var c={};return function d(b){b!==Object.prototype&&(a.extend(c,a.chain(Object.getOwnPropertyNames(b)).map(function(a){return[a,!0]}).object().value()),d(Object.getPrototypeOf(b)))}(b.prototype),a.object(a.map(a.keys(c),function(a){return[a,b.prototype[a]]}))}():b.prototype;d=a.chain(d).map(function(a,b){return[b,a]}).filter(function(a){return"constructor"!==a[0]&&"__proto__"!==a[0]}).object().value();var f=e++;a.extend(b,{__mro__:[b,c.Object],__properties__:a.extend({},d,{__ringConstructor__:function(){this.$super.apply(this,arguments);var a=this.$super;this.$super=null;try{b.apply(this,arguments)}finally{this.$super=a}}}),__classId__:f,__parents__:[c.Object],__classIndex__:{1:c.Object},__ringConvertedObject__:!0}),b.__classIndex__[f]=b}};return c.instance=function(a,b){return"object"==typeof a&&a.constructor&&a.constructor.__classIndex__&&"function"==typeof b&&"number"==typeof b.__classId__?void 0!==a.constructor.__classIndex__[b.__classId__]:"string"==typeof b?typeof a===b:a instanceof b},c.Error=c.create({name:"ring.Error",defaultMessage:"",constructor:function(a){this.message=a||this.defaultMessage},classInit:function(b){var c=[],e=function(a){a&&(c.push(a),e(a.__proto__))};e(b);var f=new Error;return a.each(a.clone(c).reverse(),function(b){var c=d(f);a.each(b,function(a,b){"__proto__"!==b&&(c[b]=a)}),f=c}),f}}),c.ValueError=c.create([c.Error],{name:"ring.ValueError"}),c.getSuper=function(b,d,e){for(var f,g=d.constructor.__mro__,h=0;h<g.length;h++)if(g[h]===b){f=h;break}if(void 0===f)throw new c.ValueError("Class not found in instance's method resolution order.");var i,j=function(a,b){return 0===b?a:j(a.__proto__,b-1)},k=j(d.constructor.prototype,f+1);return i="constructor"!==e&&"init"!==e?k[e]:k.__ringConstructor__,c.instance(i,"function")?a.bind(i,d):i},c}if("undefined"!=typeof exports){var b=require("underscore");b.extend(exports,a(b))}else"undefined"!=typeof define?define(["underscore"],a):window.ring=a(_)}();var WEBRTC_GET_MEDIA=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.getUserMedia,WEBRTC_PEER_CONNECTION=window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.RTCPeerConnection,WEBRTC_SESSION_DESCRIPTION=window.mozRTCSessionDescription||window.RTCSessionDescription,WEBRTC_ICE_CANDIDATE=window.mozRTCIceCandidate||window.RTCIceCandidate,WEBRTC_CONFIGURATION={peer_connection:{config:{iceServers:[{url:"stun:stun.jappix.com"}]},constraints:{optional:[{DtlsSrtpKeyAgreement:!0}]}},create_offer:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},create_answer:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},WEBRTC_SDP_LINE_BREAK="\r\n",WEBRTC_SDP_TYPE_OFFER="offer",WEBRTC_SDP_TYPE_ANSWER="answer",R_WEBRTC_SDP_CANDIDATE=/^a=candidate:(\w{1,32}) (\d{1,5}) (udp|tcp) (\d{1,10}) ([a-zA-Z0-9:\.]{1,45}) (\d{1,5}) (typ) (host|srflx|prflx|relay)( (raddr) ([a-zA-Z0-9:\.]{1,45}) (rport) (\d{1,5}))?( (generation) (\d))?/i,R_WEBRTC_SDP_ICE_PAYLOAD={rtpmap:/^a=rtpmap:(\d+) (([^\s\/]+)\/(\d+)(\/([^\s\/]+))?)?/i,fmtp:/^a=fmtp:(\d+) (.+)/i,group:/^a=group:(\S+) (.+)/,rtcp_fb:/^a=rtcp-fb:(\S+) (\S+)( (\S+))?/i,rtcp_fb_trr_int:/^a=rtcp-fb:(\d+) trr-int (\d+)/i,pwd:/^a=ice-pwd:(\S+)/i,ufrag:/^a=ice-ufrag:(\S+)/i,ptime:/^a=ptime:(\d+)/i,maxptime:/^a=maxptime:(\d+)/i,ssrc:/^a=ssrc:(\d+) (\w+)(:(.+))?/i,ssrc_group:/^a=ssrc-group:(\S+) ([\d ]+)/i,rtcp_mux:/^a=rtcp-mux/i,crypto:/^a=crypto:(\d{1,9}) (\S+) (\S+)( (\S+))?/i,zrtp_hash:/^a=zrtp-hash:(\S+) (\S+)/i,fingerprint:/^a=fingerprint:(\S+) (\S+)/i,setup:/^a=setup:(\S+)/i,extmap:/^a=extmap:([^\s\/]+)(\/([^\s\/]+))? (\S+)/i,bandwidth:/^b=(\w+):(\d+)/i,media:/^m=(audio|video|application|data) /i},R_NETWORK_PROTOCOLS={stun:/^stun:/i},R_NETWORK_IP={all:{v4:/((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])/,v6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i},lan:{v4:/(^127\.0\.0\.1)|(^10\.)|(^172\.1[6-9]\.)|(^172\.2[0-9]\.)|(^172\.3[0-1]\.)|(^192\.168\.)/,v6:/((::1)|(^fe80::))(.+)?/i}},NS_JINGLE="urn:xmpp:jingle:1",NS_JINGLE_ERRORS="urn:xmpp:jingle:errors:1",NS_JINGLE_APPS_RTP="urn:xmpp:jingle:apps:rtp:1",NS_JINGLE_APPS_RTP_INFO="urn:xmpp:jingle:apps:rtp:info:1",NS_JINGLE_APPS_RTP_AUDIO="urn:xmpp:jingle:apps:rtp:audio",NS_JINGLE_APPS_RTP_VIDEO="urn:xmpp:jingle:apps:rtp:video",NS_JINGLE_APPS_RTP_RTP_HDREXT="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",NS_JINGLE_APPS_RTP_RTCP_FB="urn:xmpp:jingle:apps:rtp:rtcp-fb:0",NS_JINGLE_APPS_RTP_ZRTP="urn:xmpp:jingle:apps:rtp:zrtp:1",NS_JINGLE_APPS_RTP_SSMA="urn:xmpp:jingle:apps:rtp:ssma:0",NS_JINGLE_APPS_STUB="urn:xmpp:jingle:apps:stub:0",NS_JINGLE_APPS_DTLS="urn:xmpp:tmp:jingle:apps:dtls:0",NS_JINGLE_APPS_GROUPING="urn:xmpp:jingle:apps:grouping:0",NS_JINGLE_TRANSPORTS_RAWUDP="urn:xmpp:jingle:transports:raw-udp:1",NS_JINGLE_TRANSPORTS_ICEUDP="urn:xmpp:jingle:transports:ice-udp:1",NS_JINGLE_TRANSPORTS_STUB="urn:xmpp:jingle:transports:stub:0",NS_JINGLE_SECURITY_STUB="urn:xmpp:jingle:security:stub:0",NS_JABBER_JINGLENODES="http://jabber.org/protocol/jinglenodes",NS_JABBER_JINGLENODES_CHANNEL="http://jabber.org/protocol/jinglenodes#channel",NS_TELEPATHY_MUJI="http://telepathy.freedesktop.org/muji",NS_EXTDISCO="urn:xmpp:extdisco:1",NS_IETF_RFC_3264="urn:ietf:rfc:3264",NS_IETF_RFC_5576="urn:ietf:rfc:5576",NS_IETF_RFC_5888="urn:ietf:rfc:5888",R_NS_JINGLE_APP=/^urn:xmpp:jingle:app:(\w+)(:(\w+))?(:(\d+))?$/,R_NS_JINGLE_TRANSPORT=/^urn:xmpp:jingle:transport:(\w+)$/,MAP_DISCO_JINGLE=[NS_JINGLE,NS_JINGLE_APPS_RTP,NS_JINGLE_APPS_RTP_AUDIO,NS_JINGLE_APPS_RTP_VIDEO,NS_JINGLE_TRANSPORTS_RAWUDP,NS_JINGLE_TRANSPORTS_ICEUDP,NS_IETF_RFC_3264,NS_IETF_RFC_5576,NS_IETF_RFC_5888,NS_JINGLE_APPS_RTP_RTCP_FB,NS_JINGLE_APPS_RTP_RTP_HDREXT,NS_JINGLE_APPS_DTLS,NS_JINGLE_APPS_RTP_ZRTP,NS_TELEPATHY_MUJI,NS_JABBER_JINGLENODES,NS_EXTDISCO],JSJAC_JINGLE_AVAILABLE=WEBRTC_GET_MEDIA?!0:!1,JSJAC_JINGLE_PEER_TIMEOUT_DEFAULT=15,JSJAC_JINGLE_PEER_TIMEOUT_DISCONNECT=5,JSJAC_JINGLE_STANZA_TIMEOUT=10,JSJAC_JINGLE_STANZA_ID_PRE="jj",JSJAC_JINGLE_NETWORK="0",JSJAC_JINGLE_GENERATION="0",JSJAC_JINGLE_BROWSER_FIREFOX="Firefox",JSJAC_JINGLE_BROWSER_CHROME="Chrome",JSJAC_JINGLE_BROWSER_SAFARI="Safari",JSJAC_JINGLE_BROWSER_OPERA="Opera",JSJAC_JINGLE_BROWSER_IE="IE",JSJAC_JINGLE_SENDERS_BOTH={jingle:"both",sdp:"sendrecv"},JSJAC_JINGLE_SENDERS_INITIATOR={jingle:"initiator",sdp:"sendonly"},JSJAC_JINGLE_SENDERS_NONE={jingle:"none",sdp:"inactive"},JSJAC_JINGLE_SENDERS_RESPONDER={jingle:"responder",sdp:"recvonly"},JSJAC_JINGLE_CREATOR_INITIATOR="initiator",JSJAC_JINGLE_CREATOR_RESPONDER="responder",JSJAC_JINGLE_STATUS_INACTIVE="inactive",JSJAC_JINGLE_STATUS_INITIATING="initiating",JSJAC_JINGLE_STATUS_INITIATED="initiated",JSJAC_JINGLE_STATUS_ACCEPTING="accepting",JSJAC_JINGLE_STATUS_ACCEPTED="accepted",JSJAC_JINGLE_STATUS_TERMINATING="terminating",JSJAC_JINGLE_STATUS_TERMINATED="terminated",JSJAC_JINGLE_ACTION_CONTENT_ACCEPT="content-accept",JSJAC_JINGLE_ACTION_CONTENT_ADD="content-add",JSJAC_JINGLE_ACTION_CONTENT_MODIFY="content-modify",JSJAC_JINGLE_ACTION_CONTENT_REJECT="content-reject",JSJAC_JINGLE_ACTION_CONTENT_REMOVE="content-remove",JSJAC_JINGLE_ACTION_DESCRIPTION_INFO="description-info",JSJAC_JINGLE_ACTION_SECURITY_INFO="security-info",JSJAC_JINGLE_ACTION_SESSION_ACCEPT="session-accept",JSJAC_JINGLE_ACTION_SESSION_INFO="session-info",JSJAC_JINGLE_ACTION_SESSION_INITIATE="session-initiate",JSJAC_JINGLE_ACTION_SESSION_TERMINATE="session-terminate",JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT="transport-accept",JSJAC_JINGLE_ACTION_TRANSPORT_INFO="transport-info",JSJAC_JINGLE_ACTION_TRANSPORT_REJECT="transport-reject",JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE="transport-replace",JSJAC_JINGLE_ERROR_OUT_OF_ORDER={jingle:"out-of-order",xmpp:"unexpected-request",type:"wait"},JSJAC_JINGLE_ERROR_TIE_BREAK={jingle:"tie-break",xmpp:"conflict",type:"cancel"},JSJAC_JINGLE_ERROR_UNKNOWN_SESSION={jingle:"unknown-session",xmpp:"item-not-found",type:"cancel"},JSJAC_JINGLE_ERROR_UNSUPPORTED_INFO={jingle:"unsupported-info",xmpp:"feature-not-implemented",type:"modify"},JSJAC_JINGLE_ERROR_SECURITY_REQUIRED={jingle:"security-required",xmpp:"not-acceptable",type:"cancel"},XMPP_ERROR_UNEXPECTED_REQUEST={xmpp:"unexpected-request",type:"wait"},XMPP_ERROR_CONFLICT={xmpp:"conflict",type:"cancel"},XMPP_ERROR_ITEM_NOT_FOUND={xmpp:"item-not-found",type:"cancel"},XMPP_ERROR_NOT_ACCEPTABLE={xmpp:"not-acceptable",type:"modify"},XMPP_ERROR_FEATURE_NOT_IMPLEMENTED={xmpp:"feature-not-implemented",type:"cancel"},XMPP_ERROR_SERVICE_UNAVAILABLE={xmpp:"service-unavailable",type:"cancel"},XMPP_ERROR_REDIRECT={xmpp:"redirect",type:"modify"},XMPP_ERROR_RESOURCE_CONSTRAINT={xmpp:"resource-constraint",type:"wait"},XMPP_ERROR_BAD_REQUEST={xmpp:"bad-request",type:"cancel"},JSJAC_JINGLE_REASON_ALTERNATIVE_SESSION="alternative-session",JSJAC_JINGLE_REASON_BUSY="busy",JSJAC_JINGLE_REASON_CANCEL="cancel",JSJAC_JINGLE_REASON_CONNECTIVITY_ERROR="connectivity-error",JSJAC_JINGLE_REASON_DECLINE="decline",JSJAC_JINGLE_REASON_EXPIRED="expired",JSJAC_JINGLE_REASON_FAILED_APPLICATION="failed-application",JSJAC_JINGLE_REASON_FAILED_TRANSPORT="failed-transport",JSJAC_JINGLE_REASON_GENERAL_ERROR="general-error",JSJAC_JINGLE_REASON_GONE="gone",JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS="incompatible-parameters",JSJAC_JINGLE_REASON_MEDIA_ERROR="media-error",JSJAC_JINGLE_REASON_SECURITY_ERROR="security-error",JSJAC_JINGLE_REASON_SUCCESS="success",JSJAC_JINGLE_REASON_TIMEOUT="timeout",JSJAC_JINGLE_REASON_UNSUPPORTED_APPLICATIONS="unsupported-applications",JSJAC_JINGLE_REASON_UNSUPPORTED_TRANSPORTS="unsupported-transports",JSJAC_JINGLE_SESSION_INFO_ACTIVE="active",JSJAC_JINGLE_SESSION_INFO_HOLD="hold",JSJAC_JINGLE_SESSION_INFO_MUTE="mute",JSJAC_JINGLE_SESSION_INFO_RINGING="ringing",JSJAC_JINGLE_SESSION_INFO_UNHOLD="unhold",JSJAC_JINGLE_SESSION_INFO_UNMUTE="unmute",JSJAC_JINGLE_MEDIA_AUDIO="audio",JSJAC_JINGLE_MEDIA_VIDEO="video",JSJAC_JINGLE_VIDEO_SOURCE_CAMERA="camera",JSJAC_JINGLE_VIDEO_SOURCE_SCREEN="screen",JSJAC_JINGLE_STANZA_TYPE_ALL="all",JSJAC_JINGLE_STANZA_TYPE_RESULT="result",JSJAC_JINGLE_STANZA_TYPE_SET="set",JSJAC_JINGLE_STANZA_TYPE_GET="get",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST="host",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX="srflx",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_PRFLX="prflx",JSJAC_JINGLE_SDP_CANDIDATE_TYPE_RELAY="relay",JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE="ice",JSJAC_JINGLE_SDP_CANDIDATE_METHOD_RAW="raw",JSJAC_JINGLE_SDP_CANDIDATE_MAP_ICEUDP=[{n:"component",r:1},{n:"foundation",r:1},{n:"generation",r:1},{n:"id",r:1},{n:"ip",r:1},{n:"network",r:1},{n:"port",r:1},{n:"priority",r:1},{n:"protocol",r:1},{n:"rel-addr",r:0},{n:"rel-port",r:0},{n:"type",r:1}],JSJAC_JINGLE_SDP_CANDIDATE_MAP_RAWUDP=[{n:"component",r:1},{n:"generation",r:1},{n:"id",r:1},{n:"ip",r:1},{n:"port",r:1},{n:"type",r:1}],JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_LOCAL="IN",JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_REMOTE="IN",JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V4="IP4",JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V6="IP6",JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_TCP="tcp",JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_UDP="udp",JSJAC_JINGLE_SDP_CANDIDATE_IP_V4="0.0.0.0",JSJAC_JINGLE_SDP_CANDIDATE_IP_V6="::",JSJAC_JINGLE_SDP_CANDIDATE_IP_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_IP_V4,JSJAC_JINGLE_SDP_CANDIDATE_PORT_DEFAULT="1",JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_SCOPE_REMOTE,JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_IPVERSION_V4,JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_DEFAULT=JSJAC_JINGLE_SDP_CANDIDATE_PROTOCOL_UDP,JSJAC_JINGLE_SDP_CANDIDATE_PRIORITY_DEFAULT="1",JSJAC_JINGLE_SDP_CANDIDATE_TYPES={};JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_HOST]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE,JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_SRFLX]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE,JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_PRFLX]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_ICE,JSJAC_JINGLE_SDP_CANDIDATE_TYPES[JSJAC_JINGLE_SDP_CANDIDATE_TYPE_RELAY]=JSJAC_JINGLE_SDP_CANDIDATE_METHOD_RAW;var JSJAC_JINGLE_BROWSERS={};JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_FIREFOX]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_CHROME]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_SAFARI]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_OPERA]=1,JSJAC_JINGLE_BROWSERS[JSJAC_JINGLE_BROWSER_IE]=1;var JSJAC_JINGLE_SENDERS={};JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_BOTH.jingle]=JSJAC_JINGLE_SENDERS_BOTH.sdp,JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_INITIATOR.jingle]=JSJAC_JINGLE_SENDERS_INITIATOR.sdp,JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_NONE.jingle]=JSJAC_JINGLE_SENDERS_NONE.sdp,JSJAC_JINGLE_SENDERS[JSJAC_JINGLE_SENDERS_RESPONDER.jingle]=JSJAC_JINGLE_SENDERS_RESPONDER.sdp;var JSJAC_JINGLE_CREATORS={};JSJAC_JINGLE_CREATORS[JSJAC_JINGLE_CREATOR_INITIATOR]=1,JSJAC_JINGLE_CREATORS[JSJAC_JINGLE_CREATOR_RESPONDER]=1;var JSJAC_JINGLE_STATUSES={};JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_INACTIVE]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_INITIATING]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_INITIATED]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_ACCEPTING]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_ACCEPTED]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_TERMINATING]=1,JSJAC_JINGLE_STATUSES[JSJAC_JINGLE_STATUS_TERMINATED]=1;var JSJAC_JINGLE_ACTIONS={};JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_ACCEPT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_ADD]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_MODIFY]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_REJECT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_CONTENT_REMOVE]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_DESCRIPTION_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SECURITY_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_ACCEPT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_INITIATE]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_SESSION_TERMINATE]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_ACCEPT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_INFO]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_REJECT]=1,JSJAC_JINGLE_ACTIONS[JSJAC_JINGLE_ACTION_TRANSPORT_REPLACE]=1;var JSJAC_JINGLE_ERRORS={};JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_OUT_OF_ORDER.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_TIE_BREAK.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_UNKNOWN_SESSION.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_UNSUPPORTED_INFO.jingle]=1,JSJAC_JINGLE_ERRORS[JSJAC_JINGLE_ERROR_SECURITY_REQUIRED.jingle]=1;var XMPP_ERRORS={};XMPP_ERRORS[XMPP_ERROR_UNEXPECTED_REQUEST.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_CONFLICT.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_ITEM_NOT_FOUND.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_NOT_ACCEPTABLE.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_FEATURE_NOT_IMPLEMENTED.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_SERVICE_UNAVAILABLE.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_REDIRECT.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_RESOURCE_CONSTRAINT.xmpp]=1,XMPP_ERRORS[XMPP_ERROR_BAD_REQUEST.xmpp]=1;var JSJAC_JINGLE_REASONS={};JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_ALTERNATIVE_SESSION]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_BUSY]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_CANCEL]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_CONNECTIVITY_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_DECLINE]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_EXPIRED]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_FAILED_APPLICATION]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_FAILED_TRANSPORT]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_GENERAL_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_GONE]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_INCOMPATIBLE_PARAMETERS]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_MEDIA_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_SECURITY_ERROR]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_SUCCESS]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_TIMEOUT]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_UNSUPPORTED_APPLICATIONS]=1,JSJAC_JINGLE_REASONS[JSJAC_JINGLE_REASON_UNSUPPORTED_TRANSPORTS]=1;var JSJAC_JINGLE_SESSION_INFOS={};JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_ACTIVE]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_HOLD]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_MUTE]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_RINGING]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_UNHOLD]=1,JSJAC_JINGLE_SESSION_INFOS[JSJAC_JINGLE_SESSION_INFO_UNMUTE]=1;var JSJAC_JINGLE_MEDIAS={};JSJAC_JINGLE_MEDIAS[JSJAC_JINGLE_MEDIA_AUDIO]={label:"0"},JSJAC_JINGLE_MEDIAS[JSJAC_JINGLE_MEDIA_VIDEO]={label:"1"};var JSJAC_JINGLE_VIDEO_SOURCES={};JSJAC_JINGLE_VIDEO_SOURCES[JSJAC_JINGLE_VIDEO_SOURCE_CAMERA]=1,JSJAC_JINGLE_VIDEO_SOURCES[JSJAC_JINGLE_VIDEO_SOURCE_SCREEN]=1;var JSJAC_JINGLE_STANZAS={};JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_ALL]=1,JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_RESULT]=1,JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_SET]=1,JSJAC_JINGLE_STANZAS[JSJAC_JINGLE_STANZA_TYPE_GET]=1;var JSJAC_JINGLE_STORE_CONNECTION=null,JSJAC_JINGLE_STORE_SESSIONS={},JSJAC_JINGLE_STORE_INITIATE=function(){},JSJAC_JINGLE_STORE_DEBUG={log:function(){}},JSJAC_JINGLE_STORE_EXTDISCO={stun:{},turn:{}},JSJAC_JINGLE_STORE_FALLBACK={stun:{},turn:{}},JSJAC_JINGLE_STORE_RELAYNODES={stun:{}},JSJAC_JINGLE_STORE_DEFER={deferred:!1,count:0,fn:[]},R_JSJAC_JINGLE_SERVICE_URI=/^(\w+):([^:\?]+)(?::(\d+))?(?:\?transport=(\w+))?/i,__JSJaCJingleBase=ring.create([__JSJaCJingleUtils,__JSJaCJinglePeer],{constructor:function(a){a&&a.session_initiate_pending&&(this._session_initiate_pending=a.session_initiate_pending),a&&a.session_initiate_success&&(this._session_initiate_success=a.session_initiate_success),a&&a.session_initiate_error&&(this._session_initiate_error=a.session_initiate_error),a&&a.session_initiate_request&&(this._session_initiate_request=a.session_initiate_request),a&&a.session_accept_pending&&(this._session_accept_pending=a.session_accept_pending),a&&a.session_accept_success&&(this._session_accept_success=a.session_accept_success),a&&a.session_accept_error&&(this._session_accept_error=a.session_accept_error),a&&a.session_accept_request&&(this._session_accept_request=a.session_accept_request),a&&a.session_info_success&&(this._session_info_success=a.session_info_success),a&&a.session_info_error&&(this._session_info_error=a.session_info_error),a&&a.session_info_request&&(this._session_info_request=a.session_info_request),a&&a.session_terminate_pending&&(this._session_terminate_pending=a.session_terminate_pending),a&&a.session_terminate_success&&(this._session_terminate_success=a.session_terminate_success),a&&a.session_terminate_error&&(this._session_terminate_error=a.session_terminate_error),a&&a.session_terminate_request&&(this._session_terminate_request=a.session_terminate_request),a&&a.add_remote_view&&(this._add_remote_view=a.add_remote_view),a&&a.remove_remote_view&&(this._remove_remote_view=a.remove_remote_view),a&&a.to&&(this._to=a.to),a&&a.media&&(this._media=a.media),a&&a.video_source&&(this._video_source=a.video_source),a&&a.resolution&&(this._resolution=a.resolution),a&&a.bandwidth&&(this._bandwidth=a.bandwidth),a&&a.fps&&(this._fps=a.fps),a&&a.local_view&&(this._local_view=[a.local_view]),a&&a.remote_view&&(this._remote_view=[a.remote_view]),this._stun=a&&a.stun?a.stun:{},this._turn=a&&a.turn?a.turn:{},a&&a.sdp_trace&&(this._sdp_trace=a.sdp_trace),a&&a.net_trace&&(this._net_trace=a.net_trace),this._debug=a&&a.debug&&a.debug.log?a.debug:JSJAC_JINGLE_STORE_DEBUG,this._local_stream=null,this._remote_stream=null,this._content_local={},this._content_remote={},this._payloads_local=[],this._group_local={},this._candidates_local={},this._candidates_queue_local={},this._payloads_remote={},this._group_remote={},this._candidates_remote={},this._candidates_queue_remote={},this._initiator="",this._responder="",this._mute={},this._lock=!1,this._media_busy=!1,this._sid="",this._name={},this._senders={},this._creator={},this._status=JSJAC_JINGLE_STATUS_INACTIVE,this._reason=JSJAC_JINGLE_REASON_CANCEL,this._handlers={},this._peer_connection=null,this._id=0,this._sent_id={},this._received_id={}},_get_session_initiate_pending:function(){return"function"==typeof this._session_initiate_pending?this._session_initiate_pending:function(){}},_get_session_initiate_success:function(){return"function"==typeof this._session_initiate_success?this._session_initiate_success:function(){}},_get_session_initiate_error:function(){return"function"==typeof this._session_initiate_error?this._session_initiate_error:function(){}},_get_session_initiate_request:function(){return"function"==typeof this._session_initiate_request?this._session_initiate_request:function(){}},_get_session_accept_pending:function(){return"function"==typeof this._session_accept_pending?this._session_accept_pending:function(){}},_get_session_accept_success:function(){return"function"==typeof this._session_accept_success?this._session_accept_success:function(){}},_get_session_accept_error:function(){return"function"==typeof this._session_accept_error?this._session_accept_error:function(){}},_get_session_accept_request:function(){return"function"==typeof this._session_accept_request?this._session_accept_request:function(){}},_get_session_info_success:function(){return"function"==typeof this._session_info_success?this._session_info_success:function(){}},_get_session_info_error:function(){return"function"==typeof this._session_info_error?this._session_info_error:function(){}},_get_session_info_request:function(){return"function"==typeof this._session_info_request?this._session_info_request:function(){}},_get_session_terminate_pending:function(){return"function"==typeof this._session_terminate_pending?this._session_terminate_pending:function(){}},_get_session_terminate_success:function(){return"function"==typeof this._session_terminate_success?this._session_terminate_success:function(){}},_get_session_terminate_error:function(){return"function"==typeof this._session_terminate_error?this._session_terminate_error:function(){}},_get_session_terminate_request:function(){return"function"==typeof this._session_terminate_request?this._session_terminate_request:function(){}},_get_add_remote_view:function(){return"function"==typeof this._add_remote_view?this._add_remote_view:function(){}},_get_remove_remote_view:function(){return"function"==typeof this._remove_remote_view?this._remove_remote_view:function(){}},_get_local_stream:function(){return this._local_stream},_get_remote_stream:function(){return this._remote_stream
},_get_payloads_local:function(a){return a?a in this._payloads_local?this._payloads_local[a]:{}:this._payloads_local},_get_group_local:function(a){return a?a in this._group_local?this._group_local[a]:{}:this._group_local},_get_candidates_local:function(a){return a?a in this._candidates_local?this._candidates_local[a]:{}:this._candidates_local},_get_candidates_queue_local:function(a){return a?a in this._candidates_queue_local?this._candidates_queue_local[a]:{}:this._candidates_queue_local},_get_payloads_remote:function(a){return a?a in this._payloads_remote?this._payloads_remote[a]:{}:this._payloads_remote},_get_group_remote:function(a){return a?a in this._group_remote?this._group_remote[a]:{}:this._group_remote},_get_candidates_remote:function(a){return a?a in this._candidates_remote?this._candidates_remote[a]:[]:this._candidates_remote},_get_candidates_queue_remote:function(a){return a?a in this._candidates_queue_remote?this._candidates_queue_remote[a]:{}:this._candidates_queue_remote},_get_content_local:function(a){return a?a in this._content_local?this._content_local[a]:{}:this._content_local},_get_content_remote:function(a){return a?a in this._content_remote?this._content_remote[a]:{}:this._content_remote},_get_handlers:function(a,b){if(a=a||JSJAC_JINGLE_STANZA_TYPE_ALL,b){if(a!=JSJAC_JINGLE_STANZA_TYPE_ALL&&a in this._handlers&&"function"==typeof this._handlers[a][b])return this._handlers[a][b];if(JSJAC_JINGLE_STANZA_TYPE_ALL in this._handlers&&"function"==typeof this._handlers[JSJAC_JINGLE_STANZA_TYPE_ALL][b])return this._handlers[a][b]}return null},_get_peer_connection:function(){return this._peer_connection},_get_id:function(){return this._id},_get_id_pre:function(){return JSJAC_JINGLE_STANZA_ID_PRE+"_"+(this.get_sid()||"0")+"_"},_get_id_new:function(){var a=this._get_id()+1;return this._set_id(a),this._get_id_pre()+a},_get_sent_id:function(){return this._sent_id},_get_received_id:function(){return this._received_id},get_mute:function(a){return a||(a="*"),a in this._mute?this._mute[a]:!1},get_lock:function(){return this._lock||!JSJAC_JINGLE_AVAILABLE},get_media_busy:function(){return this._media_busy},get_sid:function(){return this._sid},get_status:function(){return this._status},get_reason:function(){return this._reason},get_is_muji:function(){return this._is_muji||!1},get_to:function(){return this._to},get_media:function(){return this._media&&this._media in JSJAC_JINGLE_MEDIAS?this._media:JSJAC_JINGLE_MEDIA_VIDEO},get_media_all:function(){return this.get_media()==JSJAC_JINGLE_MEDIA_AUDIO?[JSJAC_JINGLE_MEDIA_AUDIO]:[JSJAC_JINGLE_MEDIA_AUDIO,JSJAC_JINGLE_MEDIA_VIDEO]},get_video_source:function(){return this._video_source&&this._video_source in JSJAC_JINGLE_VIDEO_SOURCES?this._video_source:JSJAC_JINGLE_VIDEO_SOURCE_CAMERA},get_resolution:function(){return this._resolution?this._resolution.toString():null},get_bandwidth:function(){return this._bandwidth?this._bandwidth.toString():null},get_fps:function(){return this._fps?this._fps.toString():null},get_name:function(a){return a?a in this._name:this._name},get_senders:function(a){return a?a in this._senders?this._senders[a]:null:this._senders},get_creator:function(a){return a?a in this._creator?this._creator[a]:null:this._creator},get_creator_this:function(){return this.get_responder()==this.get_to()?JSJAC_JINGLE_CREATOR_INITIATOR:JSJAC_JINGLE_CREATOR_RESPONDER},get_initiator:function(){return this._initiator},get_responder:function(){return this._responder},get_local_view:function(){return"object"==typeof this._local_view?this._local_view:[]},get_remote_view:function(){return"object"==typeof this._remote_view?this._remote_view:[]},get_stun:function(){return"object"==typeof this._stun?this._stun:{}},get_turn:function(){return"object"==typeof this._turn?this._turn:{}},get_sdp_trace:function(){return this._sdp_trace===!0},get_net_trace:function(){return this._net_trace===!0},get_debug:function(){return this._debug},_set_session_initiate_pending:function(a){this._session_initiate_pending=a},_set_initiate_success:function(a){this._session_initiate_success=a},_set_initiate_error:function(a){this._session_initiate_error=a},_set_initiate_request:function(a){this._session_initiate_request=a},_set_accept_pending:function(a){this._session_accept_pending=a},_set_accept_success:function(a){this._session_accept_success=a},_set_accept_error:function(a){this._session_accept_error=a},_set_accept_request:function(a){this._session_accept_request=a},_set_info_success:function(a){this._session_info_success=a},_set_info_error:function(a){this._session_info_error=a},_set_info_request:function(a){this._session_info_request=a},_set_terminate_pending:function(a){this._session_terminate_pending=a},_set_terminate_success:function(a){this._session_terminate_success=a},_set_terminate_error:function(a){this._session_terminate_error=a},_set_terminate_request:function(a){this._session_terminate_request=a},_set_local_stream:function(a){try{!a&&this._local_stream&&(this._local_stream.stop(),this._util_peer_stream_detach(this.get_local_view())),this._local_stream=a,a?this._util_peer_stream_attach(this.get_local_view(),this._get_local_stream(),!0):this._util_peer_stream_detach(this.get_local_view())}catch(b){this.get_debug().log("[JSJaCJingle:base] _set_local_stream > "+b,1)}},_set_remote_stream:function(a){try{!a&&this._remote_stream&&this._util_peer_stream_detach(this.get_remote_view()),this._remote_stream=a,a?this._util_peer_stream_attach(this.get_remote_view(),this._get_remote_stream(),!1):this._util_peer_stream_detach(this.get_remote_view())}catch(b){this.get_debug().log("[JSJaCJingle:base] _set_remote_stream > "+b,1)}},_set_local_view:function(a){"object"!=typeof this._local_view&&(this._local_view=[]),this._local_view.push(a)},_set_remote_view:function(a){"object"!=typeof this._remote_view&&(this._remote_view=[]),this._remote_view.push(a)},_set_payloads_local:function(a,b){this._payloads_local[a]=b},_set_group_local:function(a,b){this._group_local[a]=b},_set_candidates_local:function(a,b){a in this._candidates_local||(this._candidates_local[a]=[]),this._candidates_local[a].push(b)},_set_candidates_queue_local:function(a,b){try{null===a?this._candidates_queue_local={}:(a in this._candidates_queue_local||(this._candidates_queue_local[a]=[]),this._candidates_queue_local[a].push(b))}catch(c){this.get_debug().log("[JSJaCJingle:base] _set_candidates_queue_local > "+c,1)}},_set_payloads_remote:function(a,b){this._payloads_remote[a]=b},_set_payloads_remote_add:function(a,b){try{if(a in this._payloads_remote){var c,d=this._payloads_remote[a].descriptions.payload,e=b.descriptions.payload;for(c in e)c in d||(d[c]=e[c])}else this._set_payloads_remote(a,b)}catch(f){this.get_debug().log("[JSJaCJingle:base] _set_payloads_remote_add > "+f,1)}},_set_group_remote:function(a,b){this._group_remote[a]=b},_set_candidates_remote:function(a,b){this._candidates_remote[a]=b},_set_candidates_queue_remote:function(a,b){null===a?this._candidates_queue_remote={}:this._candidates_queue_remote[a]=b},_set_candidates_remote_add:function(a,b){try{if(!a)return;a in this._candidates_remote||this._set_candidates_remote(a,[]);var c,d,e=[];for(c in this._get_candidates_remote(a))e.push(this._get_candidates_remote(a)[c].id);for(d in b)-1!==b[d].id.indexOf(e)&&this._get_candidates_remote(a).push(b[d])}catch(f){this.get_debug().log("[JSJaCJingle:base] _set_candidates_remote_add > "+f,1)}},_set_content_local:function(a,b){this._content_local[a]=b},_set_content_remote:function(a,b){this._content_remote[a]=b},_set_handlers:function(a,b,c){a in this._handlers||(this._handlers[a]={}),this._handlers[a][b]=c},_set_peer_connection:function(a){this._peer_connection=a},_set_id:function(a){this._id=a},_set_sent_id:function(a){this._sent_id[a]=1},_set_received_id:function(a){this._received_id[a]=1},_set_mute:function(a,b){a&&"*"!=a||(this._mute={},a="*"),this._mute[a]=b},_set_lock:function(a){this._lock=a},_set_media_busy:function(a){this._media_busy=a},_set_sid:function(a){this._sid=a},_set_status:function(a){this._status=a},_set_reason:function(a){this._reason=a||JSJAC_JINGLE_REASON_CANCEL},_set_is_muji:function(a){this._is_muji=a},_set_to:function(a){this._to=a},_set_media:function(a){this._media=a},_set_video_source:function(){this._video_source=video_source},_set_resolution:function(a){this._resolution=a},_set_bandwidth:function(a){this._bandwidth=a},_set_fps:function(a){this._fps=a},_set_name:function(a){this._name[a]=1},_set_senders:function(a,b){b in JSJAC_JINGLE_SENDERS||(b=JSJAC_JINGLE_SENDERS_BOTH.jingle),this._senders[a]=b},_set_creator:function(a,b){b in JSJAC_JINGLE_CREATORS||(b=JSJAC_JINGLE_CREATOR_INITIATOR),this._creator[a]=b},_set_initiator:function(a){this._initiator=a},_set_responder:function(a){this._responder=a},_set_stun:function(a,b){this._stun[stun_server]=b},_set_turn:function(a,b){this._turn[turn_server]=b},_set_sdp_trace:function(a){this._sdp_trace=a},_set_net_trace:function(a){this._net_trace=a},_set_debug:function(a){this._debug=a}});